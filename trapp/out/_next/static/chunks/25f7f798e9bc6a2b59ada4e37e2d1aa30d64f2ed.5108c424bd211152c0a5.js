(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[4],{A1c0:function(e,t,n){"use strict";n.r(t);var s=n("nKUr");t.default=function(e){var t=e.c,n=e.ci,r=e.ri,a=e.squareusedby,c=e.rcd,i=e.onClick,o=e.racksize,l=2*o,u=o,d="."!==t?"pbSquareInner PlayerTile":c[0]===r&&c[1]===n&&"r"===c[2]?"pbSquareInner RightArrow":c[0]===r&&c[1]===n&&"d"===c[2]?"pbSquareInner DownArrow":r===u&&n===u?"pbSquareInner CenterSquare":0!==r&&r!==u&&r!==l||0!==n&&n!==u&&n!==l?r%2===n%2?"pbSquareInner style1":"pbSquareInner style2":"pbSquareInner EscapeHatch",b="."!==t?t:d.indexOf("RightArrow")>-1?"\u27a1":d.indexOf("DownArrow")>-1?"\u2b07":d.indexOf("CenterSquare")>-1?Object(s.jsx)("i",{className:"material-icons",children:"stars"}):".";return d.indexOf("EscapeHatch")>-1?Object(s.jsx)("button",{className:d,onClick:i,children:Object(s.jsx)("span",{className:"material-icons",children:"run_circle"})}):"."===t?Object(s.jsx)("button",{className:d,onClick:i,children:b}):Object(s.jsx)("button",{className:d,onClick:i,children:Object(s.jsx)("div",{className:"pbSquareTileText ".concat(a+("Q"===t?" u":"")),children:b})})}},KQm4:function(e,t,n){"use strict";function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function r(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,"a",(function(){return r}))},KiN8:function(e,t,n){"use strict";n.r(t);var s=n("nKUr");t.default=function(e){var t=e.moves;return Object(s.jsxs)("div",{className:"pbMoves",children:[Object(s.jsx)("div",{className:"pbMovesTitle",children:"MOVES"}),Object(s.jsx)("div",{className:"pbMovesScrollable",id:"ScrollableMoves",children:t&&t.map((function(e,t){var n;return Object(s.jsxs)("div",{className:"pbMove",children:[Object(s.jsx)("span",{className:"pbMove by",children:e.by}),":",Object(s.jsx)("span",{className:"pbMove ".concat(e.type),children:"PLAY"===e.type?Object(s.jsxs)(s.Fragment,{children:[e.pos," ",e.mainword.replace("Q","Qu"),null===(n=e.extrawords)||void 0===n?void 0:n.map((function(e){return Object(s.jsxs)(s.Fragment,{children:[",\xa0",e.replace("Q","Qu")]})}))]}):Object(s.jsx)(s.Fragment,{})})]},"move".concat(t))}))})]})}},NOQH:function(e,t,n){"use strict";n.r(t);var s=n("nKUr"),r=(n("q1tI"),function(e){var t="pbTileOnRack "+(e.selection===e.tileindex?"Selected ":"Unselected ")+("Q"===e.tilevalue?"u ":"")+e.prisonersOrGuards,n=e.tileindex;return Object(s.jsx)("div",{className:t,onClick:function(t){return e.onClick(t)},children:Object(s.jsx)("div",{className:"pbTileOnRackText",children:e.tilevalue})},n)}),a=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"check"}),"\xa0Finish Turn"]})})},c=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"undo"}),"\xa0Recall Tiles"]})})},i=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"cached"}),"\xa0Swap Tiles"]})})},o=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"not_interested"}),"\xa0Pass Turn"]})})},l=function(e){return e.alreadyAllowed?Object(s.jsx)("div",{className:"pbActionButtonSevere",children:Object(s.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(s.jsx)("i",{className:"material-icons",children:"report"}),"\xa0ENABLED",Object(s.jsx)("span",{className:"pbActionButtonSevereText2",children:"\xa0Allow undo is now enabled"})]})}):Object(s.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(s.jsx)("i",{className:"material-icons",children:"report_problem"}),"\xa0Allow Undo Turn",Object(s.jsx)("span",{className:"pbActionButtonSevereText2",children:"Click to let opponent undo"})]})})},u=function(e){return Object(s.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(s.jsx)("i",{className:"material-icons",children:"delete_forever"}),"\xa0Undo My Turn",Object(s.jsx)("span",{className:"pbActionButtonSevereText2",children:"Opponent has allowed undo"})]})})};function d(e){return Object(s.jsxs)("div",{className:"pbActionButtonDiv",children:[Object(s.jsx)("p",{children:Object(s.jsx)(a,{onClick:function(){return e.onClickFinishTurn()}})}),Object(s.jsx)("p",{children:Object(s.jsx)(c,{onClick:function(){return e.onClickTileRecall()}})}),Object(s.jsx)("p",{children:Object(s.jsx)(i,{onClick:function(){return e.onClickTileExchange()}})}),Object(s.jsx)("p",{children:Object(s.jsx)(o,{onClick:function(){return e.onClickPassPlay()}})})]})}function b(e){return Object(s.jsx)("div",{className:"pbActionButtonDiv",children:Object(s.jsx)("p",{children:Object(s.jsx)(l,{onClick:function(){return e.onClickAllowUndo()},alreadyAllowed:e.allowRewind})})})}function j(e){return Object(s.jsx)("div",{className:"pbActionButtonDiv",children:Object(s.jsx)("p",{children:Object(s.jsx)(u,{onClick:function(){return e.onClickUndoLastPlay()}})})})}t.default=function(e){var t="P"===e.prisonersOrGuards?"run_circle":"security",n="P"===e.prisonersOrGuards?"PRISONERS":"GUARDS";return Object(s.jsxs)("div",{className:"pbPlayerInnerSection",children:[Object(s.jsxs)("div",{className:"pbPlayerTitle",children:[Object(s.jsx)("i",{className:"material-icons",children:t}),"\xa0",n,"\xa0",Object(s.jsx)("i",{className:"material-icons",children:t})]}),Object(s.jsx)("div",{className:"pbTilerack",children:e.racktiles&&e.racktiles.map((function(t,n){return Object(s.jsx)(r,{whoseturn:e.whoseturn,prisonersOrGuards:e.prisonersOrGuards,selection:e.selection,tileindex:n,tilevalue:t,onClick:function(){return e.onClick(n)}},"RackTile".concat(n))}))}),e.whoseturn===e.prisonersOrGuards?d(e):e.allowRewind&&e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by===e.prisonersOrGuards&&j(e),e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by!==e.prisonersOrGuards&&b(e)]})}},YFqc:function(e,t,n){e.exports=n("cTJO")},cTJO:function(e,t,n){"use strict";var s=n("J4zp"),r=n("284h");t.__esModule=!0,t.default=void 0;var a=r(n("q1tI")),c=n("elyg"),i=n("nOHt"),o=n("vNVm"),l={};function u(e,t,n,s){if(e&&(0,c.isLocalURL)(t)){e.prefetch(t,n,s).catch((function(e){0}));var r=s&&"undefined"!==typeof s.locale?s.locale:e&&e.locale;l[t+"%"+n+(r?"%"+r:"")]=!0}}var d=function(e){var t=!1!==e.prefetch,n=(0,i.useRouter)(),r=n&&n.pathname||"/",d=a.default.useMemo((function(){var t=(0,c.resolveHref)(r,e.href,!0),n=s(t,2),a=n[0],i=n[1];return{href:a,as:e.as?(0,c.resolveHref)(r,e.as):i||a}}),[r,e.href,e.as]),b=d.href,j=d.as,f=e.children,p=e.replace,O=e.shallow,h=e.scroll,m=e.locale;"string"===typeof f&&(f=a.default.createElement("a",null,f));var v=a.Children.only(f),y=v&&"object"===typeof v&&v.ref,g=(0,o.useIntersection)({rootMargin:"200px"}),x=s(g,2),w=x[0],N=x[1],k=a.default.useCallback((function(e){w(e),y&&("function"===typeof y?y(e):"object"===typeof y&&(y.current=e))}),[y,w]);(0,a.useEffect)((function(){var e=N&&t&&(0,c.isLocalURL)(b),s="undefined"!==typeof m?m:n&&n.locale,r=l[b+"%"+j+(s?"%"+s:"")];e&&!r&&u(n,b,j,{locale:s})}),[j,b,N,m,t,n]);var S={ref:k,onClick:function(e){v.props&&"function"===typeof v.props.onClick&&v.props.onClick(e),e.defaultPrevented||function(e,t,n,s,r,a,i,o){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&(0,c.isLocalURL)(n))&&(e.preventDefault(),null==i&&(i=s.indexOf("#")<0),t[r?"replace":"push"](n,s,{shallow:a,locale:o,scroll:i}).then((function(e){e&&i&&document.body.focus()})))}(e,n,b,j,p,O,h,m)},onMouseEnter:function(e){(0,c.isLocalURL)(b)&&(v.props&&"function"===typeof v.props.onMouseEnter&&v.props.onMouseEnter(e),u(n,b,j,{priority:!0}))}};if(e.passHref||"a"===v.type&&!("href"in v.props)){var C="undefined"!==typeof m?m:n&&n.locale,A=(0,c.getDomainLocale)(j,C,n&&n.locales,n&&n.domainLocales);S.href=A||(0,c.addBasePath)((0,c.addLocale)(j,C,n&&n.defaultLocale))}return a.default.cloneElement(v,S)};t.default=d},qa2E:function(e,t,n){"use strict";n.r(t);var s=n("nKUr"),r=n("KQm4");t.default=function(e){var t=e.tiles,n=e.othertiles,a=[].concat(Object(r.a)(t||[]),Object(r.a)(n||[]));return a.sort(),"?"===a[0]&&(a.splice(0,1),a.push("?")),"?"===a[0]&&(a.splice(0,1),a.push("?")),Object(s.jsxs)("div",{className:"pbTilepool",children:[Object(s.jsx)("div",{className:"pbTilepoolTitle",children:"TILES"}),a.map((function(e,t){return Object(s.jsxs)("span",{children:[t>0&&e!==a[t-1]?Object(s.jsx)("span",{className:"pbTilepoolDivider"}):Object(s.jsx)(s.Fragment,{}),Object(s.jsx)("span",{className:"Q"===e?"pbTilepoolTile u":"pbTilepoolTile",children:e})]},"tile".concat(t))}))]})}},rZeA:function(e,t,n){"use strict";n.r(t);var s=n("nKUr"),r=n("A1c0"),a=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],c=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"];t.default=function(e){var t=e.onClick,n=e.squares,i=void 0===n?[]:n,o=e.usedby,l=e.rcd,u=e.racksize,d=function(e){return Object(s.jsxs)("tr",{className:"pbRow",children:[Object(s.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderLeft",children:c[e]}),i[e].map((function(n,a){return function(e,n,a,c){return Object(s.jsx)("td",{className:"pbSquareOuter",children:Object(s.jsx)(r.default,{c:a,ci:n,ri:e,squareusedby:c,rcd:l,onClick:function(){return t(e,n)},racksize:u})},"Square".concat(e,"-").concat(n))}(e,a,n,o[e][a])})),Object(s.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderRight",children:c[e]})]},"BoardRow".concat(e))};return Object(s.jsx)("table",{className:"pbBoard",children:Object(s.jsxs)("tbody",{children:[Object(s.jsxs)("tr",{className:"pbBoardColumnHeaderRow",children:[Object(s.jsx)("td",{className:"pbBoardHeaderTopLeft",children:"\xa0"}),i&&i.map((function(e,t){return Object(s.jsx)("td",{className:"pbBoardColumnHeader",children:a[t]},"TopColumnHeader".concat(t))})),Object(s.jsx)("td",{className:"pbBoardHeaderTopRight",children:"\xa0"})]}),i.map((function(e,t){return d(t)})),Object(s.jsxs)("tr",{className:"pbBoardColumnHeaderRow",id:"BoardHeaderBottom",children:[Object(s.jsx)("td",{className:"pbBoardHeaderBottomLeft",children:"\xa0"}),i.map((function(e,t){return Object(s.jsx)("td",{className:"pbBoardColumnHeader",children:a[t]},"BottomColumnHeader".concat(t))})),Object(s.jsx)("td",{className:"pbBoardHeaderBottomRight",children:"\xa0"})]})]})})}},vNVm:function(e,t,n){"use strict";var s=n("J4zp"),r=n("TqRt");t.__esModule=!0,t.useIntersection=function(e){var t=e.rootMargin,n=e.disabled||!i,r=(0,a.useRef)(),l=(0,a.useState)(!1),u=s(l,2),d=u[0],b=u[1],j=(0,a.useCallback)((function(e){r.current&&(r.current(),r.current=void 0),n||d||e&&e.tagName&&(r.current=function(e,t,n){var s=function(e){var t=e.rootMargin||"",n=o.get(t);if(n)return n;var s=new Map,r=new IntersectionObserver((function(e){e.forEach((function(e){var t=s.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)}))}),e);return o.set(t,n={id:t,observer:r,elements:s}),n}(n),r=s.id,a=s.observer,c=s.elements;return c.set(e,t),a.observe(e),function(){c.delete(e),a.unobserve(e),0===c.size&&(a.disconnect(),o.delete(r))}}(e,(function(e){return e&&b(e)}),{rootMargin:t}))}),[n,t,d]);return(0,a.useEffect)((function(){i||d||(0,c.default)((function(){return b(!0)}))}),[d]),[j,d]};var a=n("q1tI"),c=r(n("0G5g")),i="undefined"!==typeof IntersectionObserver;var o=new Map},yhjZ:function(e,t,n){"use strict";n.r(t);var s=n("nKUr"),r=n("KQm4"),a=n("q1tI"),c=n("YFqc"),i=n.n(c),o=n("NOQH"),l=n("rZeA"),u=n("qa2E"),d=n("KiN8"),b=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],j=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],f=["Escapee: \"I'm free! I'm free!\". Little kid: \"I'm four! I'm four!\"","Two peanuts were walking down a back alley. One was a salted.","The psychic dwarf escaped! There's a small medium at large!","What do you call a vegetable who has escaped prison? An escapea!","The prisoners fave punctuation is a period. It marks the end of a sentence!","Prison is only one word, but to robbers it's a whole sentence."],p=["A","A","A","B","C","D","E","E","E","E","F","G","H","I","I","I","J","K","L","M","N","N","O","O","O","P","Q","R","R","S","T","T","U","V","W","X","Y","Z","?","?"],O=["A","A","A","A","A","B","C","D","D","E","E","E","E","E","E","F","G","H","I","I","I","I","I","J","K","L","L","M","N","N","N","O","O","O","O","P","Q","R","R","R","S","S","T","T","T","U","V","W","X","Y","Z","?","?"],h=["A","A","A","A","A","A","A","B","B","C","C","D","D","D","E","E","E","E","E","E","E","E","E","F","G","G","H","H","I","I","I","I","I","I","I","J","K","L","L","L","M","M","N","N","N","N","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","S","S","S","T","T","T","T","U","U","U","V","W","X","Y","Z","?","?"],m=["A","A","A","A","A","A","A","A","A","B","B","C","C","D","D","D","D","E","E","E","E","E","E","E","E","E","E","E","E","F","F","G","G","G","H","H","I","I","I","I","I","I","I","I","I","J","K","L","L","L","L","M","M","N","N","N","N","N","N","O","O","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","R","S","S","S","S","T","T","T","T","T","T","U","U","U","U","V","V","W","W","X","Y","Y","Z","?","?"],v=".",y="",g="",x=function(e){return Object(s.jsxs)("div",{className:"pbRescuesMade",children:["Rescues made: ",e.rescues]})},w=function(e){var t=e.gameid,n=e.client,c=e.nickname,i=e.msgs,o=e.setMsgs,l=e.prisonersOrGuards,u=Object(a.useState)(""),d=u[0],b=u[1];return Object(s.jsx)("div",{id:"ScrollableChat",className:"pbChat",children:Object(s.jsx)("table",{className:"pbChatTable",children:Object(s.jsxs)("tbody",{children:[i.map((function(e,t){return Object(s.jsxs)("tr",{children:[Object(s.jsx)("td",{className:"pbChatFrom",children:e.from}),Object(s.jsx)("td",{className:"pbChatMsg",children:e.msg})]},"ChatMessage".concat(t))})),Object(s.jsx)("tr",{children:Object(s.jsx)("td",{colSpan:"2",children:Object(s.jsx)("textarea",{className:""===d?"pbChatInputEmpty":"pbChatInput",name:"nextmsgInputArea",value:d,onChange:function(e){b(e.target.value)},onKeyDownCapture:function(e){if("Enter"===e.key&&d.length>0){e.preventDefault();var s=[].concat(Object(r.a)(i),[{from:c,msg:d}]),a=d;return o(s),b(""),void n.send(JSON.stringify({gameid:t,nickname:c,type:"pb",func:"chat",sender:l,sendmsg:a}))}if("Backspace"===e.key&&d.length>0){e.preventDefault();var u=d.slice(0,d.length-1);b(u)}},placeholder:"chat..."})})})]})})})},N=function(e){var t=document.getElementById(e);t.scrollTop=t.scrollHeight};t.default=function(e){var t=e.isrejoin,n=e.prisonersOrGuards,c=e.gameid,k=e.nickname,S=e.wsmessage,C=e.client,A=e.racksize,T=void 0===A?4:A,I=T,E=2*T,q=6===T?h:7===T?m:5===T?O:p,P=Array(E+1).fill(Array(E+1).fill(v)),B=Array(E+1).fill(Array(E+1).fill(y)),R=Object(a.useState)(Object(r.a)(q)),M=R[0],G=R[1],H=Object(a.useState)([]),L=H[0],U=H[1],F=Object(a.useState)([]),D=F[0],J=F[1],K=Object(a.useState)(Object(r.a)(P)),z=K[0],Q=K[1],_=Object(a.useState)(Object(r.a)(B)),X=_[0],Y=_[1],W=Object(a.useState)(-1),V=W[0],Z=W[1],$=Object(a.useState)("P"),ee=$[0],te=$[1],ne=Object(a.useState)([]),se=ne[0],re=ne[1],ae=Object(a.useState)(0),ce=ae[0],ie=ae[1],oe=Object(a.useState)([-1,-1,g]),le=oe[0],ue=oe[1],de=Object(a.useState)([]),be=de[0],je=de[1],fe=Object(a.useState)({squares:Object(r.a)(P),usedby:Object(r.a)(B),ptiles:[],gtiles:[]}),pe=fe[0],Oe=fe[1],he=Object(a.useState)(0),me=he[0],ve=he[1],ye=Object(a.useState)(!1),ge=ye[0],xe=ye[1],we=Object(a.useState)(""),Ne=we[0],ke=we[1],Se=Object(a.useState)([]),Ce=Se[0],Ae=Se[1],Te=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current=e})),t.current}(ce);function Ie(){Z(-1),xe(!1),ue(-1,-1,g),re([])}Object(a.useEffect)((function(){if(ce>Te){var e=document.createElement("audio");e.src="https://tilerunner.github.io/yippee.m4a",e.play()}}),[ce]),Object(a.useEffect)((function(){var e=me+1;e>=f.length&&(e=0),ve(e);var t=setInterval((function(){n!==ee&&"X"!==ee&&De()}),2e4);return function(){return clearInterval(t)}}),[ee]),Object(a.useEffect)((function(){if(t||"P"!==n)try{C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"requestgamedata",sender:n}))}catch(o){}else{for(var e=[],s=[],a=Object(r.a)(q);e.length<T;){var i=Math.floor(Math.random()*a.length);e.push(a[i]),a.splice(i,1),i=Math.floor(Math.random()*a.length),s.push(a[i]),a.splice(i,1)}e.sort(),s.sort(),J(s),U(e),G(a),Oe({squares:Object(r.a)(P),usedby:Object(r.a)(B),ptiles:[].concat(e),gtiles:[].concat(s)}),C.send(JSON.stringify({type:"pb",func:"hello",sender:n,gameid:c,nickname:k,whoseturn:ee,racksize:T}))}}),[]),Object(a.useEffect)((function(){""!==S&&function(e){var t=JSON.parse(e);if("announce"===t.type)C.send(JSON.stringify({type:"pb",func:"hello",sender:n,gameid:c,nickname:k,whoseturn:ee,racksize:T}));else if(t.gameid===c&&"pb"===t.type&&(t.sender!=n&&""===Ne&&t.nickname&&t.nickname.length>0&&ke(t.nickname),"requestgamedata"===t.func&&t.sender!==n&&C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"providegamedata",sender:n,tiles:M,squares:z,ptiles:L,gtiles:D,usedby:X,whoseturn:ee,snapshot:pe,moves:be,rescues:ce,racksize:T,allowRewind:ge})),"providegamedata"===t.func&&t.sender!==n&&(t.moves.length!==be.length||t.tiles.length!==M.length||"G"===n&&0===D.length&&0===se.length||"P"===n&&0===L.length&&0===se.length)&&(G(t.tiles),Q(t.squares),U(t.ptiles),J(t.gtiles),Y(t.usedby),te(t.whoseturn),Oe(t.snapshot),je(t.moves),ie(t.rescues),xe(t.allowRewind)),"ept"===t.func&&"G"===n&&(Ie(),te(t.whoseturn),Q(t.squares),Y(t.usedby),U(t.ptiles),G(t.tiles),je(t.moves),ie(t.rescues),Oe({squares:Object(r.a)(t.squares),usedby:Object(r.a)(t.usedby),ptiles:Object(r.a)(t.ptiles),gtiles:Object(r.a)(D)})),"egt"===t.func&&"P"===n&&(Ie(),te(t.whoseturn),Q(t.squares),Y(t.usedby),J(t.gtiles),G(t.tiles),je(t.moves),Oe({squares:Object(r.a)(t.squares),usedby:Object(r.a)(t.usedby),ptiles:Object(r.a)(L),gtiles:Object(r.a)(t.gtiles)})),"undoturn"===t.func&&t.sender!==n&&(Ie(),G(t.tiles),U(t.ptiles),J(t.gtiles),Q(t.squares),Y(t.usedby),te(t.whoseturn),ie(t.rescues),je(t.moves),Oe(t.snapshot)),"allowundo"===t.func&&t.sender!==n&&xe(!0),"chat"===t.func&&t.sender!=n)){var s=[].concat(Object(r.a)(Ce),[{from:t.nickname,msg:t.sendmsg}]);Ae(s)}}(S)}),[S]),Object(a.useEffect)((function(){N("ScrollableMoves")}),[be]),Object(a.useEffect)((function(){N("ScrollableChat")}),[Ce]);var Ee=function(e,t,n,s){var a=Object(r.a)(z),c=Object(r.a)(X),i=Object(r.a)(L),o=Object(r.a)(D),l=Object(r.a)(z[e]),u=z[e][t],d=Object(r.a)(se),b=String(e)+"-"+String(t),j=se.indexOf(b);if(-1===n&&(n=V,s=le),n>-1&&u===v){l[t]="P"===ee?i[n]:o[n],a[e]=Object(r.a)(l),"P"===ee?i.splice(n,1):o.splice(n,1);var f=Object(r.a)(c[e]);return f[t]=ee,c[e]=Object(r.a)(f),"P"===ee&&n===i.length&&(n-=1),"G"===ee&&n===o.length&&(n-=1),Z(n),Q(a),Y(c),U(i),J(o),re([].concat(Object(r.a)(se),[b])),void ue(s)}if(j>-1){"P"===ee?i.push(u):o.push(u);var p=Object(r.a)(a[e]);p[t]=v,a[e]=Object(r.a)(p);var O=Object(r.a)(c[e]);return O[t]=y,c[e]=Object(r.a)(O),Z("P"===ee?i.length-1:o.length-1),d.splice(j,1),Q(a),Y(c),U(i),J(o),re(d),void ue(-1,-1,g)}if(z[e][t]!==v);else{var h=le[0]!==e||le[1]!==t?"r":"r"===le[2]?"d":"d"===le[2]?g:"r";ue(s=[e,t,h])}},qe=function(e){if(-1!==V)if(V!==e){var t="P"===n?Object(r.a)(L):Object(r.a)(D),s=V,a=t[s],c=e;t.splice(s,1),t.splice(c,0,a),"P"===n?U(t):J(t),Z(-1)}else Z(-1);else Z(e)},Pe=function(){if(Re()){for(var e=Ge(),t=ce,s=["0-0","0-"+I,"0-"+E,I+"-0",I+"-"+E,E+"-0",E+"-"+I,E+"-"+E],a=0;a<se.length;a++)s.indexOf(se[a])>-1&&(t+=1);for(var i=Object(r.a)(L),o=Object(r.a)(M);i.length<T&&o.length>0;){var l=Math.floor(Math.random()*o.length);i.push(o[l]),o.splice(l,1)}i.sort();var u=i.length>0?"G":"X";X[0][0]!==y&&X[0][I]!==y&&X[0][E]!==y&&X[I][0]!==y&&X[I][E]!==y&&X[E][0]!==y&&X[E][I]!==y&&X[E][E]!==y&&(u="X");var d=Me(),b={by:"P",type:"PLAY",rewindInfo:e,mainword:d.mainword,extrawords:d.extrawords,pos:d.pos},j=[].concat(Object(r.a)(be),[b]);Ie(),te(u),U(i),G(o),je(j),ie(t),Oe({squares:Object(r.a)(z),usedby:Object(r.a)(X),ptiles:Object(r.a)(i),gtiles:Object(r.a)(D)}),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"ept",sender:n,squares:z,usedby:X,ptiles:i,tiles:o,whoseturn:u,racksize:T,moves:j,rescues:t}))}},Be=function(){if(Re()){for(var e=Ge(),t=Object(r.a)(D),s=Object(r.a)(M);t.length<T&&s.length>0;){var a=Math.floor(Math.random()*s.length);t.push(s[a]),s.splice(a,1)}t.sort();var i=Object(r.a)(z),o=Object(r.a)(X),l=Object(r.a)(L),u=Object(r.a)(D),d=t.length>0?"P":"X";X[0][0]!==y&&X[0][I]!==y&&X[0][E]!==y&&X[I][0]!==y&&X[I][E]!==y&&X[E][0]!==y&&X[E][I]!==y&&X[E][E]!==y&&(d="X");var b=Me(),j={by:"G",type:"PLAY",rewindInfo:e,mainword:b.mainword,extrawords:b.extrawords,pos:b.pos},f=[].concat(Object(r.a)(be),[j]);Ie(),te(d),J(t),G(s),je(f),Oe({squares:i,usedby:o,ptiles:l,gtiles:u}),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"egt",sender:n,squares:z,usedby:X,gtiles:t,tiles:s,moves:f,whoseturn:d,racksize:T}))}};function Re(){if(z[I][I]===v)return window.alert("First play must hit center square"),!1;for(var e=E+1,t=E+1,n=e,s=-1,r=t,a=-1,c=0;c<e;++c)for(var i=0;i<t;++i)if(z[c][i]!==v){if(!(c>0&&z[c-1][i]!==v)&&!(i>0&&z[c][i-1]!==v)&&!(c<E&&z[c+1][i]!==v)&&!(i<E&&z[c][i+1]!==v))return window.alert("Each played tile must be part of a word"),!1;pe.squares[c][i]===v&&(c<n&&(n=c),c>s&&(s=c),i<r&&(r=i),i>a&&(a=i))}if(n===e)return window.alert("You didn't play any tiles"),!1;if(n!==s&&r!==a)return window.alert("Tiles played must be in a straight line"),!1;var o=!1,l=!1;for(c=n;c<=s;++c)for(i=r;i<=a;++i){if(z[c][i]===v)return window.alert("There is a gap in your word"),!1;pe.squares[c][i]!==v&&(o=!0),n===s&&c>0&&z[c-1][i]!==v&&(l=!0),n===s&&c<E&&z[c+1][i]!==v&&(l=!0),r===a&&i>0&&z[c][i-1]!==v&&(l=!0),r===a&&i<E&&z[c][i+1]!==v&&(l=!0)}return n===s&&r>0&&pe.squares[n][r-1]!==v&&(o=!0),n===s&&a<E&&pe.squares[n][a+1]!==v&&(o=!0),r===a&&n>0&&pe.squares[n-1][r]!==v&&(o=!0),r===a&&s<E&&pe.squares[s+1][r]!==v&&(o=!0),!(!o&&!l&&pe.squares[I][I]!==v)||(window.alert("Words must be connected"),!1)}function Me(){for(var e="",t=[],n="",s=E+1,a=-1,c=E+1,i=-1,o=se.length,l=0;l<o;++l){var u=parseInt(se[l].split("-")[0]),d=parseInt(se[l].split("-")[1]);u<s&&(s=u),u>a&&(a=u),d<c&&(c=d),d>i&&(i=d)}if(s<a||1===o){for(var f=c,p=s;p>0&&z[p-1][f]!==v;)p-=1;for(var O=a;O<E&&z[O+1][f]!==v;)O+=1;n=b[f]+j[p];for(var h=p;h<=O;++h){e+=z[h][f];var m=h+"-"+f;if(se.indexOf(m)>-1){for(var y=f;y>0&&z[h][y-1]!==v;)y-=1;for(var g=f;g<E&&z[h][g+1]!==v;)g+=1;if(y<g){for(var x="",w=y;w<=g;++w)x+=z[h][w];t=[].concat(Object(r.a)(t),[x])}}}}if(e.length<2){for(var N=s,k=c;k>0&&z[N][k-1]!==v;)k-=1;for(var S=i;S<E&&z[N][S+1]!==v;)S+=1;n=j[N]+b[k],e="",t=[];for(var C=k;C<=S;++C){e+=z[N][C];var A=N+"-"+C;if(se.indexOf(A)>-1){for(var T=N;T>0&&z[T-1][C]!==v;)T-=1;for(var I=N;I<E&&z[I+1][C]!==v;)I+=1;if(T<I){for(var q="",P=T;P<=I;++P)q+=z[P][C];t=[].concat(Object(r.a)(t),[q])}}}}return{mainword:e,extrawords:t,pos:n}}function Ge(){return{squares:Object(r.a)(pe.squares),usedby:Object(r.a)(pe.usedby),rack:"G"===ee?Object(r.a)(pe.gtiles):Object(r.a)(pe.ptiles),tiles:Object(r.a)(M),rescues:ce}}function He(){ge||(xe(!0),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"allowundo",racksize:T,sender:n})))}function Le(){var e=be.length,t=be[be.length-1],s=Object(r.a)(t.rewindInfo.squares),a=Object(r.a)(t.rewindInfo.usedby),i=Object(r.a)(t.rewindInfo.tiles),o="P"===t.by?Object(r.a)(t.rewindInfo.rack):Object(r.a)(L),l="G"===t.by?Object(r.a)(t.rewindInfo.rack):Object(r.a)(D),u=t.rewindInfo.rescues,d=t.by,b=Object(r.a)(be);b.splice(e-1,1);var j={squares:Object(r.a)(s),usedby:Object(r.a)(a),gtiles:Object(r.a)(l),ptiles:Object(r.a)(o)};Ie(),G(i),U(o),J(l),Q(s),Y(a),te(d),ie(u),je(b),Oe(j),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"undoturn",racksize:T,sender:n,tiles:i,ptiles:o,gtiles:l,squares:s,usedby:a,whoseturn:d,rescues:u,moves:b,snapshot:j}))}var Ue=function(){Q(Object(r.a)(pe.squares)),Y(Object(r.a)(pe.usedby)),U(Object(r.a)(pe.ptiles)),J(Object(r.a)(pe.gtiles)),Z(-1),re([]),ue([-1,-1,g])};function Fe(e){var t=e.length-1,n=t-1;return n>-1&&"PASS"===e[n].type&&"PASS"===e[t].type}var De=function(){C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",sender:n,whoseturn:ee,racksize:T,func:"requestgamedata"}))};return Object(s.jsxs)("div",{className:"prisonbreak",children:[Object(s.jsxs)("div",{className:"w3-display-container w3-teal topBarHeight",children:[Object(s.jsx)("div",{className:"w3-display-middle",children:Object(s.jsx)("h1",{className:"myHeadingFont",children:"Prison Break"})}),Object(s.jsxs)("div",{className:"w3-display-topleft w3-black topBarCorner commonFontFamily",children:["Game id: ",c]}),Object(s.jsxs)("div",{className:"w3-display-bottomleft w3-orange topBarCorner commonFontFamily",children:["Prisoners: ","P"===n?k:Ne]}),Object(s.jsx)("div",{className:"w3-display-topright w3-black topBarCorner commonFontFamily",children:Object(s.jsx)(i.a,{href:"../../",children:Object(s.jsx)("a",{children:Object(s.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})})}),Object(s.jsxs)("div",{className:"w3-display-bottomright w3-orange topBarCorner commonFontFamily",children:["Guards: ","P"===n?Ne:k]})]}),Object(s.jsxs)("div",{className:"row",children:[Object(s.jsxs)("div",{className:"col pbTileAndMovesOuter",children:[Object(s.jsx)(u.default,{tiles:M,othertiles:"P"===n?D:L}),Object(s.jsx)(d.default,{moves:be})]}),Object(s.jsx)("div",{className:"col pbPlayerOuterSection",children:"P"===n?Object(s.jsx)(o.default,{racktiles:L,whoseturn:ee,selection:V,onClick:function(e){return qe(e)},onClickFinishTurn:function(){return Pe()},onClickTileRecall:function(){return Ue()},onClickTileExchange:function(){return function(){if(M.length<T)window.alert("Need "+T+" tiles in the bag to exchange");else{for(var e=Ge(),t=[],s=Object(r.a)(M);t.length<T&&s.length>0;){var a=Math.floor(Math.random()*s.length);t.push(s[a]),s.splice(a,1)}t.sort(),(s=[].concat(Object(r.a)(s),Object(r.a)(pe.ptiles))).sort();var i={by:"P",type:"SWAP",rewindInfo:e},o=[].concat(Object(r.a)(be),[i]);Ie(),Q(Object(r.a)(pe.squares)),Y(Object(r.a)(pe.usedby)),te("G"),U(t),G(s),je(o),Oe({squares:Object(r.a)(pe.squares),usedby:Object(r.a)(pe.usedby),ptiles:[].concat(t),gtiles:Object(r.a)(D)}),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"ept",sender:n,whoseturn:"G",racksize:T,squares:pe.squares,usedby:pe.usedby,ptiles:t,tiles:s,moves:o,rescues:ce}))}}()},onClickPassPlay:function(){return function(){var e={by:"P",type:"PASS",rewindInfo:Ge()},t=[].concat(Object(r.a)(be),[e]),s=Fe(t)?"X":"G";Ue(),Ie(),te(s),je(t),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"ept",sender:n,squares:pe.squares,usedby:pe.usedby,ptiles:pe.ptiles,tiles:M,whoseturn:s,racksize:T,moves:t,rescues:ce}))}()},onClickUndoLastPlay:function(){return Le()},onClickAllowUndo:function(){return He()},prisonersOrGuards:n,moves:be,allowRewind:ge}):Object(s.jsx)(o.default,{racktiles:D,whoseturn:ee,selection:V,onClick:function(e){return qe(e)},onClickFinishTurn:function(){return Be()},onClickTileRecall:function(){return Ue()},onClickTileExchange:function(){return function(){if(M.length<T)window.alert("Need "+T+" tiles in the bag to exchange");else{for(var e=Ge(),t=[],s=Object(r.a)(M);t.length<T&&s.length>0;){var a=Math.floor(Math.random()*s.length);t.push(s[a]),s.splice(a,1)}t.sort(),(s=[].concat(Object(r.a)(s),Object(r.a)(pe.gtiles))).sort();var i={by:"G",type:"SWAP",rewindInfo:e},o=[].concat(Object(r.a)(be),[i]);Ie(),Q(Object(r.a)(pe.squares)),Y(Object(r.a)(pe.usedby)),te("P"),J(t),G(s),je(o),Oe({squares:Object(r.a)(pe.squares),usedby:Object(r.a)(pe.usedby),ptiles:Object(r.a)(L),gtiles:[].concat(t)}),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"egt",sender:n,whoseturn:"P",racksize:T,squares:pe.squares,usedby:pe.usedby,gtiles:t,tiles:s,moves:o}))}}()},onClickPassPlay:function(){return function(){var e={by:"G",type:"PASS",rewindInfo:Ge()},t=[].concat(Object(r.a)(be),[e]),s=Fe(t)?"X":"P";Ue(),Ie(),te(s),je(t),C.send(JSON.stringify({gameid:c,nickname:k,type:"pb",func:"egt",sender:n,squares:pe.squares,usedby:pe.usedby,gtiles:pe.gtiles,tiles:M,whoseturn:s,racksize:T,moves:t}))}()},onClickUndoLastPlay:function(){return Le()},onClickAllowUndo:function(){return He()},prisonersOrGuards:n,moves:be,allowRewind:ge})}),Object(s.jsx)("div",{className:"col",children:n===ee?Object(s.jsx)("div",{className:"row",onKeyDownCapture:function(e){if(e.preventDefault(),n===ee)if("Enter"!==e.key)if("Escape"!==e.key){if(e.key.match(/^[A-Za-z\?]$/)){var t=e.key.toUpperCase(),s="P"===ee?L:D,a=s.indexOf(t);if(-1===a&&(a=s.indexOf("?")),a>-1){var c=le[0],i=le[1],o=le[2];if(c>-1&&i>-1&&o!==g){if("r"===o){for(var l=-1,u=i+1;u<E+1&&-1===l;u++)z[c][u]===v&&(l=u);return Ee(c,i,a,-1===l?[-1,-1,g]:[c,l,"r"]),void Z(-1)}if("d"===o){for(var d=-1,b=2*T+1,j=c+1;j<b&&-1===d;j++)z[j][i]===v&&(d=j);return Ee(c,i,a,-1===d?[-1,-1,g]:[d,i,"d"]),void Z(-1)}}}}else if("Backspace"===e.key&&se.length>0){var f=se[se.length-1],p=Object(r.a)(se),O=Object(r.a)(L),h=Object(r.a)(D),m=Object(r.a)(X),x=Object(r.a)(z),w=[-1,-1,g],N=V;p.splice(se.length-1,1);var k=parseInt(f.split("-")[0]),S=parseInt(f.split("-")[1]),C=z[k][S];"P"===ee?(O.push(C),N=O.length-1):(h.push(C),N=h.length-1),m[k][S]=y,x[k][S]=v;var A=le[2];A!==g&&(w=[k,S,A],1===se.length&&(N=-1)),re(p),J(h),U(O),Q(x),Y(m),ue(w),Z(N)}}else Ue();else"P"===ee?Pe():Be()},children:Object(s.jsx)(l.default,{squares:z,usedby:X,rcd:le,onClick:function(e,t){return Ee(e,t,-1,null)},racksize:T})}):Object(s.jsx)("div",{className:"row",children:Object(s.jsx)(l.default,{squares:z,usedby:X,rcd:le,onClick:function(){},racksize:T})})}),Object(s.jsxs)("div",{className:"col",children:[Object(s.jsx)(x,{rescues:ce}),Object(s.jsx)(w,{gameid:c,client:C,nickname:k,msgs:Ce,setMsgs:Ae,prisonersOrGuards:n})]})]}),Object(s.jsx)("div",{className:"w3-display-container w3-teal topBarHeight",children:Object(s.jsx)("div",{className:"w3-display-middle commonFontFamily",children:"X"===ee?Object(s.jsx)("h1",{children:"Game Over!"}):Object(s.jsx)("p",{children:f[me]})})})]})}}}]);