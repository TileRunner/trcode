(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{2389:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var i=t(5893),n=t(1385),a=t(7294),c=t(3625),r=t(8520),o=t(9477),l=t(798),u=t(7666),m=t(6595),d=t(1489),h=t(4946);var p=t(3939),f=function(e){var s="pbTileOnRack Unselected "+("Q"===e.tilevalue?"u ":"")+e.participant;return(0,i.jsx)("div",{className:s,children:(0,i.jsx)("div",{className:"pbTileOnRackText",children:e.tilevalue})},e.tileindex)},v=function(e){var s=e.setWhereto,t=e.client,v=e.wsmessage,k=e.gameid,w=e.nickname,x=e.participant,j=(0,a.useState)(0),y=j[0],b=j[1],g=(0,a.useState)({pname:"loading...",gname:"loading...",moves:[],snapshots:[{tiles:[],ptiles:[],gtiles:[],rescues:0,whoseturn:"P"}]}),N=g[0],S=g[1],T=(0,a.useState)([]),F=T[0],C=T[1];(0,a.useEffect)((function(){t.send({gameid:k,type:"pb",sender:m.Vj,func:"startExamining"})}),[]),(0,a.useEffect)((function(){""!==v&&function(e){var s=JSON.parse(e);if(s.gameid===k&&"pb"===s.type){if("providegamedata"===s.func){var t=function(e){for(var s=[],t=e,i="",n="",a="",c=(0,d.$)(t.racksize),r=[],o=0,l=0;l<t.events.length;l++){var u=t.events[l];if(u.ptiles&&(i=u.ptiles),u.gtiles&&(n=u.gtiles),"STARTGAME"!==u.type&&u.type!==m.bS&&u.type!==m.Ix||(a=u.tiles),u.type===m.bS||u.type===m.Ix||u.type===m.Am){var p={by:u.by,type:u.type};if(u.type===m.bS){p.mainword=u.mainword,p.extrawords=u.extrawords.split(","),p.pos=u.pos,u.by===m.ap&&(o=u.rescues);for(var f=(0,h.F)(u.pos),v=f.row,k=f.col,w=0;w<u.mainword.length;w++){var x=c[v][k];x.usedby===m.i4&&(x.usedby=u.by,x.letter=u.mainword[w]),f.dir===m.oW?k++:v++}}r.push(p)}s.push({tiles:a.split(""),squareArray:JSON.parse(JSON.stringify(c)),ptiles:i.split(""),gtiles:n.split(""),rescues:o,whoseturn:u.whoseturn})}return{pname:t.pname,gname:t.gname,moves:r,racksize:t.racksize,snapshots:s}}(s.apidata);S(t)}if("chat"===s.func){var i=[].concat((0,n.Z)(F),[{from:s.nickname,msg:s.sendmsg}]);C(i)}}}(v)}),[v]),(0,a.useEffect)((function(){(0,p.O)("ScrollableChat")}),[F]);var _=function(){y+1<N.snapshots.length&&b(y+1)},O=function(){return N.snapshots[y].whoseturn===m.kX},A=function(){return N.snapshots[y].whoseturn===m.Ov};return(0,i.jsxs)("div",{className:"prisonbreak",children:[(0,i.jsxs)("div",{className:"w3-display-container w3-teal topBarHeight",children:[(0,i.jsx)("div",{className:"w3-display-middle",children:(0,i.jsx)("h1",{className:"myHeadingFont",children:"Prison Break"})}),(0,i.jsxs)("div",{className:"w3-display-topleft w3-black topBarCorner commonFontFamily",children:["Game id: ",k]}),(0,i.jsxs)("div",{className:"w3-display-bottomleft w3-orange topBarCorner commonFontFamily",children:["Prisoners: ",N.pname]}),(0,i.jsx)("div",{className:"w3-display-topright w3-black topBarCorner commonFontFamily",children:(0,i.jsx)("button",{className:"w3-button",onClick:function(){s("menu")},children:(0,i.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})}),(0,i.jsxs)("div",{className:"w3-display-bottomright w3-orange topBarCorner commonFontFamily",children:["Guards: ",N.gname]})]}),(0,i.jsxs)("div",{className:"row",children:[(0,i.jsxs)("div",{className:"col pbTileAndMovesOuter",children:[(0,i.jsx)(r.default,{tiles:N.snapshots[y].tiles,othertiles:O()?N.snapshots[y].gtiles:A()?N.snapshots[y].ptiles:[]}),(0,i.jsx)(o.default,{moves:N.moves.slice(0,y),onmoveclick:function(e){return function(e){var s=e;e+1<N.snapshots.length&&b(s)}(e)}})]}),(0,i.jsx)("div",{className:"col pbPlayerOuterSection",children:(0,i.jsxs)("div",{className:"pbPlayerInnerSection",children:[(0,i.jsxs)("div",{className:"pbPlayerTitle",children:[(0,i.jsx)("i",{className:"material-icons",children:m._k}),"\xa0",m.Ji,"\xa0",(0,i.jsx)("i",{className:"material-icons",children:m._k})]}),(0,i.jsxs)("div",{className:"pbTilerack",children:[N.snapshots[y].whoseturn===m.ap&&(0,i.jsx)("div",{className:"pbTilerackArrow",onClick:_}),N.snapshots[y].ptiles.map((function(e,s){return(0,i.jsx)(f,{participant:m.ap,tilevalue:A()?"*":e,tileindex:s},"ObserverPrisonersRackTile".concat(s))}))]}),(0,i.jsxs)("div",{className:"pbPlayerTitle",children:[(0,i.jsx)("i",{className:"material-icons",children:m.g9}),"\xa0",m.jN,"\xa0",(0,i.jsx)("i",{className:"material-icons",children:m.g9})]}),(0,i.jsxs)("div",{className:"pbTilerack",children:[N.snapshots[y].whoseturn===m.b6&&(0,i.jsx)("div",{className:"pbTilerackArrow",onClick:_}),N.snapshots[y].gtiles.map((function(e,s){return(0,i.jsx)(f,{participant:m.b6,tilevalue:O()?"*":e,tileindex:s},"ObserverGuardsRackTile".concat(s))}))]})]})}),(0,i.jsx)("div",{className:"col",children:(0,i.jsx)("div",{className:"row",children:(0,i.jsx)(c.default,{squareArray:N.snapshots[y].squareArray,rcd:[-1,-1,m.QY],onClick:function(e,s){return function(e,s){for(var t=-1,i=0;i<N.snapshots.length;i++){var n=N.snapshots[i];-1===t&&n.squareArray[e][s].usedby!==m.i4&&(t=i)}t>0&&b(t-1)}(e,s)}})})}),(0,i.jsxs)("div",{className:"col",children:[(0,i.jsx)(l.default,{rescues:N.snapshots[y].rescues}),(0,i.jsx)(u.default,{gameid:k,client:t,nickname:w,msgs:F,setMsgs:C,participant:x})]})]}),(0,i.jsxs)("div",{className:"w3-display-container w3-teal examineFooterHeight",children:[(0,i.jsx)("div",{className:"w3-display-middle commonFontFamily",children:(0,i.jsxs)("div",{children:[y>0&&(0,i.jsx)("button",{className:"w3-black w3-round",onClick:function(){b(0)},children:(0,i.jsx)("i",{className:"material-icons",children:"fast_rewind"})}),y>0&&(0,i.jsx)("button",{className:"w3-black w3-round",onClick:function(){y-1>-1&&b(y-1)},children:(0,i.jsx)("i",{className:"material-icons",children:"arrow_left"})}),y<N.snapshots.length-1&&(0,i.jsx)("button",{className:"w3-black w3-round",onClick:_,children:(0,i.jsx)("i",{className:"material-icons",children:"arrow_right"})}),y<N.snapshots.length-1&&(0,i.jsx)("button",{className:"w3-black w3-round",onClick:function(){var e=N.snapshots.length-1;b(e)},children:(0,i.jsx)("i",{className:"material-icons",children:"fast_forward"})})]})}),(0,i.jsx)("div",{className:"w3-display-topleft commonFontFamily",children:(0,i.jsx)("p",{children:"\xa0Click on a move in the move list to jump to where it was played"})}),(0,i.jsx)("div",{className:"w3-display-bottomleft commonFontFamily",children:(0,i.jsx)("p",{children:"\xa0Click on a tile on the board to jump to where it was played"})}),(0,i.jsx)("div",{className:"w3-display-topright commonFontFamily",children:(0,i.jsxs)("div",{className:"pbTilerack",children:["Click on the ",(0,i.jsx)("span",{className:"pbTilerackArrowInFooter",children:" "})," by the rack to advance one move\xa0"]})})]})]})}},3019:function(e,s,t){"use strict";t.r(s);var i=t(5893),n=t(7294),a=t(5518),c=t(5916),r=t(7678),o=t(2389),l=t(6595),u=t(5877);s.default=function(e){var s=e.setWhereto,t=(0,n.useState)((0,u.v4)())[0],m=(0,n.useState)(!1),d=m[0],h=m[1],p=(0,n.useState)(""),f=p[0],v=p[1],k=(0,n.useState)(""),w=k[0],x=k[1],j=(0,n.useState)(l.dK),y=j[0],b=j[1],g=(0,n.useState)(""),N=g[0],S=g[1],T=(0,n.useState)(4),F=T[0],C=T[1],_="wss://tilerunner.herokuapp.com/?clientType=pb&thisisme="+t,O=(0,n.useState)(new a.Z(_,(function(e){S(e.data)}),"pb",t))[0];return(0,n.useEffect)((function(){return O.connect()}),[]),y===l.dK?(0,i.jsx)(c.default,{setWhereto:s,client:O,setIsrejoin:h,wsmessage:N,gameid:f,setGameid:v,nickname:w,setNickname:x,setParticipant:b,racksize:F,setRacksize:C}):y===l.Vj?(0,i.jsx)(o.default,{setWhereto:s,client:O,wsmessage:N,gameid:f,nickname:w,participant:y}):(0,i.jsx)(r.default,{setWhereto:s,isrejoin:d,participant:y,gameid:f,nickname:w,wsmessage:N,client:O,racksize:F})}},5518:function(e,s,t){"use strict";t.d(s,{Z:function(){return c}});var i=t(4047),n=t(2700),a=function(){function e(s,t){(0,i.Z)(this,e),this.callback=s,this.timerCalc=t,this.timer=null,this.tries=0}return(0,n.Z)(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),c=function(){function e(s,t,n,c){var r=this;(0,i.Z)(this,e),this.customSocket=null,this.socketUrl=s,this.clientType=n,this.thisisme=c,this.reconnectTimer=new a((function(){r.disconnect(),r.connect()}),this.reconnectAfterMs),this.messageFunction=t}return(0,n.Z)(e,[{key:"reconnectAfterMs",value:function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4}},{key:"connect",value:function(){var e=this;this.customSocket=new WebSocket(this.socketUrl),this.customSocket.onopen=function(s){e.send({type:e.clientType,func:"announce",thisisme:e.thisisme})},this.customSocket.onclose=function(s){e.reconnectTimer.scheduleTimeout()},this.customSocket.onerror=function(e){},this.customSocket.onmessage=this.messageFunction}},{key:"disconnect",value:function(){this.customSocket.onclose=function(){},this.customSocket.close()}},{key:"send",value:function(e){e.thisisme=this.thisisme,e.clientType=this.clientType;var s=JSON.stringify(e);this.customSocket.send(s)}}]),e}()},2137:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pb/prisonbreak",function(){return t(3019)}])}},function(e){e.O(0,[357,678,916,774,888,179],(function(){return s=2137,e(e.s=s);var s}));var s=e.O();_N_E=s}]);