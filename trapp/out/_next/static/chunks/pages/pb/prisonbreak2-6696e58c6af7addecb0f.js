_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[9],{"2Skw":function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pb/prisonbreak2",function(){return s("UOmD")}])},KQm4:function(e,t,s){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function c(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return n(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}s.d(t,"a",(function(){return c}))},UOmD:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return k}));var n=s("nKUr"),c=s("KQm4"),a=s("q1tI"),r=s("YFqc"),i=s.n(r);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,s){return t&&l(e.prototype,t),s&&l(e,s),e}var d=function(){function e(t,s){o(this,e),this.callback=t,this.timerCalc=s,this.timer=null,this.tries=0}return u(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),b=function(){function e(t,s){var n=this;o(this,e),this.customSocket=null,this.socketUrl=t,this.reconnectTimer=new d((function(){n.disconnect(),n.connect()}),this.reconnectAfterMs),this.messageFunction=s}return u(e,[{key:"reconnectAfterMs",value:function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4}},{key:"connect",value:function(){var e=this;this.customSocket=new WebSocket(this.socketUrl),this.customSocket.onopen=function(t){console.log("connected to "+e.socketUrl),e.send(JSON.stringify({type:"announce",func:"announce"}))},this.customSocket.onclose=function(t){e.reconnectTimer.scheduleTimeout()},this.customSocket.onerror=function(e){},this.customSocket.onmessage=this.messageFunction}},{key:"disconnect",value:function(){this.customSocket.onclose=function(){},this.customSocket.close()}},{key:"send",value:function(e){this.customSocket.send(JSON.stringify(e))}}]),e}(),j=["Escapee: \"I'm free! I'm free!\". Little kid: \"I'm four! I'm four!\"","Two peanuts were walking down a back alley. One was a salted."],h=["A","A","A","A","A","B","C","D","D","E","E","E","E","E","E","F","G","H","I","I","I","I","I","J","K","L","L","M","N","N","N","O","O","O","O","P","Q","R","R","R","S","S","T","T","T","U","V","W","X","Y","Z","?","?"],p=["A","A","A","A","A","A","A","B","B","C","C","D","D","D","E","E","E","E","E","E","E","E","E","F","G","G","H","H","I","I","I","I","I","I","I","J","K","L","L","L","M","M","N","N","N","N","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","S","S","S","T","T","T","T","U","U","U","V","W","X","Y","Z","?","?"],m=["A","A","A","A","A","A","A","A","A","B","B","C","C","D","D","D","D","E","E","E","E","E","E","E","E","E","E","E","E","F","F","G","G","G","H","H","I","I","I","I","I","I","I","I","I","J","K","L","L","L","L","M","M","N","N","N","N","N","N","O","O","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","R","S","S","S","S","T","T","T","T","T","T","U","U","U","U","V","V","W","W","X","Y","Y","Z","?","?"],f=".",O="",g="";function k(){var e=Object(a.useState)(!1),t=e[0],s=e[1],c=Object(a.useState)(""),r=c[0],i=c[1],o=Object(a.useState)(""),l=o[0],u=o[1],d=Object(a.useState)(""),j=d[0],h=d[1],p=Object(a.useState)(""),m=p[0],f=p[1],O=Object(a.useState)(!1),g=O[0],k=O[1],x=Object(a.useState)(6),v=x[0],w=x[1],S=Object(a.useState)(new b("wss://tilerunner.herokuapp.com",(function(e){f(e.data)})))[0];return Object(a.useEffect)((function(){return S.connect()}),[]),""===j?Object(n.jsx)(y,{setIsrejoin:s,wsmessage:m,gameid:r,setGameid:i,nickname:l,setNickname:u,setPrisonersOrGuards:h,upsidedownMode:g,setUpsidedownMode:k,racksize:v,setRacksize:w}):Object(n.jsx)(N,{isrejoin:t,prisonersOrGuards:j,gameid:r,nickname:l,wsmessage:m,client:S,upsidedownMode:g,racksize:v})}var y=function(e){var t=e.setIsrejoin,s=e.wsmessage,r=e.gameid,o=e.setGameid,l=e.nickname,u=e.setNickname,d=e.setPrisonersOrGuards,b=e.upsidedownMode,j=e.setUpsidedownMode,h=e.racksize,p=e.setRacksize,m=Object(a.useState)([]),f=m[0],O=m[1];function g(e){for(var t=0;t<f.length;++t)if(f[t].gameid===e)return t;return-1}function k(e){return 0===l.length||"Game over"===e.gamestatus?0:e.playingP?e.nicknameP===l?3:0:1}function y(e){return 0===l.length||"Game over"===e.gamestatus?0:e.playingG?e.nicknameG===l?3:0:2}function x(e){p(e)}return Object(a.useEffect)((function(){""!==s&&function(e){try{var t=JSON.parse(e),s=t.gameid,n=t.nickname,a=t.whoseturn,r=t.racksize;if(s&&s.length>0&&r&&a&&a.length>0){var i=!1,o=t.sender,l=Object(c.a)(f),u=g(s),d="P"===o||u>-1&&f[u].playingP,b="G"===o||u>-1&&f[u].playingG,j=r,h="Unknown";"X"===a?h="Game over":"P"===a?h="Prisoners turn":"G"===a&&(h="Guards turn");var p={gameid:s,nicknameP:"P"===o?n:u>-1?f[u].nicknameP:"",nicknameG:"G"===o?n:u>-1?f[u].nicknameG:"",gamestatus:h,playingP:d,playingG:b,racksize:j};if(u<0)i=!0,l=[].concat(Object(c.a)(l),[p]);else{var m=f[u];m.nicknameP===p.nicknameP&&m.nicknameG===p.nicknameG&&m.gamestatus===p.gamestatus&&m.playingP===p.playingP&&m.playingG===p.playingG&&m.racksize===p.racksize||(i=!0,l[u]=p)}i&&O(l)}}catch(k){window.alert("Error processing lobby message")}}(s)}),[s]),Object(n.jsxs)("div",{className:"container-fluid",children:[Object(n.jsxs)("div",{className:"row",children:[Object(n.jsxs)("div",{className:"col-10 pbtitle",children:["Prison Break Lobby",Object(n.jsx)("span",{className:"material-icons",children:"run_circle"})]}),Object(n.jsx)("div",{className:"col-2 pbhomelink",children:Object(n.jsx)(i.a,{href:"../../",children:Object(n.jsx)("a",{children:Object(n.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})})})]}),Object(n.jsxs)("div",{className:"row",children:[Object(n.jsxs)("div",{className:"col-10 offset-1 h2",children:[Object(n.jsx)("label",{children:"*Nickname:\xa0"}),Object(n.jsx)("input",{name:"nickname",value:l,onChange:function(e){u(e.target.value)}}),Object(n.jsx)("span",{children:"\xa0(*required)"})]}),Object(n.jsxs)("div",{class:"custom-control custom-checkbox h3 col offset-2",children:[Object(n.jsx)("input",{type:"checkbox",id:"upsidedownModeCheckbox",className:"custom-control-input",value:b,onChange:function(){j((function(e){return!e}))}}),Object(n.jsx)("label",{className:"custom-control-label",for:"upsidedownModeCheckbox",children:"\xa0Upside board on opponents turn"})]})]}),Object(n.jsx)("div",{className:"row",children:Object(n.jsxs)("div",{className:"col-7 offset-1",children:[Object(n.jsx)("hr",{}),Object(n.jsx)("span",{className:"pbPlayerTitle h2",children:"\xa0PRISONERS\xa0"}),Object(n.jsx)("span",{className:"h3",children:'\xa0\xa0Enter a game id, select options and click "Start Game".'})]})}),Object(n.jsx)("div",{className:"row",children:Object(n.jsx)("div",{className:"col-7 offset-1",children:Object(n.jsxs)("span",{class:"h2",children:[Object(n.jsx)("span",{class:"h1",children:"\xa0"}),"\xa0\xa0\xa0Game id:\xa0",Object(n.jsx)("input",{name:"gameid",value:r,onChange:function(e){o(e.target.value)}}),Object(n.jsx)("button",{id:"startgame",className:"pbLobbyActionButton",onClick:function(){r.length>0&&(!function(e){var t=g(e);return!(t<0)&&f[t].playingP}(r)?d("P"):window.alert("Prisoners already playing that game"))},children:"Start Game"})]})})}),Object(n.jsx)("div",{className:"row",children:Object(n.jsxs)("div",{className:"col offset-1",children:[Object(n.jsx)("span",{className:"h2",children:"\xa0\xa0\xa0Rack size:"}),Object(n.jsx)("button",{id:"selectracksize6",className:5===h?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return x(5)},children:"5"}),Object(n.jsx)("button",{id:"selectracksize6",className:6===h?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return x(6)},children:"6"}),Object(n.jsx)("button",{id:"selectracksize7",className:7===h?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return x(7)},children:"7"}),Object(n.jsx)("span",{className:"h2",children:"(rack size determines board size too)"})]})}),Object(n.jsx)("div",{className:"row",children:Object(n.jsxs)("div",{className:"col-7 offset-1",children:[Object(n.jsx)("hr",{}),Object(n.jsxs)("span",{className:"pbPlayerTitle h2",children:[Object(n.jsx)("i",{className:"material-icons",children:"security"}),"GUARDS",Object(n.jsx)("i",{className:"material-icons",children:"security"})]}),Object(n.jsx)("span",{className:"h3",children:'\xa0\xa0Find and click the "Join Game" button for your game.'}),Object(n.jsx)("hr",{}),Object(n.jsx)("h3",{children:'If you lost connection, find and click the "Reconnect" button for your game id.'})]})}),Object(n.jsx)("div",{className:"row",children:Object(n.jsx)("div",{className:"col offset-1",children:Object(n.jsx)("h1",{children:"Game list:"})})}),Object(n.jsx)("div",{className:"row",children:Object(n.jsx)("div",{className:"col offset-2",children:Object(n.jsxs)("table",{children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{className:"pbLobbyGamesHeader",children:[Object(n.jsx)("th",{className:"pbLobbyGamesHeaderCol",children:"Game ID"}),Object(n.jsx)("th",{className:"pbLobbyGamesHeaderCol",colSpan:"2",children:"Prisoners"}),Object(n.jsx)("th",{className:"pbLobbyGamesHeaderCol",colSpan:"2",children:"Guards"}),Object(n.jsx)("th",{className:"pbLobbyGamesHeaderCol",children:"Rack size"}),Object(n.jsx)("th",{className:"pbLobbyGamesHeaderCol",children:"Game status"})]})}),Object(n.jsx)("tbody",{children:f.map((function(e,s){return Object(n.jsxs)("tr",{className:"pbGamesInProgressRow",children:[Object(n.jsx)("td",{className:"pbLobbyGameid",children:e.gameid}),Object(n.jsx)("td",{className:"pbLobbyPlayerIndicator",children:Object(n.jsx)("span",{className:"material-icons",children:e.playingP?"check_circle":"cancel"})}),0===k(e)?Object(n.jsx)("td",{className:"pbLobbyActionNone",children:"No action available"}):3===k(e)?Object(n.jsx)("td",{id:"PrisonersRejoin".concat(s),children:Object(n.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){t(!0),o(e.gameid),d("P"),p(e.racksize)},children:"Reconnect"})}):Object(n.jsx)("td",{id:"PrisonersStart".concat(s),children:Object(n.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){o(e.gameid),d("P")},children:"Start Game"})}),Object(n.jsx)("td",{className:"pbLobbyPlayerIndicator",children:Object(n.jsx)("span",{className:"material-icons",children:e.playingG?"check_circle":"cancel"})}),0===y(e)?Object(n.jsx)("td",{className:"pbLobbyActionNone",children:"No action available"}):3===y(e)?Object(n.jsx)("td",{id:"GuardsRejoin".concat(s),children:Object(n.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){t(!0),o(e.gameid),d("G"),p(e.racksize)},children:"Reconnect"})}):Object(n.jsx)("td",{id:"GuardsJoin".concat(s),children:Object(n.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){o(e.gameid),d("G"),p(e.racksize)},children:"Join Game"})}),Object(n.jsx)("td",{className:"pbLobbyGameRacksize",children:e.racksize}),Object(n.jsx)("td",{className:"pbLobbyGameStatus",children:e.gamestatus})]},"OtherGame".concat(s))}))})]})})})]})},x=function(e){var t=2*e.racksize,s=e.racksize,c="Q"===e.c?" u":"",a="P"===e.squareusedby?"pbSquareUsedByPrisoners"+c:"pbSquareUsedByGuards"+c,r=e.c!==f?a:e.rcd[0]===e.ri&&e.rcd[1]===e.ci&&"r"===e.rcd[2]?"pbSquareRightArrow":e.rcd[0]===e.ri&&e.rcd[1]===e.ci&&"d"===e.rcd[2]?"pbSquareDownArrow":e.ri===s&&e.ci===s?"pbSquareCenterSquare":0!==e.ri&&e.ri!==s&&e.ri!==t||0!==e.ci&&e.ci!==s&&e.ci!==t?e.ri%2===e.ci%2?"pbSquare1":"pbSquare2":"pbSquareEscapeHatch",i=e.c!==f?e.c:"pbSquareRightArrow"===r?"\u27a1":"pbSquareDownArrow"===r?"\u2b07":"pbSquareCenterSquare"===r?Object(n.jsx)("i",{className:"material-icons",children:"stars"}):"pbSquareEscapeHatch"===r?"\ua415":(e.ri,e.ci,".");return"pbSquareEscapeHatch"===r?Object(n.jsx)("button",{className:r,onClick:e.onClick,children:Object(n.jsx)("span",{className:"material-icons",children:"run_circle"})}):Object(n.jsx)("button",{className:r,onClick:e.onClick,children:i})},v=function(e){var t=e.onClick,s=e.squares,c=e.usedby,a=e.rcd,r=e.racksize,i=function(e){return Object(n.jsx)("tr",{className:"pbRow",children:s[e].map((function(s,i){return function(e,s,c,i){return Object(n.jsx)("td",{className:"pbSquare",children:Object(n.jsx)(x,{c:c,ci:s,ri:e,squareusedby:i,rcd:a,onClick:function(){return t(e,s)},racksize:r})},"Square".concat(e,"-").concat(s))}(e,i,s,c[e][i])}))},"BoardRow".concat(e))};return Object(n.jsx)("table",{className:"pbBoard",children:Object(n.jsx)("tbody",{children:s.map((function(e,t){return i(t)}))})})},N=function(e){var t=e.isrejoin,s=e.prisonersOrGuards,r=e.gameid,o=e.nickname,l=e.wsmessage,u=e.client,d=e.upsidedownMode,b=e.racksize,k=b,y=2*b,x=6===b?p:7===b?m:h,N=Array(y+1).fill(Array(y+1).fill(f)),S=Array(y+1).fill(Array(y+1).fill(O)),G=Object(a.useState)(Object(c.a)(x)),C=G[0],P=G[1],T=Object(a.useState)([]),R=T[0],A=T[1],z=Object(a.useState)([]),L=z[0],M=z[1],B=Object(a.useState)(Object(c.a)(N)),U=B[0],_=B[1],J=Object(a.useState)(Object(c.a)(S)),D=J[0],H=J[1],F=Object(a.useState)(-1),X=F[0],K=F[1],Q=Object(a.useState)("P"),Y=Q[0],V=Q[1],W=Object(a.useState)([]),Z=W[0],$=W[1],ee=Object(a.useState)(0),te=ee[0],se=ee[1],ne=Object(a.useState)([-1,-1,g]),ce=ne[0],ae=ne[1],re=Object(a.useState)(!1),ie=re[0],oe=re[1],le=Object(a.useState)({squares:Object(c.a)(N),usedby:Object(c.a)(S),ptiles:[],gtiles:[]}),ue=le[0],de=le[1],be=Object(a.useState)(""),je=be[0],he=be[1],pe=Object(a.useState)([{from:"Fred",msg:"Hello Betty"},{from:"Betty",msg:"Hi Fred"}]),me=pe[0],fe=pe[1];Object(a.useEffect)((function(){var e=setInterval((function(){s!==Y&&"X"!==Y&&(console.log("Interval: prisonersOrGuards="+s+" whoseturn="+Y+" at "+Date().toLocaleString()),ve())}),2e4);return function(){return clearInterval(e)}}),[Y]),Object(a.useEffect)((function(){if(t||"P"!==s)try{u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"requestgamedata",sender:s}))}catch(l){}else{for(var e=[],n=[],a=Object(c.a)(x);e.length<b;){var i=Math.floor(Math.random()*a.length);e.push(a[i]),a.splice(i,1),i=Math.floor(Math.random()*a.length),n.push(a[i]),a.splice(i,1)}e.sort(),n.sort(),M(n),A(e),P(a),de({squares:Object(c.a)(N),usedby:Object(c.a)(S),ptiles:[].concat(e),gtiles:[].concat(n)}),u.send(JSON.stringify({type:"pb",func:"hello",sender:s,gameid:r,nickname:o,whoseturn:Y,racksize:b}))}}),[]),Object(a.useEffect)((function(){""!==l&&function(e){var t=JSON.parse(e);if("announce"===t.type)u.send(JSON.stringify({type:"pb",func:"hello",sender:s,gameid:r,nickname:o,whoseturn:Y,racksize:b}));else if(t.gameid===r&&"pb"===t.type&&(t.sender!=s&&""===je&&t.nickname&&t.nickname.length>0&&he(t.nickname),"requestgamedata"===t.func&&t.sender!==s&&u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"providegamedata",sender:s,tiles:C,squares:U,ptiles:R,gtiles:L,usedby:D,whoseturn:Y,selection:X,currentcoords:Z,snapshot:ue,passed:ie,rescues:te,racksize:b})),"providegamedata"===t.func&&t.sender!==s&&Y!==s&&"X"!==Y&&(P(t.tiles),_(t.squares),A(t.ptiles),M(t.gtiles),H(t.usedby),V(t.whoseturn),K(t.selection),$(t.currentcoords),de(t.snapshot),oe(t.passed),se(t.rescues)),"ept"===t.func&&(V(t.whoseturn),K(-1),ae(-1,-1,g),$([]),_(t.squares),H(t.usedby),A(t.ptiles),P(t.tiles),oe(t.passed),se(t.rescues),de({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(t.ptiles),gtiles:Object(c.a)(L)})),"egt"===t.func&&(V(t.whoseturn),K(-1),ae(-1,-1,g),$([]),_(t.squares),H(t.usedby),M(t.gtiles),P(t.tiles),oe(t.passed),de({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(R),gtiles:Object(c.a)(t.gtiles)})),"chat"===t.func&&t.sender!=s)){var n=[].concat(Object(c.a)(me),[{from:t.nickname,msg:t.sendmsg}]);fe(n)}}(l)}),[l]);var Oe=function(e,t,s,n){var a=Object(c.a)(U),r=Object(c.a)(D),i=Object(c.a)(R),o=Object(c.a)(L),l=Object(c.a)(U[e]),u=U[e][t],d=Object(c.a)(Z),b=String(e)+"-"+String(t),j=Z.indexOf(b);if(-1===s&&(s=X,n=ce),s>-1&&u===f){l[t]="P"===Y?i[s]:o[s],a[e]=Object(c.a)(l),"P"===Y?i.splice(s,1):o.splice(s,1);var h=Object(c.a)(r[e]);return h[t]=Y,r[e]=Object(c.a)(h),"P"===Y&&s===i.length&&(s-=1),"G"===Y&&s===o.length&&(s-=1),K(s),_(a),H(r),A(i),M(o),$([].concat(Object(c.a)(Z),[b])),void ae(n)}if(j>-1){"P"===Y?i.push(u):o.push(u);var p=Object(c.a)(a[e]);p[t]=f,a[e]=Object(c.a)(p);var m=Object(c.a)(r[e]);return m[t]=O,r[e]=Object(c.a)(m),K("P"===Y?i.length-1:o.length-1),d.splice(j,1),_(a),H(r),A(i),M(o),$(d),void ae(-1,-1,g)}if(U[e][t]!==f);else{var k=ce[0]!==e||ce[1]!==t?"r":"r"===ce[2]?"d":"d"===ce[2]?g:"r";ae(n=[e,t,k])}},ge=function(){if(ye()){for(var e=te,t=["0-0","0-"+k,"0-"+y,k+"-0",k+"-"+y,y+"-0",y+"-"+k,y+"-"+y],n=0;n<Z.length;n++)t.indexOf(Z[n])>-1&&(e+=1);for(var a=Object(c.a)(R),i=Object(c.a)(C);a.length<b&&i.length>0;){var l=Math.floor(Math.random()*i.length);a.push(i[l]),i.splice(l,1)}a.sort();var d=a.length>0?"G":"X";D[0][0]!==O&&D[0][k]!==O&&D[0][y]!==O&&D[k][0]!==O&&D[k][y]!==O&&D[y][0]!==O&&D[y][k]!==O&&D[y][y]!==O&&(d="X"),V(d),K(-1),$([]),A(a),P(i),oe(!1),se(e),de({squares:Object(c.a)(U),usedby:Object(c.a)(D),ptiles:Object(c.a)(a),gtiles:Object(c.a)(L)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:s,squares:U,usedby:D,ptiles:a,tiles:i,whoseturn:d,racksize:b,passed:!1,rescues:e}))}},ke=function(){if(ye()){for(var e=Object(c.a)(L),t=Object(c.a)(C);e.length<b&&t.length>0;){var n=Math.floor(Math.random()*t.length);e.push(t[n]),t.splice(n,1)}e.sort();var a=Object(c.a)(U),i=Object(c.a)(D),l=Object(c.a)(R),d=Object(c.a)(L),j=e.length>0?"P":"X";D[0][0]!==O&&D[0][k]!==O&&D[0][y]!==O&&D[k][0]!==O&&D[k][y]!==O&&D[y][0]!==O&&D[y][k]!==O&&D[y][y]!==O&&(j="X"),V(j),K(-1),$([]),M(e),P(t),oe(!1),de({squares:a,usedby:i,ptiles:l,gtiles:d}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:s,squares:U,usedby:D,gtiles:e,tiles:t,passed:!1,whoseturn:j,racksize:b}))}};function ye(){if(U[k][k]===f)return window.alert("First play must hit center square"),!1;for(var e=y+1,t=y+1,s=e,n=-1,c=t,a=-1,r=0;r<e;++r)for(var i=0;i<t;++i)if(U[r][i]!==f){if(!(r>0&&U[r-1][i]!==f)&&!(i>0&&U[r][i-1]!==f)&&!(r<y&&U[r+1][i]!==f)&&!(i<y&&U[r][i+1]!==f))return window.alert("Each played tile must be part of a word"),!1;ue.squares[r][i]===f&&(r<s&&(s=r),r>n&&(n=r),i<c&&(c=i),i>a&&(a=i))}if(s===e)return window.alert("You didn't play any tiles"),!1;if(s!==n&&c!==a)return window.alert("Tiles played must be in a straight line"),!1;var o=!1,l=!1;for(r=s;r<=n;++r)for(i=c;i<=a;++i){if(U[r][i]===f)return window.alert("There is a gap in your word"),!1;ue.squares[r][i]!==f&&(o=!0),s===n&&r>0&&U[r-1][i]!==f&&(l=!0),s===n&&r<y&&U[r+1][i]!==f&&(l=!0),c===a&&i>0&&U[r][i-1]!==f&&(l=!0),c===a&&i<y&&U[r][i+1]!==f&&(l=!0)}return s===n&&c>0&&ue.squares[s][c-1]!==f&&(o=!0),s===n&&a<y&&ue.squares[s][a+1]!==f&&(o=!0),c===a&&s>0&&ue.squares[s-1][c]!==f&&(o=!0),c===a&&n<y&&ue.squares[n+1][c]!==f&&(o=!0),!(!o&&!l&&ue.squares[k][k]!==f)||(window.alert("Words must be connected"),!1)}var xe=function(){_(Object(c.a)(ue.squares)),H(Object(c.a)(ue.usedby)),A(Object(c.a)(ue.ptiles)),M(Object(c.a)(ue.gtiles)),K(-1),$([])},ve=function(){u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",sender:s,whoseturn:Y,racksize:b,func:"requestgamedata"}))};return Object(n.jsxs)("div",{className:"container-fluid prisonbreak",children:[Object(n.jsxs)("div",{className:"row",children:[Object(n.jsxs)("div",{className:"col-2 pbGameid",children:["Game id: ",r,Object(n.jsx)("br",{}),"Nickname: ",o]}),Object(n.jsxs)("div",{className:"col-8 pbtitle",children:["Prison Break",Object(n.jsx)("span",{className:"material-icons",children:"run_circle"})]}),Object(n.jsxs)("div",{className:"col-2 pbhomelink",children:[Object(n.jsx)(i.a,{href:"../../",children:Object(n.jsx)("a",{children:Object(n.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})}),Object(n.jsx)("br",{}),"Opponent: ",je]})]}),Object(n.jsxs)("div",{className:"row",children:[Object(n.jsx)("div",{className:"col-2 pbPrisoners",children:Object(n.jsx)(q,{ptiles:R,whoseturn:Y,selection:X,onClick:function(e){return t=e,void("P"===Y?K(t):alert("It is not your turn"));var t},onClickFinishTurn:function(){return ge()},onClickTileRecall:function(){return xe()},onClickTileExchange:function(){return function(){if(C.length<b)window.alert("Need "+b+" tiles in the bag to exchange");else{for(var e=[],t=Object(c.a)(C);e.length<b&&t.length>0;){var n=Math.floor(Math.random()*t.length);e.push(t[n]),t.splice(n,1)}e.sort(),(t=[].concat(Object(c.a)(t),Object(c.a)(ue.ptiles))).sort(),_(Object(c.a)(ue.squares)),H(Object(c.a)(ue.usedby)),V("G"),K(-1),$([]),A(e),P(t),oe(!1),de({squares:Object(c.a)(ue.squares),usedby:Object(c.a)(ue.usedby),ptiles:[].concat(e),gtiles:Object(c.a)(L)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:s,whoseturn:"G",racksize:b,squares:ue.squares,usedby:ue.usedby,ptiles:e,tiles:t,passed:!1,rescues:te}))}}()},onClickPassPlay:function(){return function(){xe();var e=ie?"X":"G";V(e),oe(!0),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:s,squares:ue.squares,usedby:ue.usedby,ptiles:ue.ptiles,tiles:C,whoseturn:e,racksize:b,passed:!0,rescues:te}))}()},rescues:te,prisonersOrGuards:s})}),Object(n.jsxs)("div",{className:"col",children:[s===Y?Object(n.jsx)("div",{className:"row",onKeyDownCapture:function(e){if(e.preventDefault(),s===Y)if("Enter"!==e.key){if(e.key.match(/^[A-Za-z\?]$/)){var t=e.key.toUpperCase(),n="P"===Y?R:L,a=n.indexOf(t);if(-1===a&&(a=n.indexOf("?")),a>-1){var r=ce[0],i=ce[1],o=ce[2];if(r>-1&&i>-1&&o!==g){if("r"===o){for(var l=-1,u=i+1;u<y+1&&-1===l;u++)U[r][u]===f&&(l=u);return void Oe(r,i,a,-1===l?[-1,-1,g]:[r,l,"r"])}if("d"===o){for(var d=-1,j=2*b+1,h=r+1;h<j&&-1===d;h++)U[h][i]===f&&(d=h);return void Oe(r,i,a,-1===d?[-1,-1,g]:[d,i,"d"])}}}}else if("Backspace"===e.key&&Z.length>0){var p=Z[Z.length-1],m=Object(c.a)(Z),k=Object(c.a)(R),x=Object(c.a)(L),v=Object(c.a)(D),N=Object(c.a)(U),w=[-1,-1,g],S=X;m.splice(Z.length-1,1);var G=parseInt(p.split("-")[0]),C=parseInt(p.split("-")[1]),P=U[G][C];"P"===Y?(k.push(P),S=k.length-1):(x.push(P),S=x.length-1),v[G][C]=O,N[G][C]=f;var T=ce[2];T!==g&&(w=[G,C,T],1===Z.length&&(S=-1)),$(m),M(x),A(k),_(N),H(v),ae(w),K(S)}}else"P"===Y?ge():ke()},children:Object(n.jsx)(v,{squares:U,usedby:D,rcd:ce,onClick:function(e,t){return Oe(e,t,-1,null)},racksize:b})}):"X"!==Y&&d?Object(n.jsx)("div",{className:"row upsidedown",children:Object(n.jsx)(v,{squares:U,usedby:D,rcd:ce,onClick:function(){},racksize:b})}):Object(n.jsx)("div",{className:"row",children:Object(n.jsx)(v,{squares:U,usedby:D,rcd:ce,onClick:function(){},racksize:b})}),Object(n.jsx)("div",{className:"row pbUnderboard",children:"X"===Y?Object(n.jsx)("h1",{children:"Game Over!"}):Object(n.jsx)("p",{children:"P"===Y?j[0]:j[1]})})]}),Object(n.jsx)("div",{className:"col-2 pbGuards",children:Object(n.jsx)(E,{gtiles:L,whoseturn:Y,selection:X,onClick:function(e){return t=e,void("G"===Y?K(t):alert("It is not your turn"));var t},onClickFinishTurn:function(){return ke()},onClickTileRecall:function(){return xe()},onClickTileExchange:function(){return function(){if(C.length<b)window.alert("Need "+b+" tiles in the bag to exchange");else{for(var e=[],t=Object(c.a)(C);e.length<b&&t.length>0;){var n=Math.floor(Math.random()*t.length);e.push(t[n]),t.splice(n,1)}e.sort(),(t=[].concat(Object(c.a)(t),Object(c.a)(ue.gtiles))).sort(),_(Object(c.a)(ue.squares)),H(Object(c.a)(ue.usedby)),V("P"),K(-1),$([]),M(e),P(t),oe(!1),de({squares:Object(c.a)(ue.squares),usedby:Object(c.a)(ue.usedby),ptiles:Object(c.a)(R),gtiles:[].concat(e)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:s,whoseturn:"P",racksize:b,squares:ue.squares,usedby:ue.usedby,gtiles:e,tiles:t,passed:!1}))}}()},onClickPassPlay:function(){return function(){xe();var e=ie?"X":"P";V(e),oe(!0),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:s,squares:ue.squares,usedby:ue.usedby,gtiles:ue.gtiles,tiles:C,whoseturn:e,racksize:b,passed:!0}))}()},prisonersOrGuards:s})}),Object(n.jsx)("div",{className:"col-1",children:Object(n.jsx)(w,{tiles:C,othertiles:"P"===s?L:R})}),Object(n.jsx)("div",{className:"col-3",children:Object(n.jsx)(I,{gameid:r,client:u,nickname:o,msgs:me,setMsgs:fe,prisonersOrGuards:s})})]})]})},w=function(e){var t=[].concat(Object(c.a)(e.tiles),Object(c.a)(e.othertiles));return t.sort(),"?"===t[0]&&(t.splice(0,1),t.push("?")),"?"===t[0]&&(t.splice(0,1),t.push("?")),Object(n.jsxs)("div",{className:"pbTilepool",children:[Object(n.jsx)("span",{className:"pbTilepoolTitle",children:"TILES"}),Object(n.jsx)("div",{className:"pbTilepoolDivider"}),t.map((function(e,s){return Object(n.jsxs)("span",{children:[s>0&&e!==t[s-1]?Object(n.jsx)("div",{className:"pbTilepoolDivider"}):Object(n.jsx)(n.Fragment,{}),Object(n.jsx)("span",{className:"Q"===e?"pbTilepoolTile u":"pbTilepoolTile",children:e})]},"tile".concat(s))}))]})},S=function(e){return Object(n.jsx)("span",{className:e.tileclass,onClick:e.onClick,children:e.tilevalue})},G=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"check"}),"\xa0Finish Turn"]})})},C=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"undo"}),"\xa0Recall Tiles"]})})},P=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"cached"}),"\xa0Swap Tiles"]})})},T=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"not_interested"}),"\xa0Pass Turn"]})})},q=function(e){var t,s=R(e);return Object(n.jsxs)("div",{children:[Object(n.jsxs)("p",{className:"pbPlayerTitle",children:[Object(n.jsx)("i",{className:"material-icons",children:"run_circle run_circle run_circle"}),"\xa0PRISONERS\xa0",Object(n.jsx)("i",{className:"material-icons",children:"run_circle run_circle run_circle"})]}),Object(n.jsx)("p",{className:"pbTilerack",children:e.ptiles.map((function(t,n){return s("P"===e.whoseturn&&e.selection===n?"Q"===t&&"P"===e.prisonersOrGuards?"pbTileOnRackSelectedP u":"pbTileOnRackSelectedP":"Q"===t&&"P"===e.prisonersOrGuards?"pbTileOnRackP u":"pbTileOnRackP",n,"P"===e.prisonersOrGuards?t:"*")}))}),"P"===e.whoseturn&&"P"===e.prisonersOrGuards?A(e):Object(n.jsx)(n.Fragment,{}),Object(n.jsxs)("p",{children:["Rescues made: ",e.rescues,Object(n.jsx)("br",{}),(t=e.rescues,Array(t).fill("nonsense").map((function(e,t){return Object(n.jsx)("span",{"data-toggle":"tooltip",title:"I'm free! I'm free!",children:Object(n.jsx)("img",{src:"/breakfree.png",alt:"I'm free! I'm free!",width:"100",height:"100"})},e+String(t))})))]})]})},E=function(e){var t=R(e);return Object(n.jsxs)("div",{children:[Object(n.jsxs)("p",{className:"pbPlayerTitle",children:[Object(n.jsx)("i",{className:"material-icons",children:"security security security"}),"\xa0GUARDS\xa0",Object(n.jsx)("i",{className:"material-icons",children:"security security security"})]}),Object(n.jsx)("p",{className:"pbTilerack",children:e.gtiles.map((function(s,n){return t("G"===e.whoseturn&&e.selection===n?"Q"===s&&"G"===e.prisonersOrGuards?"pbTileOnRackSelectedG u":"pbTileOnRackSelectedG":"Q"===s&&"G"===e.prisonersOrGuards?"pbTileOnRackG u":"pbTileOnRackG",n,"G"===e.prisonersOrGuards?s:"*")}))}),"G"===e.whoseturn&&"G"===e.prisonersOrGuards?A(e):Object(n.jsx)(n.Fragment,{})]})};function R(e){return function(t,s,c){return"*"!==c?Object(n.jsx)(S,{tileclass:t,tilevalue:c,onClick:function(){return e.onClick(s)}},t+String(s)):Object(n.jsx)(S,{tileclass:t,tilevalue:c,onClick:function(){return window.alert("No peeking!")}},t+String(s))}}function A(e){return Object(n.jsxs)("div",{className:"pbActionButtonDiv",children:[Object(n.jsx)("p",{children:Object(n.jsx)(G,{onClick:function(){return e.onClickFinishTurn()}})}),Object(n.jsx)("p",{children:Object(n.jsx)(C,{onClick:function(){return e.onClickTileRecall()}})}),Object(n.jsx)("p",{children:Object(n.jsx)(P,{onClick:function(){return e.onClickTileExchange()}})}),Object(n.jsx)("p",{children:Object(n.jsx)(T,{onClick:function(){return e.onClickPassPlay()}})})]})}var I=function(e){var t=e.gameid,s=e.client,r=e.nickname,i=e.msgs,o=e.setMsgs,l=e.prisonersOrGuards,u=Object(a.useState)(""),d=u[0],b=u[1];return Object(n.jsxs)("div",{className:"pbChat",children:[Object(n.jsx)("span",{className:"pbChatTitle",children:"Chatter box"}),Object(n.jsx)("table",{children:Object(n.jsxs)("tbody",{children:[i.filter((function(e,t){return i.length-t<15})).map((function(e,t){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{className:"pbChatFrom",children:e.from}),Object(n.jsx)("td",{className:"pbChatMsg",children:e.msg})]},"ChatMessage".concat(t))})),Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{className:"pbChatInputPrompt",children:"Message:"}),Object(n.jsx)("td",{children:Object(n.jsx)("input",{className:"pbChatInput",name:"nextmsg",value:d,onKeyDownCapture:function(e){if(e.preventDefault(),"Enter"===e.key&&d.length>0){var n=[].concat(Object(c.a)(i),[{from:r,msg:d}]),a=d;return o(n),b(""),void s.send(JSON.stringify({gameid:t,nickname:r,type:"pb",func:"chat",sender:l,sendmsg:a}))}if(e.key.match(/^[A-Za-z0-9 \.,\(\)\?]$/)){var u=d+e.key;b(u)}if("Backspace"===e.key&&d.length>0){var j=d.slice(0,d.length-1);b(j)}}})})]})]})})]})}},YFqc:function(e,t,s){e.exports=s("cTJO")},cTJO:function(e,t,s){"use strict";var n=s("J4zp"),c=s("284h");t.__esModule=!0,t.default=void 0;var a=c(s("q1tI")),r=s("elyg"),i=s("nOHt"),o=s("vNVm"),l={};function u(e,t,s,n){if(e&&(0,r.isLocalURL)(t)){e.prefetch(t,s,n).catch((function(e){0}));var c=n&&"undefined"!==typeof n.locale?n.locale:e&&e.locale;l[t+"%"+s+(c?"%"+c:"")]=!0}}var d=function(e){var t=!1!==e.prefetch,s=(0,i.useRouter)(),c=s&&s.pathname||"/",d=a.default.useMemo((function(){var t=(0,r.resolveHref)(c,e.href,!0),s=n(t,2),a=s[0],i=s[1];return{href:a,as:e.as?(0,r.resolveHref)(c,e.as):i||a}}),[c,e.href,e.as]),b=d.href,j=d.as,h=e.children,p=e.replace,m=e.shallow,f=e.scroll,O=e.locale;"string"===typeof h&&(h=a.default.createElement("a",null,h));var g=a.Children.only(h),k=g&&"object"===typeof g&&g.ref,y=(0,o.useIntersection)({rootMargin:"200px"}),x=n(y,2),v=x[0],N=x[1],w=a.default.useCallback((function(e){v(e),k&&("function"===typeof k?k(e):"object"===typeof k&&(k.current=e))}),[k,v]);(0,a.useEffect)((function(){var e=N&&t&&(0,r.isLocalURL)(b),n="undefined"!==typeof O?O:s&&s.locale,c=l[b+"%"+j+(n?"%"+n:"")];e&&!c&&u(s,b,j,{locale:n})}),[j,b,N,O,t,s]);var S={ref:w,onClick:function(e){g.props&&"function"===typeof g.props.onClick&&g.props.onClick(e),e.defaultPrevented||function(e,t,s,n,c,a,i,o){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&(0,r.isLocalURL)(s))&&(e.preventDefault(),null==i&&(i=n.indexOf("#")<0),t[c?"replace":"push"](s,n,{shallow:a,locale:o,scroll:i}).then((function(e){e&&i&&document.body.focus()})))}(e,s,b,j,p,m,f,O)},onMouseEnter:function(e){(0,r.isLocalURL)(b)&&(g.props&&"function"===typeof g.props.onMouseEnter&&g.props.onMouseEnter(e),u(s,b,j,{priority:!0}))}};if(e.passHref||"a"===g.type&&!("href"in g.props)){var G="undefined"!==typeof O?O:s&&s.locale,C=(0,r.getDomainLocale)(j,G,s&&s.locales,s&&s.domainLocales);S.href=C||(0,r.addBasePath)((0,r.addLocale)(j,G,s&&s.defaultLocale))}return a.default.cloneElement(g,S)};t.default=d},vNVm:function(e,t,s){"use strict";var n=s("J4zp"),c=s("TqRt");t.__esModule=!0,t.useIntersection=function(e){var t=e.rootMargin,s=e.disabled||!i,c=(0,a.useRef)(),l=(0,a.useState)(!1),u=n(l,2),d=u[0],b=u[1],j=(0,a.useCallback)((function(e){c.current&&(c.current(),c.current=void 0),s||d||e&&e.tagName&&(c.current=function(e,t,s){var n=function(e){var t=e.rootMargin||"",s=o.get(t);if(s)return s;var n=new Map,c=new IntersectionObserver((function(e){e.forEach((function(e){var t=n.get(e.target),s=e.isIntersecting||e.intersectionRatio>0;t&&s&&t(s)}))}),e);return o.set(t,s={id:t,observer:c,elements:n}),s}(s),c=n.id,a=n.observer,r=n.elements;return r.set(e,t),a.observe(e),function(){r.delete(e),a.unobserve(e),0===r.size&&(a.disconnect(),o.delete(c))}}(e,(function(e){return e&&b(e)}),{rootMargin:t}))}),[s,t,d]);return(0,a.useEffect)((function(){i||d||(0,r.default)((function(){return b(!0)}))}),[d]),[j,d]};var a=s("q1tI"),r=c(s("0G5g")),i="undefined"!==typeof IntersectionObserver;var o=new Map}},[["2Skw",0,2,1,3]]]);