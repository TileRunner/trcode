_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[9],{"2Skw":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pb/prisonbreak2",function(){return n("UOmD")}])},KQm4:function(e,t,n){"use strict";function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function c(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,"a",(function(){return c}))},UOmD:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return y}));var s=n("nKUr"),c=n("KQm4"),a=n("q1tI"),r=n("YFqc"),i=n.n(r);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function u(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}var b=function(){function e(t,n){o(this,e),this.callback=t,this.timerCalc=n,this.timer=null,this.tries=0}return u(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),d=function(){function e(t,n){var s=this;o(this,e),this.customSocket=null,this.socketUrl=t,this.reconnectTimer=new b((function(){s.disconnect(),s.connect()}),this.reconnectAfterMs),this.messageFunction=n}return u(e,[{key:"reconnectAfterMs",value:function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4}},{key:"connect",value:function(){var e=this;this.customSocket=new WebSocket(this.socketUrl),this.customSocket.onopen=function(t){console.log("connected to "+e.socketUrl),e.send(JSON.stringify({type:"announce",func:"announce"}))},this.customSocket.onclose=function(t){e.reconnectTimer.scheduleTimeout()},this.customSocket.onerror=function(e){},this.customSocket.onmessage=this.messageFunction}},{key:"disconnect",value:function(){this.customSocket.onclose=function(){},this.customSocket.close()}},{key:"send",value:function(e){this.customSocket.send(JSON.stringify(e))}}]),e}(),j=["Escapee: \"I'm free! I'm free!\". Little kid: \"I'm four! I'm four!\"","Two peanuts were walking down a back alley. One was a salted."],p=["A","A","A","B","C","D","E","E","E","E","F","G","H","I","I","I","J","K","L","M","N","N","O","O","O","P","Q","R","R","S","T","T","U","V","W","X","Y","Z","?","?"],m=["A","A","A","A","A","B","C","D","D","E","E","E","E","E","E","F","G","H","I","I","I","I","I","J","K","L","L","M","N","N","N","O","O","O","O","P","Q","R","R","R","S","S","T","T","T","U","V","W","X","Y","Z","?","?"],f=["A","A","A","A","A","A","A","B","B","C","C","D","D","D","E","E","E","E","E","E","E","E","E","F","G","G","H","H","I","I","I","I","I","I","I","J","K","L","L","L","M","M","N","N","N","N","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","S","S","S","T","T","T","T","U","U","U","V","W","X","Y","Z","?","?"],O=["A","A","A","A","A","A","A","A","A","B","B","C","C","D","D","D","D","E","E","E","E","E","E","E","E","E","E","E","E","F","F","G","G","G","H","H","I","I","I","I","I","I","I","I","I","J","K","L","L","L","L","M","M","N","N","N","N","N","N","O","O","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","R","S","S","S","S","T","T","T","T","T","T","U","U","U","U","V","V","W","W","X","Y","Y","Z","?","?"],h=".",g="",v="";function y(){var e=Object(a.useState)(!1),t=e[0],n=e[1],c=Object(a.useState)(""),r=c[0],i=c[1],o=Object(a.useState)(""),l=o[0],u=o[1],b=Object(a.useState)(""),j=b[0],p=b[1],m=Object(a.useState)(""),f=m[0],O=m[1],h=Object(a.useState)(!1),g=h[0],v=h[1],y=Object(a.useState)(4),x=y[0],N=y[1],w=Object(a.useState)(new d("wss://tilerunner.herokuapp.com",(function(e){O(e.data)})))[0];return Object(a.useEffect)((function(){return w.connect()}),[]),""===j?Object(s.jsx)(k,{setIsrejoin:n,wsmessage:f,gameid:r,setGameid:i,nickname:l,setNickname:u,setPrisonersOrGuards:p,upsidedownMode:g,setUpsidedownMode:v,racksize:x,setRacksize:N}):Object(s.jsx)(S,{isrejoin:t,prisonersOrGuards:j,gameid:r,nickname:l,wsmessage:f,client:w,upsidedownMode:g,racksize:x})}var k=function(e){var t=e.setIsrejoin,n=e.wsmessage,r=e.gameid,o=e.setGameid,l=e.nickname,u=e.setNickname,b=e.setPrisonersOrGuards,d=e.upsidedownMode,j=e.setUpsidedownMode,p=e.racksize,m=e.setRacksize,f=Object(a.useState)([]),O=f[0],h=f[1];function g(e){for(var t=0;t<O.length;++t)if(O[t].gameid===e)return t;return-1}function v(e){return 0===l.length||"Game over"===e.gamestatus?0:e.playingP?e.nicknameP===l?3:0:1}function y(e){return 0===l.length||"Game over"===e.gamestatus?0:e.playingG?e.nicknameG===l?3:0:2}function k(e){m(e)}return Object(a.useEffect)((function(){""!==n&&function(e){try{var t=JSON.parse(e),n=t.gameid,s=t.nickname,a=t.whoseturn,r=t.racksize;if(n&&n.length>0&&r&&a&&a.length>0){var i=!1,o=t.sender,l=Object(c.a)(O),u=g(n),b="P"===o||u>-1&&O[u].playingP,d="G"===o||u>-1&&O[u].playingG,j=r,p="Unknown";"X"===a?p="Game over":"P"===a?p="Prisoners turn":"G"===a&&(p="Guards turn");var m={gameid:n,nicknameP:"P"===o?s:u>-1?O[u].nicknameP:"",nicknameG:"G"===o?s:u>-1?O[u].nicknameG:"",gamestatus:p,playingP:b,playingG:d,racksize:j};if(u<0)i=!0,l=[].concat(Object(c.a)(l),[m]);else{var f=O[u];f.nicknameP===m.nicknameP&&f.nicknameG===m.nicknameG&&f.gamestatus===m.gamestatus&&f.playingP===m.playingP&&f.playingG===m.playingG&&f.racksize===m.racksize||(i=!0,l[u]=m)}i&&h(l)}}catch(v){window.alert("Error processing lobby message")}}(n)}),[n]),Object(s.jsxs)("div",{className:"container-fluid",children:[Object(s.jsxs)("div",{className:"row",children:[Object(s.jsxs)("div",{className:"col-10 pbtitle",children:["Prison Break Lobby",Object(s.jsx)("span",{className:"material-icons",children:"run_circle"})]}),Object(s.jsx)("div",{className:"col-2 pbhomelink",children:Object(s.jsx)(i.a,{href:"../../",children:Object(s.jsx)("a",{children:Object(s.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})})})]}),Object(s.jsx)("div",{className:"row pbLobbyCommonInfoSection",children:Object(s.jsxs)("div",{className:"col",children:[Object(s.jsx)("label",{className:"pbLobbyNicknamePrompt",children:"Nickname"}),Object(s.jsx)("input",{className:"pbLobbyNicknameInput",name:"nickname",value:l,onChange:function(e){u(e.target.value)}}),Object(s.jsxs)("label",{className:"pbLobbyUpsidedownContainer",children:["Upside board on opponents turn",Object(s.jsx)("input",{type:"checkbox",id:"upsidedownModeCheckbox",value:d,onChange:function(){j((function(e){return!e}))}}),Object(s.jsx)("span",{className:"pbLobbyUpsidedownCheckmark"})]})]})}),Object(s.jsx)("div",{className:"row pbLobbyPrisonerSection",children:Object(s.jsxs)("div",{className:"col",children:[Object(s.jsx)("span",{className:"pbPlayerTitle",children:"PRISONERS"}),Object(s.jsx)("span",{className:"pbLobbyGameIdPrompt",children:"Game ID"}),Object(s.jsx)("input",{className:"pbLobbyGameIdInput",name:"gameid",value:r,onChange:function(e){o(e.target.value)}}),Object(s.jsx)("span",{className:"pbLobbyRackSizePrompt"}),Object(s.jsx)("button",{id:"selectracksize4",className:4===p?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return k(4)},"data-toggle":"tooltip",title:"4 letter racks, 9 x 9 board",autoFocus:!0,children:"4"}),Object(s.jsx)("button",{id:"selectracksize5",className:5===p?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return k(5)},"data-toggle":"tooltip",title:"5 letter racks, 11 x 11 board",children:"5"}),Object(s.jsx)("button",{id:"selectracksize6",className:6===p?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return k(6)},"data-toggle":"tooltip",title:"6 letter racks, 13 x 13 board",children:"6"}),Object(s.jsx)("button",{id:"selectracksize7",className:7===p?"pbLobbyRackSizeSelected":"pbLobbyRackSize",onClick:function(){return k(7)},"data-toggle":"tooltip",title:"7 letter racks, 15 x 15 board",children:"7"}),Object(s.jsxs)("span",{className:"pbLobbyCellBlockInfo",children:[p," letter racks, ",2*p+1," x ",2*p+1," board."]}),Object(s.jsx)("button",{id:"startgame",className:"pbLobbyActionButton",onClick:function(){0===l.length?window.alert("Please enter nickname before starting a game"):r.length>0?!function(e){var t=g(e);return!(t<0)&&O[t].playingP}(r)?b("P"):window.alert("Prisoners already playing that game"):window.alert("Please enter Game ID before starting a game")},children:"Start Game"})]})}),Object(s.jsx)("div",{className:"row pbLobbyGuardSection",children:Object(s.jsxs)("div",{className:"col",children:[Object(s.jsx)("span",{className:"pbPlayerTitle",children:"GUARDS"}),Object(s.jsx)("span",{className:"pbLobbyGuardInfo",children:'Find and click the "Join Game" button for your game.'}),Object(s.jsx)("p",{children:'If you lost connection, find and click the "Reconnect" button for your game id.'})]})}),Object(s.jsx)("div",{className:"row",children:Object(s.jsx)("div",{className:"col offset-1",children:Object(s.jsx)("h2",{children:"Game list:"})})}),Object(s.jsx)("div",{className:"row",children:Object(s.jsx)("div",{className:"col offset-1",children:Object(s.jsxs)("table",{children:[Object(s.jsx)("thead",{children:Object(s.jsxs)("tr",{className:"pbLobbyGamesHeader",children:[Object(s.jsx)("th",{className:"pbLobbyGamesHeaderCol",children:"Game ID"}),Object(s.jsx)("th",{className:"pbLobbyGamesHeaderCol",colSpan:"2",children:"Prisoners"}),Object(s.jsx)("th",{className:"pbLobbyGamesHeaderCol",colSpan:"2",children:"Guards"}),Object(s.jsx)("th",{className:"pbLobbyGamesHeaderCol",children:"Cell Block"}),Object(s.jsx)("th",{className:"pbLobbyGamesHeaderCol",children:"Game Status"})]})}),Object(s.jsx)("tbody",{children:O.map((function(e,n){return Object(s.jsxs)("tr",{className:"pbGamesInProgressRow",children:[Object(s.jsx)("td",{className:"pbLobbyGameid",children:e.gameid}),Object(s.jsx)("td",{className:"pbLobbyPlayerIndicator",children:Object(s.jsx)("span",{className:"material-icons",children:e.playingP?"check_circle":"cancel"})}),0===v(e)?Object(s.jsx)("td",{className:"pbLobbyActionNone",children:"No action available"}):3===v(e)?Object(s.jsx)("td",{id:"PrisonersRejoin".concat(n),children:Object(s.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){t(!0),o(e.gameid),b("P"),m(e.racksize)},children:"Reconnect"})}):Object(s.jsx)("td",{id:"PrisonersStart".concat(n),children:Object(s.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){o(e.gameid),b("P")},children:"Start Game"})}),Object(s.jsx)("td",{className:"pbLobbyPlayerIndicator",children:Object(s.jsx)("span",{className:"material-icons",children:e.playingG?"check_circle":"cancel"})}),0===y(e)?Object(s.jsx)("td",{className:"pbLobbyActionNone",children:"No action available"}):3===y(e)?Object(s.jsx)("td",{id:"GuardsRejoin".concat(n),children:Object(s.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){t(!0),o(e.gameid),b("G"),m(e.racksize)},children:"Reconnect"})}):Object(s.jsx)("td",{id:"GuardsJoin".concat(n),children:Object(s.jsx)("button",{className:"pbLobbyActionButton",onClick:function(){o(e.gameid),b("G"),m(e.racksize)},children:"Join Game"})}),Object(s.jsx)("td",{className:"pbLobbyGameRacksize",children:e.racksize}),Object(s.jsx)("td",{className:"pbLobbyGameStatus",children:e.gamestatus})]},"OtherGame".concat(n))}))})]})})})]})},x=function(e){var t=2*e.racksize,n=e.racksize,c=e.c!==h?"pbSquareInner "+e.squareusedby+("Q"===e.c?" u":""):e.rcd[0]===e.ri&&e.rcd[1]===e.ci&&"r"===e.rcd[2]?"pbSquareInner RightArrow":e.rcd[0]===e.ri&&e.rcd[1]===e.ci&&"d"===e.rcd[2]?"pbSquareInner DownArrow":e.ri===n&&e.ci===n?"pbSquareInner CenterSquare":0!==e.ri&&e.ri!==n&&e.ri!==t||0!==e.ci&&e.ci!==n&&e.ci!==t?e.ri%2===e.ci%2?"pbSquareInner style1":"pbSquareInner style2":"pbSquareInner EscapeHatch",a=e.c!==h?e.c:c.indexOf("RightArrow")>-1?"\u27a1":c.indexOf("DownArrow")>-1?"\u2b07":c.indexOf("CenterSquare")>-1?Object(s.jsx)("i",{className:"material-icons",children:"stars"}):".";return c.indexOf("EscapeHatch")>-1?Object(s.jsx)("button",{className:c,onClick:e.onClick,children:Object(s.jsx)("span",{className:"material-icons",children:"run_circle"})}):Object(s.jsx)("button",{className:c,onClick:e.onClick,children:a})},N=function(e){var t=e.onClick,n=e.squares,c=e.usedby,a=e.rcd,r=e.racksize,i=function(e){return Object(s.jsx)("tr",{className:"pbRow",children:n[e].map((function(n,i){return function(e,n,c,i){return Object(s.jsx)("td",{className:"pbSquareOuter",children:Object(s.jsx)(x,{c:c,ci:n,ri:e,squareusedby:i,rcd:a,onClick:function(){return t(e,n)},racksize:r})},"Square".concat(e,"-").concat(n))}(e,i,n,c[e][i])}))},"BoardRow".concat(e))};return Object(s.jsx)("table",{className:"pbBoard",children:Object(s.jsx)("tbody",{children:n.map((function(e,t){return i(t)}))})})},S=function(e){var t=e.isrejoin,n=e.prisonersOrGuards,r=e.gameid,o=e.nickname,l=e.wsmessage,u=e.client,b=e.upsidedownMode,d=e.racksize,y=d,k=2*d,x=6===d?f:7===d?O:5===d?m:p,S=Array(k+1).fill(Array(k+1).fill(h)),G=Array(k+1).fill(Array(k+1).fill(g)),C=Object(a.useState)(Object(c.a)(x)),I=C[0],T=C[1],A=Object(a.useState)([]),R=A[0],q=A[1],U=Object(a.useState)([]),B=U[0],D=U[1],J=Object(a.useState)(Object(c.a)(S)),_=J[0],F=J[1],H=Object(a.useState)(Object(c.a)(G)),X=H[0],Q=H[1],K=Object(a.useState)(-1),Y=K[0],W=K[1],V=Object(a.useState)("P"),Z=V[0],$=V[1],ee=Object(a.useState)([]),te=ee[0],ne=ee[1],se=Object(a.useState)(0),ce=se[0],ae=se[1],re=Object(a.useState)([-1,-1,v]),ie=re[0],oe=re[1],le=Object(a.useState)(!1),ue=le[0],be=le[1],de=Object(a.useState)([]),je=de[0],pe=de[1],me=Object(a.useState)({squares:Object(c.a)(S),usedby:Object(c.a)(G),ptiles:[],gtiles:[]}),fe=me[0],Oe=me[1],he=Object(a.useState)(""),ge=he[0],ve=he[1],ye=Object(a.useState)([]),ke=ye[0],xe=ye[1];Object(a.useEffect)((function(){var e=setInterval((function(){n!==Z&&"X"!==Z&&(console.log("Interval: prisonersOrGuards="+n+" whoseturn="+Z+" at "+Date().toLocaleString()),Ie())}),2e4);return function(){return clearInterval(e)}}),[Z]),Object(a.useEffect)((function(){if(t||"P"!==n)try{u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"requestgamedata",sender:n}))}catch(l){}else{for(var e=[],s=[],a=Object(c.a)(x);e.length<d;){var i=Math.floor(Math.random()*a.length);e.push(a[i]),a.splice(i,1),i=Math.floor(Math.random()*a.length),s.push(a[i]),a.splice(i,1)}e.sort(),s.sort(),D(s),q(e),T(a),Oe({squares:Object(c.a)(S),usedby:Object(c.a)(G),ptiles:[].concat(e),gtiles:[].concat(s)}),u.send(JSON.stringify({type:"pb",func:"hello",sender:n,gameid:r,nickname:o,whoseturn:Z,racksize:d}))}}),[]),Object(a.useEffect)((function(){""!==l&&function(e){var t=JSON.parse(e);if("announce"===t.type)u.send(JSON.stringify({type:"pb",func:"hello",sender:n,gameid:r,nickname:o,whoseturn:Z,racksize:d}));else if(t.gameid===r&&"pb"===t.type&&(t.sender!=n&&""===ge&&t.nickname&&t.nickname.length>0&&ve(t.nickname),"requestgamedata"===t.func&&t.sender!==n&&u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"providegamedata",sender:n,tiles:I,squares:_,ptiles:R,gtiles:B,usedby:X,whoseturn:Z,selection:Y,currentcoords:te,snapshot:fe,passed:ue,moves:je,rescues:ce,racksize:d})),"providegamedata"===t.func&&t.sender!==n&&Z!==n&&"X"!==Z&&(T(t.tiles),F(t.squares),q(t.ptiles),D(t.gtiles),Q(t.usedby),$(t.whoseturn),W(t.selection),ne(t.currentcoords),Oe(t.snapshot),be(t.passed),pe(t.moves),ae(t.rescues)),"ept"===t.func&&($(t.whoseturn),W(-1),oe(-1,-1,v),ne([]),F(t.squares),Q(t.usedby),q(t.ptiles),T(t.tiles),be(t.passed),pe(t.moves),ae(t.rescues),Oe({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(t.ptiles),gtiles:Object(c.a)(B)})),"egt"===t.func&&($(t.whoseturn),W(-1),oe(-1,-1,v),ne([]),F(t.squares),Q(t.usedby),D(t.gtiles),T(t.tiles),be(t.passed),pe(t.moves),Oe({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(R),gtiles:Object(c.a)(t.gtiles)})),"chat"===t.func&&t.sender!=n)){var s=[].concat(Object(c.a)(ke),[{from:t.nickname,msg:t.sendmsg}]);xe(s)}}(l)}),[l]),Object(a.useEffect)((function(){z("ScrollableMoves")}),[je]);var Ne=function(e,t,n,s){var a=Object(c.a)(_),r=Object(c.a)(X),i=Object(c.a)(R),o=Object(c.a)(B),l=Object(c.a)(_[e]),u=_[e][t],b=Object(c.a)(te),d=String(e)+"-"+String(t),j=te.indexOf(d);if(-1===n&&(n=Y,s=ie),n>-1&&u===h){l[t]="P"===Z?i[n]:o[n],a[e]=Object(c.a)(l),"P"===Z?i.splice(n,1):o.splice(n,1);var p=Object(c.a)(r[e]);return p[t]=Z,r[e]=Object(c.a)(p),"P"===Z&&n===i.length&&(n-=1),"G"===Z&&n===o.length&&(n-=1),W(n),F(a),Q(r),q(i),D(o),ne([].concat(Object(c.a)(te),[d])),void oe(s)}if(j>-1){"P"===Z?i.push(u):o.push(u);var m=Object(c.a)(a[e]);m[t]=h,a[e]=Object(c.a)(m);var f=Object(c.a)(r[e]);return f[t]=g,r[e]=Object(c.a)(f),W("P"===Z?i.length-1:o.length-1),b.splice(j,1),F(a),Q(r),q(i),D(o),ne(b),void oe(-1,-1,v)}if(_[e][t]!==h);else{var O=ie[0]!==e||ie[1]!==t?"r":"r"===ie[2]?"d":"d"===ie[2]?v:"r";oe(s=[e,t,O])}},Se=function(){if(Pe()){for(var e=ce,t=["0-0","0-"+y,"0-"+k,y+"-0",y+"-"+k,k+"-0",k+"-"+y,k+"-"+k],s=0;s<te.length;s++)t.indexOf(te[s])>-1&&(e+=1);for(var a=Object(c.a)(R),i=Object(c.a)(I);a.length<d&&i.length>0;){var l=Math.floor(Math.random()*i.length);a.push(i[l]),i.splice(l,1)}a.sort();var b=a.length>0?"G":"X";X[0][0]!==g&&X[0][y]!==g&&X[0][k]!==g&&X[y][0]!==g&&X[y][k]!==g&&X[k][0]!==g&&X[k][y]!==g&&X[k][k]!==g&&(b="X");var j=Ge(),p={by:"P",type:"PLAY",mainword:j.mainword,extrawords:j.extrawords},m=[].concat(Object(c.a)(je),[p]);$(b),W(-1),ne([]),q(a),T(i),be(!1),pe(m),ae(e),Oe({squares:Object(c.a)(_),usedby:Object(c.a)(X),ptiles:Object(c.a)(a),gtiles:Object(c.a)(B)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:n,squares:_,usedby:X,ptiles:a,tiles:i,whoseturn:b,racksize:d,passed:!1,moves:m,rescues:e}))}},we=function(){if(Pe()){for(var e=Object(c.a)(B),t=Object(c.a)(I);e.length<d&&t.length>0;){var s=Math.floor(Math.random()*t.length);e.push(t[s]),t.splice(s,1)}e.sort();var a=Object(c.a)(_),i=Object(c.a)(X),l=Object(c.a)(R),b=Object(c.a)(B),j=e.length>0?"P":"X";X[0][0]!==g&&X[0][y]!==g&&X[0][k]!==g&&X[y][0]!==g&&X[y][k]!==g&&X[k][0]!==g&&X[k][y]!==g&&X[k][k]!==g&&(j="X");var p=Ge(),m={by:"G",type:"PLAY",mainword:p.mainword,extrawords:p.extrawords},f=[].concat(Object(c.a)(je),[m]);$(j),W(-1),ne([]),D(e),T(t),be(!1),pe(f),Oe({squares:a,usedby:i,ptiles:l,gtiles:b}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:n,squares:_,usedby:X,gtiles:e,tiles:t,passed:!1,moves:f,whoseturn:j,racksize:d}))}};function Pe(){if(_[y][y]===h)return window.alert("First play must hit center square"),!1;for(var e=k+1,t=k+1,n=e,s=-1,c=t,a=-1,r=0;r<e;++r)for(var i=0;i<t;++i)if(_[r][i]!==h){if(!(r>0&&_[r-1][i]!==h)&&!(i>0&&_[r][i-1]!==h)&&!(r<k&&_[r+1][i]!==h)&&!(i<k&&_[r][i+1]!==h))return window.alert("Each played tile must be part of a word"),!1;fe.squares[r][i]===h&&(r<n&&(n=r),r>s&&(s=r),i<c&&(c=i),i>a&&(a=i))}if(n===e)return window.alert("You didn't play any tiles"),!1;if(n!==s&&c!==a)return window.alert("Tiles played must be in a straight line"),!1;var o=!1,l=!1;for(r=n;r<=s;++r)for(i=c;i<=a;++i){if(_[r][i]===h)return window.alert("There is a gap in your word"),!1;fe.squares[r][i]!==h&&(o=!0),n===s&&r>0&&_[r-1][i]!==h&&(l=!0),n===s&&r<k&&_[r+1][i]!==h&&(l=!0),c===a&&i>0&&_[r][i-1]!==h&&(l=!0),c===a&&i<k&&_[r][i+1]!==h&&(l=!0)}return n===s&&c>0&&fe.squares[n][c-1]!==h&&(o=!0),n===s&&a<k&&fe.squares[n][a+1]!==h&&(o=!0),c===a&&n>0&&fe.squares[n-1][c]!==h&&(o=!0),c===a&&s<k&&fe.squares[s+1][c]!==h&&(o=!0),!(!o&&!l&&fe.squares[y][y]!==h)||(window.alert("Words must be connected"),!1)}function Ge(){for(var e="",t=[],n=k+1,s=-1,a=k+1,r=-1,i=te.length,o=0;o<i;++o){var l=parseInt(te[o].split("-")[0]),u=parseInt(te[o].split("-")[1]);l<n&&(n=l),l>s&&(s=l),u<a&&(a=u),u>r&&(r=u)}if(n<s){for(var b=a,d=n;d>0&&_[d-1][b]!==h;)d-=1;for(var j=s;j<k&&_[j+1][b]!==h;)j+=1;for(var p=d;p<=j;++p){e+=_[p][b];var m=p+"-"+b;if(te.indexOf(m)>-1){for(var f=b;f>0&&_[p][f-1]!==h;)f-=1;for(var O=b;O<k&&_[p][O+1]!==h;)O+=1;if(f<O){for(var g="",v=f;v<=O;++v)g+=_[p][v];t=[].concat(Object(c.a)(t),[g])}}}}else{for(var y=n,x=a;x>0&&_[y][x-1]!==h;)x-=1;for(var N=r;N<k&&_[y][N+1]!==h;)N+=1;for(var S=x;S<=N;++S){e+=_[y][S];var w=y+"-"+S;if(te.indexOf(w)>-1){for(var P=y;P>0&&_[P-1][S]!==h;)P-=1;for(var G=y;G<k&&_[G+1][S]!==h;)G+=1;if(P<G){for(var C="",I=P;I<=G;++I)C+=_[I][S];t=[].concat(Object(c.a)(t),[C])}}}}return 1===e.length&&(e=t[0],t=t.splice(1,1)),{mainword:e,extrawords:t}}var Ce=function(){F(Object(c.a)(fe.squares)),Q(Object(c.a)(fe.usedby)),q(Object(c.a)(fe.ptiles)),D(Object(c.a)(fe.gtiles)),W(-1),ne([])},Ie=function(){u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",sender:n,whoseturn:Z,racksize:d,func:"requestgamedata"}))};return Object(s.jsxs)("div",{className:"container-fluid prisonbreak",children:[Object(s.jsxs)("div",{className:"row",children:[Object(s.jsxs)("div",{className:"col-2 pbGameid",children:["Game id: ",r,Object(s.jsx)("br",{}),"Nickname: ",o]}),Object(s.jsxs)("div",{className:"col-8 pbtitle",children:["Prison Break",Object(s.jsx)("span",{className:"material-icons",children:"run_circle"})]}),Object(s.jsxs)("div",{className:"col-2 pbhomelink",children:[Object(s.jsx)(i.a,{href:"../../",children:Object(s.jsx)("a",{children:Object(s.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})}),Object(s.jsx)("br",{}),"Opponent: ",ge]})]}),Object(s.jsxs)("div",{className:"row",children:[Object(s.jsx)("div",{className:"col pbPlayerOuterSection",children:Object(s.jsx)(E,{ptiles:R,whoseturn:Z,selection:Y,onClick:function(e){return t=e,void("P"===Z?W(Y===t?-1:t):alert("It is not your turn"));var t},onClickFinishTurn:function(){return Se()},onClickTileRecall:function(){return Ce()},onClickTileExchange:function(){return function(){if(I.length<d)window.alert("Need "+d+" tiles in the bag to exchange");else{for(var e=[],t=Object(c.a)(I);e.length<d&&t.length>0;){var s=Math.floor(Math.random()*t.length);e.push(t[s]),t.splice(s,1)}e.sort(),(t=[].concat(Object(c.a)(t),Object(c.a)(fe.ptiles))).sort();var a=[].concat(Object(c.a)(je),[{by:"P",type:"SWAP"}]);F(Object(c.a)(fe.squares)),Q(Object(c.a)(fe.usedby)),$("G"),W(-1),ne([]),q(e),T(t),be(!1),pe(a),Oe({squares:Object(c.a)(fe.squares),usedby:Object(c.a)(fe.usedby),ptiles:[].concat(e),gtiles:Object(c.a)(B)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:n,whoseturn:"G",racksize:d,squares:fe.squares,usedby:fe.usedby,ptiles:e,tiles:t,passed:!1,moves:a,rescues:ce}))}}()},onClickPassPlay:function(){return function(){Ce();var e=ue?"X":"G";$(e),be(!0);var t=[].concat(Object(c.a)(je),[{by:"P",type:"PASS"}]);u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:n,squares:fe.squares,usedby:fe.usedby,ptiles:fe.ptiles,tiles:I,whoseturn:e,racksize:d,passed:!0,moves:t,rescues:ce}))}()},rescues:ce,prisonersOrGuards:n})}),Object(s.jsxs)("div",{className:"col pbBoardPlusUnderboard",children:[n===Z?Object(s.jsx)("div",{className:"row",onKeyDownCapture:function(e){if(e.preventDefault(),n===Z)if("Enter"!==e.key){if(e.key.match(/^[A-Za-z\?]$/)){var t=e.key.toUpperCase(),s="P"===Z?R:B,a=s.indexOf(t);if(-1===a&&(a=s.indexOf("?")),a>-1){var r=ie[0],i=ie[1],o=ie[2];if(r>-1&&i>-1&&o!==v){if("r"===o){for(var l=-1,u=i+1;u<k+1&&-1===l;u++)_[r][u]===h&&(l=u);return void Ne(r,i,a,-1===l?[-1,-1,v]:[r,l,"r"])}if("d"===o){for(var b=-1,j=2*d+1,p=r+1;p<j&&-1===b;p++)_[p][i]===h&&(b=p);return void Ne(r,i,a,-1===b?[-1,-1,v]:[b,i,"d"])}}}}else if("Backspace"===e.key&&te.length>0){var m=te[te.length-1],f=Object(c.a)(te),O=Object(c.a)(R),y=Object(c.a)(B),x=Object(c.a)(X),N=Object(c.a)(_),S=[-1,-1,v],w=Y;f.splice(te.length-1,1);var P=parseInt(m.split("-")[0]),G=parseInt(m.split("-")[1]),C=_[P][G];"P"===Z?(O.push(C),w=O.length-1):(y.push(C),w=y.length-1),x[P][G]=g,N[P][G]=h;var I=ie[2];I!==v&&(S=[P,G,I],1===te.length&&(w=-1)),ne(f),D(y),q(O),F(N),Q(x),oe(S),W(w)}}else"P"===Z?Se():we()},children:Object(s.jsx)(N,{squares:_,usedby:X,rcd:ie,onClick:function(e,t){return Ne(e,t,-1,null)},racksize:d})}):"X"!==Z&&b?Object(s.jsx)("div",{className:"row upsidedown",children:Object(s.jsx)(N,{squares:_,usedby:X,rcd:ie,onClick:function(){},racksize:d})}):Object(s.jsx)("div",{className:"row",children:Object(s.jsx)(N,{squares:_,usedby:X,rcd:ie,onClick:function(){},racksize:d})}),Object(s.jsx)("div",{className:"pbUnderboard",children:"X"===Z?Object(s.jsx)("h1",{children:"Game Over!"}):Object(s.jsx)("p",{children:"P"===Z?j[0]:j[1]})})]}),Object(s.jsx)("div",{className:"col pbPlayerOuterSection",children:Object(s.jsx)(L,{gtiles:B,whoseturn:Z,selection:Y,onClick:function(e){return t=e,void("G"===Z?W(Y===t?-1:t):alert("It is not your turn"));var t},onClickFinishTurn:function(){return we()},onClickTileRecall:function(){return Ce()},onClickTileExchange:function(){return function(){if(I.length<d)window.alert("Need "+d+" tiles in the bag to exchange");else{for(var e=[],t=Object(c.a)(I);e.length<d&&t.length>0;){var s=Math.floor(Math.random()*t.length);e.push(t[s]),t.splice(s,1)}e.sort(),(t=[].concat(Object(c.a)(t),Object(c.a)(fe.gtiles))).sort();var a=[].concat(Object(c.a)(je),[{by:"G",type:"SWAP"}]);F(Object(c.a)(fe.squares)),Q(Object(c.a)(fe.usedby)),$("P"),W(-1),ne([]),D(e),T(t),be(!1),pe(a),Oe({squares:Object(c.a)(fe.squares),usedby:Object(c.a)(fe.usedby),ptiles:Object(c.a)(R),gtiles:[].concat(e)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:n,whoseturn:"P",racksize:d,squares:fe.squares,usedby:fe.usedby,gtiles:e,tiles:t,passed:!1,moves:a}))}}()},onClickPassPlay:function(){return function(){Ce();var e=ue?"X":"P";$(e),be(!0);var t=[].concat(Object(c.a)(je),[{by:"G",type:"PASS"}]);u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:n,squares:fe.squares,usedby:fe.usedby,gtiles:fe.gtiles,tiles:I,whoseturn:e,racksize:d,passed:!0,moves:t}))}()},prisonersOrGuards:n})}),Object(s.jsxs)("div",{className:"col pbTileAndMovesOuter",children:[Object(s.jsx)(w,{tiles:I,othertiles:"P"===n?B:R}),Object(s.jsx)(P,{moves:je})]}),Object(s.jsx)("div",{className:"col",children:Object(s.jsx)(M,{gameid:r,client:u,nickname:o,msgs:ke,setMsgs:xe,prisonersOrGuards:n})})]})]})},w=function(e){var t=[].concat(Object(c.a)(e.tiles),Object(c.a)(e.othertiles));return t.sort(),"?"===t[0]&&(t.splice(0,1),t.push("?")),"?"===t[0]&&(t.splice(0,1),t.push("?")),Object(s.jsxs)("div",{className:"pbTilepool",children:[Object(s.jsx)("div",{className:"pbTilepoolTitle",children:"TILES"}),t.map((function(e,n){return Object(s.jsxs)("span",{children:[n>0&&e!==t[n-1]?Object(s.jsx)("span",{className:"pbTilepoolDivider"}):Object(s.jsx)(s.Fragment,{}),Object(s.jsx)("span",{className:"Q"===e?"pbTilepoolTile u":"pbTilepoolTile",children:e})]},"tile".concat(n))}))]})},P=function(e){return Object(s.jsxs)("div",{className:"pbMoves",children:[Object(s.jsx)("div",{className:"pbMovesTitle",children:"MOVES"}),Object(s.jsx)("div",{className:"pbMovesScrollable",id:"ScrollableMoves",children:e.moves.map((function(e,t){var n;return Object(s.jsxs)("div",{className:"pbMove",children:[Object(s.jsx)("span",{className:"pbMove by",children:e.by}),":",Object(s.jsx)("span",{className:"pbMove ".concat(e.type),children:"PLAY"===e.type?Object(s.jsxs)(s.Fragment,{children:[e.mainword.replace("Q","Qu"),null===(n=e.extrawords)||void 0===n?void 0:n.map((function(e){return Object(s.jsxs)(s.Fragment,{children:[",\xa0",e.replace("Q","Qu")]})}))]}):Object(s.jsx)(s.Fragment,{})})]},"move".concat(t))}))})]})},G=function(e){return Object(s.jsx)("div",{className:e.tileclass,onClick:e.onClick,children:e.tilevalue})},C=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"check"}),"\xa0Finish Turn"]})})},I=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"undo"}),"\xa0Recall Tiles"]})})},T=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"cached"}),"\xa0Swap Tiles"]})})},A=function(e){return Object(s.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(s.jsxs)("span",{className:"pbActionButtonText",children:[Object(s.jsx)("i",{className:"material-icons",children:"not_interested"}),"\xa0Pass Turn"]})})},E=function(e){var t,n=R(e);return Object(s.jsxs)("div",{className:"pbPlayerInnerSection",children:[Object(s.jsxs)("div",{className:"pbPlayerTitle",children:[Object(s.jsx)("i",{className:"material-icons",children:"run_circle"}),"\xa0PRISONERS\xa0",Object(s.jsx)("i",{className:"material-icons",children:"run_circle"})]}),Object(s.jsx)("div",{className:"pbTilerack",children:e.ptiles.map((function(t,s){return n("P"===e.whoseturn&&e.selection===s?"Q"===t&&"P"===e.prisonersOrGuards?"pbTileOnRack Selected P u":"pbTileOnRack Selected P":"Q"===t&&"P"===e.prisonersOrGuards?"pbTileOnRack Unselected P u":"pbTileOnRack Unselected P",s,"P"===e.prisonersOrGuards?t:"*")}))}),"P"===e.whoseturn&&"P"===e.prisonersOrGuards?q(e):Object(s.jsx)(s.Fragment,{}),Object(s.jsxs)("div",{className:"pbRescuesMade",children:["Rescues made: ",e.rescues,Object(s.jsx)("br",{}),(t=e.rescues,Array(t).fill("nonsense").map((function(e,t){return Object(s.jsx)("span",{"data-toggle":"tooltip",title:"I'm free! I'm free!",children:Object(s.jsx)("img",{className:"pbRescuee",src:"/breakfree.png",alt:"I'm free! I'm free!"})},e+String(t))})))]})]})},L=function(e){var t=R(e);return Object(s.jsxs)("div",{className:"pbPlayerInnerSection",children:[Object(s.jsxs)("div",{className:"pbPlayerTitle",children:[Object(s.jsx)("i",{className:"material-icons",children:"security"}),"\xa0GUARDS\xa0",Object(s.jsx)("i",{className:"material-icons",children:"security"})]}),Object(s.jsx)("div",{className:"pbTilerack",children:e.gtiles.map((function(n,s){return t("G"===e.whoseturn&&e.selection===s?"Q"===n&&"G"===e.prisonersOrGuards?"pbTileOnRack Selected G u":"pbTileOnRack Selected G":"Q"===n&&"G"===e.prisonersOrGuards?"pbTileOnRack Unselected G u":"pbTileOnRack Unselected G",s,"G"===e.prisonersOrGuards?n:"*")}))}),"G"===e.whoseturn&&"G"===e.prisonersOrGuards?q(e):Object(s.jsx)(s.Fragment,{})]})};function R(e){return function(t,n,c){return"*"!==c?Object(s.jsx)(G,{tileclass:t,tilevalue:c,onClick:function(){return e.onClick(n)}},t+String(n)):Object(s.jsx)(G,{tileclass:t,tilevalue:c,onClick:function(){return window.alert("No peeking!")}},t+String(n))}}function q(e){return Object(s.jsxs)("div",{className:"pbActionButtonDiv",children:[Object(s.jsx)("p",{children:Object(s.jsx)(C,{onClick:function(){return e.onClickFinishTurn()}})}),Object(s.jsx)("p",{children:Object(s.jsx)(I,{onClick:function(){return e.onClickTileRecall()}})}),Object(s.jsx)("p",{children:Object(s.jsx)(T,{onClick:function(){return e.onClickTileExchange()}})}),Object(s.jsx)("p",{children:Object(s.jsx)(A,{onClick:function(){return e.onClickPassPlay()}})})]})}var M=function(e){var t=e.gameid,n=e.client,r=e.nickname,i=e.msgs,o=e.setMsgs,l=e.prisonersOrGuards,u=Object(a.useState)(""),b=u[0],d=u[1];return Object(s.jsxs)("div",{className:"pbChat",children:[Object(s.jsx)("span",{className:"pbChatTitle",children:"CHAT"}),Object(s.jsx)("table",{className:"pbChatTable",children:Object(s.jsxs)("tbody",{children:[i.filter((function(e,t){return i.length-t<15})).map((function(e,t){return Object(s.jsxs)("tr",{children:[Object(s.jsx)("td",{className:"pbChatFrom",children:e.from}),Object(s.jsx)("td",{className:"pbChatMsg",children:e.msg})]},"ChatMessage".concat(t))})),Object(s.jsx)("tr",{children:Object(s.jsx)("td",{colSpan:"2",children:Object(s.jsx)("textarea",{className:""===b?"pbChatInputEmpty":"pbChatInput",name:"nextmsgInputArea",value:b,onChange:function(e){d(e.target.value)},onKeyDownCapture:function(e){if("Enter"===e.key&&b.length>0){e.preventDefault();var s=[].concat(Object(c.a)(i),[{from:r,msg:b}]),a=b;return o(s),d(""),void n.send(JSON.stringify({gameid:t,nickname:r,type:"pb",func:"chat",sender:l,sendmsg:a}))}if("Backspace"===e.key&&b.length>0){e.preventDefault();var u=b.slice(0,b.length-1);d(u)}}})})})]})})]})},z=function(e){var t=document.getElementById(e);t.scrollTop=t.scrollHeight}},YFqc:function(e,t,n){e.exports=n("cTJO")},cTJO:function(e,t,n){"use strict";var s=n("J4zp"),c=n("284h");t.__esModule=!0,t.default=void 0;var a=c(n("q1tI")),r=n("elyg"),i=n("nOHt"),o=n("vNVm"),l={};function u(e,t,n,s){if(e&&(0,r.isLocalURL)(t)){e.prefetch(t,n,s).catch((function(e){0}));var c=s&&"undefined"!==typeof s.locale?s.locale:e&&e.locale;l[t+"%"+n+(c?"%"+c:"")]=!0}}var b=function(e){var t=!1!==e.prefetch,n=(0,i.useRouter)(),c=n&&n.pathname||"/",b=a.default.useMemo((function(){var t=(0,r.resolveHref)(c,e.href,!0),n=s(t,2),a=n[0],i=n[1];return{href:a,as:e.as?(0,r.resolveHref)(c,e.as):i||a}}),[c,e.href,e.as]),d=b.href,j=b.as,p=e.children,m=e.replace,f=e.shallow,O=e.scroll,h=e.locale;"string"===typeof p&&(p=a.default.createElement("a",null,p));var g=a.Children.only(p),v=g&&"object"===typeof g&&g.ref,y=(0,o.useIntersection)({rootMargin:"200px"}),k=s(y,2),x=k[0],N=k[1],S=a.default.useCallback((function(e){x(e),v&&("function"===typeof v?v(e):"object"===typeof v&&(v.current=e))}),[v,x]);(0,a.useEffect)((function(){var e=N&&t&&(0,r.isLocalURL)(d),s="undefined"!==typeof h?h:n&&n.locale,c=l[d+"%"+j+(s?"%"+s:"")];e&&!c&&u(n,d,j,{locale:s})}),[j,d,N,h,t,n]);var w={ref:S,onClick:function(e){g.props&&"function"===typeof g.props.onClick&&g.props.onClick(e),e.defaultPrevented||function(e,t,n,s,c,a,i,o){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&(0,r.isLocalURL)(n))&&(e.preventDefault(),null==i&&(i=s.indexOf("#")<0),t[c?"replace":"push"](n,s,{shallow:a,locale:o,scroll:i}).then((function(e){e&&i&&document.body.focus()})))}(e,n,d,j,m,f,O,h)},onMouseEnter:function(e){(0,r.isLocalURL)(d)&&(g.props&&"function"===typeof g.props.onMouseEnter&&g.props.onMouseEnter(e),u(n,d,j,{priority:!0}))}};if(e.passHref||"a"===g.type&&!("href"in g.props)){var P="undefined"!==typeof h?h:n&&n.locale,G=(0,r.getDomainLocale)(j,P,n&&n.locales,n&&n.domainLocales);w.href=G||(0,r.addBasePath)((0,r.addLocale)(j,P,n&&n.defaultLocale))}return a.default.cloneElement(g,w)};t.default=b},vNVm:function(e,t,n){"use strict";var s=n("J4zp"),c=n("TqRt");t.__esModule=!0,t.useIntersection=function(e){var t=e.rootMargin,n=e.disabled||!i,c=(0,a.useRef)(),l=(0,a.useState)(!1),u=s(l,2),b=u[0],d=u[1],j=(0,a.useCallback)((function(e){c.current&&(c.current(),c.current=void 0),n||b||e&&e.tagName&&(c.current=function(e,t,n){var s=function(e){var t=e.rootMargin||"",n=o.get(t);if(n)return n;var s=new Map,c=new IntersectionObserver((function(e){e.forEach((function(e){var t=s.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)}))}),e);return o.set(t,n={id:t,observer:c,elements:s}),n}(n),c=s.id,a=s.observer,r=s.elements;return r.set(e,t),a.observe(e),function(){r.delete(e),a.unobserve(e),0===r.size&&(a.disconnect(),o.delete(c))}}(e,(function(e){return e&&d(e)}),{rootMargin:t}))}),[n,t,b]);return(0,a.useEffect)((function(){i||b||(0,r.default)((function(){return d(!0)}))}),[b]),[j,b]};var a=n("q1tI"),r=c(n("0G5g")),i="undefined"!==typeof IntersectionObserver;var o=new Map}},[["2Skw",0,2,1,3]]]);