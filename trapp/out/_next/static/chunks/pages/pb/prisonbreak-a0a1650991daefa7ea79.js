_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[12],{NOQH:function(e,t,s){"use strict";s.r(t);var n=s("nKUr"),c=(s("q1tI"),function(e){var t="pbTileOnRack "+(e.selection===e.tileindex?"Selected ":"Unselected ")+("Q"===e.tilevalue?"u ":"")+e.prisonersOrGuards,s=e.tileindex;return Object(n.jsx)("div",{className:t,onClick:function(t){return e.onClick(t)},children:Object(n.jsx)("div",{className:"pbTileOnRackText",children:e.tilevalue})},s)}),a=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"check"}),"\xa0Finish Turn"]})})},r=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"undo"}),"\xa0Recall Tiles"]})})},i=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"cached"}),"\xa0Swap Tiles"]})})},o=function(e){return Object(n.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonText",children:[Object(n.jsx)("i",{className:"material-icons",children:"not_interested"}),"\xa0Pass Turn"]})})},l=function(e){return e.alreadyAllowed?Object(n.jsx)("div",{className:"pbActionButtonSevere",children:Object(n.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(n.jsx)("i",{className:"material-icons",children:"report"}),"\xa0ENABLED",Object(n.jsx)("span",{className:"pbActionButtonSevereText2",children:"\xa0Allow undo is now enabled"})]})}):Object(n.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(n.jsx)("i",{className:"material-icons",children:"report_problem"}),"\xa0Allow Undo Turn",Object(n.jsx)("span",{className:"pbActionButtonSevereText2",children:"Click to let opponent undo"})]})})},u=function(e){return Object(n.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(n.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(n.jsx)("i",{className:"material-icons",children:"delete_forever"}),"\xa0Undo My Turn",Object(n.jsx)("span",{className:"pbActionButtonSevereText2",children:"Opponent has allowed undo"})]})})};function d(e){return Object(n.jsxs)("div",{className:"pbActionButtonDiv",children:[Object(n.jsx)("p",{children:Object(n.jsx)(a,{onClick:function(){return e.onClickFinishTurn()}})}),Object(n.jsx)("p",{children:Object(n.jsx)(r,{onClick:function(){return e.onClickTileRecall()}})}),Object(n.jsx)("p",{children:Object(n.jsx)(i,{onClick:function(){return e.onClickTileExchange()}})}),Object(n.jsx)("p",{children:Object(n.jsx)(o,{onClick:function(){return e.onClickPassPlay()}})})]})}function b(e){return Object(n.jsx)("div",{className:"pbActionButtonDiv",children:Object(n.jsx)("p",{children:Object(n.jsx)(l,{onClick:function(){return e.onClickAllowUndo()},alreadyAllowed:e.allowRewind})})})}function j(e){return Object(n.jsx)("div",{className:"pbActionButtonDiv",children:Object(n.jsx)("p",{children:Object(n.jsx)(u,{onClick:function(){return e.onClickUndoLastPlay()}})})})}t.default=function(e){var t="P"===e.prisonersOrGuards?"run_circle":"security",s="P"===e.prisonersOrGuards?"PRISONERS":"GUARDS";return Object(n.jsxs)("div",{className:"pbPlayerInnerSection",children:[Object(n.jsxs)("div",{className:"pbPlayerTitle",children:[Object(n.jsx)("i",{className:"material-icons",children:t}),"\xa0",s,"\xa0",Object(n.jsx)("i",{className:"material-icons",children:t})]}),Object(n.jsx)("div",{className:"pbTilerack",children:e.racktiles&&e.racktiles.map((function(t,s){return Object(n.jsx)(c,{whoseturn:e.whoseturn,prisonersOrGuards:e.prisonersOrGuards,selection:e.selection,tileindex:s,tilevalue:t,onClick:function(){return e.onClick(s)}})}))}),e.whoseturn===e.prisonersOrGuards?d(e):e.allowRewind&&j(e),e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by!==e.prisonersOrGuards&&b(e)]})}},dsDM:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pb/prisonbreak",function(){return s("fLLM")}])},fLLM:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return N}));var n=s("nKUr"),c=s("KQm4"),a=s("q1tI"),r=s("YFqc"),i=s.n(r);function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,s){return t&&l(e.prototype,t),s&&l(e,s),e}var d=function(){function e(t,s){o(this,e),this.callback=t,this.timerCalc=s,this.timer=null,this.tries=0}return u(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),b=function(){function e(t,s){var n=this;o(this,e),this.customSocket=null,this.socketUrl=t,this.reconnectTimer=new d((function(){n.disconnect(),n.connect()}),this.reconnectAfterMs),this.messageFunction=s}return u(e,[{key:"reconnectAfterMs",value:function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4}},{key:"connect",value:function(){var e=this;this.customSocket=new WebSocket(this.socketUrl),this.customSocket.onopen=function(t){console.log("connected to "+e.socketUrl),e.send(JSON.stringify({type:"announce",func:"announce"}))},this.customSocket.onclose=function(t){e.reconnectTimer.scheduleTimeout()},this.customSocket.onerror=function(e){},this.customSocket.onmessage=this.messageFunction}},{key:"disconnect",value:function(){this.customSocket.onclose=function(){},this.customSocket.close()}},{key:"send",value:function(e){this.customSocket.send(JSON.stringify(e))}}]),e}(),j=s("NOQH"),O=s("M+XG"),p=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],h=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],f=["Escapee: \"I'm free! I'm free!\". Little kid: \"I'm four! I'm four!\"","Two peanuts were walking down a back alley. One was a salted.","The psychic dwarf escaped! There's a small medium at large!","What do you call a vegetable who has escaped prison? An escapea!","The prisoners fave punctuation is a period. It marks the end of a sentence!","Prison is only one word, but to robbers it's a whole sentence."],m=["A","A","A","B","C","D","E","E","E","E","F","G","H","I","I","I","J","K","L","M","N","N","O","O","O","P","Q","R","R","S","T","T","U","V","W","X","Y","Z","?","?"],v=["A","A","A","A","A","B","C","D","D","E","E","E","E","E","E","F","G","H","I","I","I","I","I","J","K","L","L","M","N","N","N","O","O","O","O","P","Q","R","R","R","S","S","T","T","T","U","V","W","X","Y","Z","?","?"],g=["A","A","A","A","A","A","A","B","B","C","C","D","D","D","E","E","E","E","E","E","E","E","E","F","G","G","H","H","I","I","I","I","I","I","I","J","K","L","L","L","M","M","N","N","N","N","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","S","S","S","T","T","T","T","U","U","U","V","W","X","Y","Z","?","?"],x=["A","A","A","A","A","A","A","A","A","B","B","C","C","D","D","D","D","E","E","E","E","E","E","E","E","E","E","E","E","F","F","G","G","G","H","H","I","I","I","I","I","I","I","I","I","J","K","L","L","L","L","M","M","N","N","N","N","N","N","O","O","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","R","S","S","S","S","T","T","T","T","T","T","U","U","U","U","V","V","W","W","X","Y","Y","Z","?","?"],y=".",k="",w="";function N(){var e=Object(a.useState)(!1),t=e[0],s=e[1],c=Object(a.useState)(""),r=c[0],i=c[1],o=Object(a.useState)(""),l=o[0],u=o[1],d=Object(a.useState)(""),j=d[0],p=d[1],h=Object(a.useState)(""),f=h[0],m=h[1],v=Object(a.useState)(4),g=v[0],x=v[1],y=Object(a.useState)(new b("wss://tilerunner.herokuapp.com",(function(e){m(e.data)})))[0];return Object(a.useEffect)((function(){return y.connect()}),[]),""===j?Object(n.jsx)(O.default,{setIsrejoin:s,wsmessage:f,gameid:r,setGameid:i,nickname:l,setNickname:u,setPrisonersOrGuards:p,racksize:g,setRacksize:x}):Object(n.jsx)(T,{isrejoin:t,prisonersOrGuards:j,gameid:r,nickname:l,wsmessage:f,client:y,racksize:g})}var S=function(e){var t=2*e.racksize,s=e.racksize,c=e.c!==y?"pbSquareInner PlayerTile":e.rcd[0]===e.ri&&e.rcd[1]===e.ci&&"r"===e.rcd[2]?"pbSquareInner RightArrow":e.rcd[0]===e.ri&&e.rcd[1]===e.ci&&"d"===e.rcd[2]?"pbSquareInner DownArrow":e.ri===s&&e.ci===s?"pbSquareInner CenterSquare":0!==e.ri&&e.ri!==s&&e.ri!==t||0!==e.ci&&e.ci!==s&&e.ci!==t?e.ri%2===e.ci%2?"pbSquareInner style1":"pbSquareInner style2":"pbSquareInner EscapeHatch",a=e.c!==y?e.c:c.indexOf("RightArrow")>-1?"\u27a1":c.indexOf("DownArrow")>-1?"\u2b07":c.indexOf("CenterSquare")>-1?Object(n.jsx)("i",{className:"material-icons",children:"stars"}):".";return c.indexOf("EscapeHatch")>-1?Object(n.jsx)("button",{className:c,onClick:e.onClick,children:Object(n.jsx)("span",{className:"material-icons",children:"run_circle"})}):e.c===y?Object(n.jsx)("button",{className:c,onClick:e.onClick,children:a}):Object(n.jsx)("button",{className:c,onClick:e.onClick,children:Object(n.jsx)("div",{className:"pbSquareTileText ".concat(e.squareusedby+("Q"===e.c?" u":"")),children:a})})},C=function(e){var t=e.onClick,s=e.squares,c=e.usedby,a=e.rcd,r=e.racksize,i=function(e){return Object(n.jsxs)("tr",{className:"pbRow",children:[Object(n.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderLeft",children:h[e]}),s[e].map((function(s,i){return function(e,s,c,i){return Object(n.jsx)("td",{className:"pbSquareOuter",children:Object(n.jsx)(S,{c:c,ci:s,ri:e,squareusedby:i,rcd:a,onClick:function(){return t(e,s)},racksize:r})},"Square".concat(e,"-").concat(s))}(e,i,s,c[e][i])})),Object(n.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderRight",children:h[e]})]},"BoardRow".concat(e))};return Object(n.jsx)("table",{className:"pbBoard",children:Object(n.jsxs)("tbody",{children:[Object(n.jsxs)("tr",{className:"pbBoardColumnHeaderRow",children:[Object(n.jsx)("td",{className:"pbBoardHeaderTopLeft",children:"\xa0"}),s.map((function(e,t){return Object(n.jsx)("td",{className:"pbBoardColumnHeader",children:p[t]},"TopColumnHeader".concat(t))})),Object(n.jsx)("td",{className:"pbBoardHeaderTopRight",children:"\xa0"})]}),s.map((function(e,t){return i(t)})),Object(n.jsxs)("tr",{className:"pbBoardColumnHeaderRow",id:"BoardHeaderBottom",children:[Object(n.jsx)("td",{className:"pbBoardHeaderBottomLeft",children:"\xa0"}),s.map((function(e,t){return Object(n.jsx)("td",{className:"pbBoardColumnHeader",children:p[t]},"BottomColumnHeader".concat(t))})),Object(n.jsx)("td",{className:"pbBoardHeaderBottomRight",children:"\xa0"})]})]})})},T=function(e){var t=e.isrejoin,s=e.prisonersOrGuards,r=e.gameid,o=e.nickname,l=e.wsmessage,u=e.client,d=e.racksize,b=d,O=2*d,N=6===d?g:7===d?x:5===d?v:m,S=Array(O+1).fill(Array(O+1).fill(y)),T=Array(O+1).fill(Array(O+1).fill(k)),B=Object(a.useState)(Object(c.a)(N)),R=B[0],M=B[1],G=Object(a.useState)([]),H=G[0],F=G[1],L=Object(a.useState)([]),D=L[0],U=L[1],J=Object(a.useState)(Object(c.a)(S)),z=J[0],_=J[1],X=Object(a.useState)(Object(c.a)(T)),Q=X[0],K=X[1],W=Object(a.useState)(-1),Y=W[0],V=W[1],Z=Object(a.useState)("P"),$=Z[0],ee=Z[1],te=Object(a.useState)([]),se=te[0],ne=te[1],ce=Object(a.useState)(0),ae=ce[0],re=ce[1],ie=Object(a.useState)([-1,-1,w]),oe=ie[0],le=ie[1],ue=Object(a.useState)(!1),de=ue[0],be=ue[1],je=Object(a.useState)([]),Oe=je[0],pe=je[1],he=Object(a.useState)({squares:Object(c.a)(S),usedby:Object(c.a)(T),ptiles:[],gtiles:[]}),fe=he[0],me=he[1],ve=Object(a.useState)(0),ge=ve[0],xe=ve[1],ye=Object(a.useState)(!1),ke=ye[0],we=ye[1],Ne=Object(a.useState)(""),Se=Ne[0],Ce=Ne[1],Te=Object(a.useState)([]),Ae=Te[0],qe=Te[1],Ie=new Audio("https://tilerunner.github.io/yippee.m4a"),Ee=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current=e})),t.current}(ae);function Pe(){V(-1),we(!1),le(-1,-1,w),ne([])}Object(a.useEffect)((function(){ae>Ee&&Ie.play()}),[ae]),Object(a.useEffect)((function(){var e=ge+1;e>=f.length&&(e=0),xe(e);var t=setInterval((function(){s!==$&&"X"!==$&&(console.log("Interval: prisonersOrGuards="+s+" whoseturn="+$+" at "+Date().toLocaleString()),ze())}),2e4);return function(){return clearInterval(t)}}),[$]),Object(a.useEffect)((function(){if(t||"P"!==s)try{u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"requestgamedata",sender:s}))}catch(l){}else{for(var e=[],n=[],a=Object(c.a)(N);e.length<d;){var i=Math.floor(Math.random()*a.length);e.push(a[i]),a.splice(i,1),i=Math.floor(Math.random()*a.length),n.push(a[i]),a.splice(i,1)}e.sort(),n.sort(),U(n),F(e),M(a),me({squares:Object(c.a)(S),usedby:Object(c.a)(T),ptiles:[].concat(e),gtiles:[].concat(n)}),u.send(JSON.stringify({type:"pb",func:"hello",sender:s,gameid:r,nickname:o,whoseturn:$,racksize:d}))}}),[]),Object(a.useEffect)((function(){""!==l&&function(e){var t=JSON.parse(e);if("announce"===t.type)u.send(JSON.stringify({type:"pb",func:"hello",sender:s,gameid:r,nickname:o,whoseturn:$,racksize:d}));else if(t.gameid===r&&"pb"===t.type&&(t.sender!=s&&""===Se&&t.nickname&&t.nickname.length>0&&Ce(t.nickname),"requestgamedata"===t.func&&t.sender!==s&&u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"providegamedata",sender:s,tiles:R,squares:z,ptiles:H,gtiles:D,usedby:Q,whoseturn:$,snapshot:fe,passed:de,moves:Oe,rescues:ae,racksize:d,allowRewind:ke})),"providegamedata"===t.func&&t.sender!==s&&$!==s&&"X"!==$&&(t.moves.length===Oe.length&&t.tiles.length===R.length||(M(t.tiles),_(t.squares),F(t.ptiles),U(t.gtiles),K(t.usedby),ee(t.whoseturn),me(t.snapshot),be(t.passed),pe(t.moves),re(t.rescues),we(t.allowRewind))),"ept"===t.func&&"G"===s&&(Pe(),ee(t.whoseturn),_(t.squares),K(t.usedby),F(t.ptiles),M(t.tiles),be(t.passed),pe(t.moves),re(t.rescues),me({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(t.ptiles),gtiles:Object(c.a)(D)})),"egt"===t.func&&"P"===s&&(Pe(),ee(t.whoseturn),_(t.squares),K(t.usedby),U(t.gtiles),M(t.tiles),be(t.passed),pe(t.moves),me({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(H),gtiles:Object(c.a)(t.gtiles)})),"undoturn"===t.func&&t.sender!==s&&(Pe(),M(t.tiles),F(t.ptiles),U(t.gtiles),_(t.squares),K(t.usedby),ee(t.whoseturn),re(t.rescues),be(t.passed),pe(t.moves),me(t.snapshot)),"allowundo"===t.func&&t.sender!==s&&we(!0),"chat"===t.func&&t.sender!=s)){var n=[].concat(Object(c.a)(Ae),[{from:t.nickname,msg:t.sendmsg}]);qe(n)}}(l)}),[l]),Object(a.useEffect)((function(){P("ScrollableMoves")}),[Oe]),Object(a.useEffect)((function(){P("ScrollableChat")}),[Ae]);var Be=function(e,t,s,n){var a=Object(c.a)(z),r=Object(c.a)(Q),i=Object(c.a)(H),o=Object(c.a)(D),l=Object(c.a)(z[e]),u=z[e][t],d=Object(c.a)(se),b=String(e)+"-"+String(t),j=se.indexOf(b);if(-1===s&&(s=Y,n=oe),s>-1&&u===y){l[t]="P"===$?i[s]:o[s],a[e]=Object(c.a)(l),"P"===$?i.splice(s,1):o.splice(s,1);var O=Object(c.a)(r[e]);return O[t]=$,r[e]=Object(c.a)(O),"P"===$&&s===i.length&&(s-=1),"G"===$&&s===o.length&&(s-=1),V(s),_(a),K(r),F(i),U(o),ne([].concat(Object(c.a)(se),[b])),void le(n)}if(j>-1){"P"===$?i.push(u):o.push(u);var p=Object(c.a)(a[e]);p[t]=y,a[e]=Object(c.a)(p);var h=Object(c.a)(r[e]);return h[t]=k,r[e]=Object(c.a)(h),V("P"===$?i.length-1:o.length-1),d.splice(j,1),_(a),K(r),F(i),U(o),ne(d),void le(-1,-1,w)}if(z[e][t]!==y);else{var f=oe[0]!==e||oe[1]!==t?"r":"r"===oe[2]?"d":"d"===oe[2]?w:"r";le(n=[e,t,f])}},Re=function(e){if(-1!==Y)if(Y!==e){var t="P"===s?Object(c.a)(H):Object(c.a)(D),n=Y,a=t[n],r=e;t.splice(n,1),t.splice(r,0,a),"P"===s?F(t):U(t),V(-1)}else V(-1);else V(e)},Me=function(){if(He()){for(var e=Le(),t=ae,n=["0-0","0-"+b,"0-"+O,b+"-0",b+"-"+O,O+"-0",O+"-"+b,O+"-"+O],a=0;a<se.length;a++)n.indexOf(se[a])>-1&&(t+=1);for(var i=Object(c.a)(H),l=Object(c.a)(R);i.length<d&&l.length>0;){var j=Math.floor(Math.random()*l.length);i.push(l[j]),l.splice(j,1)}i.sort();var p=i.length>0?"G":"X";Q[0][0]!==k&&Q[0][b]!==k&&Q[0][O]!==k&&Q[b][0]!==k&&Q[b][O]!==k&&Q[O][0]!==k&&Q[O][b]!==k&&Q[O][O]!==k&&(p="X");var h=Fe(),f={by:"P",type:"PLAY",rewindInfo:e,mainword:h.mainword,extrawords:h.extrawords,pos:h.pos},m=[].concat(Object(c.a)(Oe),[f]);Pe(),ee(p),F(i),M(l),be(!1),pe(m),re(t),me({squares:Object(c.a)(z),usedby:Object(c.a)(Q),ptiles:Object(c.a)(i),gtiles:Object(c.a)(D)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:s,squares:z,usedby:Q,ptiles:i,tiles:l,whoseturn:p,racksize:d,passed:!1,moves:m,rescues:t}))}},Ge=function(){if(He()){for(var e=Le(),t=Object(c.a)(D),n=Object(c.a)(R);t.length<d&&n.length>0;){var a=Math.floor(Math.random()*n.length);t.push(n[a]),n.splice(a,1)}t.sort();var i=Object(c.a)(z),l=Object(c.a)(Q),j=Object(c.a)(H),p=Object(c.a)(D),h=t.length>0?"P":"X";Q[0][0]!==k&&Q[0][b]!==k&&Q[0][O]!==k&&Q[b][0]!==k&&Q[b][O]!==k&&Q[O][0]!==k&&Q[O][b]!==k&&Q[O][O]!==k&&(h="X");var f=Fe(),m={by:"G",type:"PLAY",rewindInfo:e,mainword:f.mainword,extrawords:f.extrawords,pos:f.pos},v=[].concat(Object(c.a)(Oe),[m]);Pe(),ee(h),U(t),M(n),be(!1),pe(v),me({squares:i,usedby:l,ptiles:j,gtiles:p}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:s,squares:z,usedby:Q,gtiles:t,tiles:n,passed:!1,moves:v,whoseturn:h,racksize:d}))}};function He(){if(z[b][b]===y)return window.alert("First play must hit center square"),!1;for(var e=O+1,t=O+1,s=e,n=-1,c=t,a=-1,r=0;r<e;++r)for(var i=0;i<t;++i)if(z[r][i]!==y){if(!(r>0&&z[r-1][i]!==y)&&!(i>0&&z[r][i-1]!==y)&&!(r<O&&z[r+1][i]!==y)&&!(i<O&&z[r][i+1]!==y))return window.alert("Each played tile must be part of a word"),!1;fe.squares[r][i]===y&&(r<s&&(s=r),r>n&&(n=r),i<c&&(c=i),i>a&&(a=i))}if(s===e)return window.alert("You didn't play any tiles"),!1;if(s!==n&&c!==a)return window.alert("Tiles played must be in a straight line"),!1;var o=!1,l=!1;for(r=s;r<=n;++r)for(i=c;i<=a;++i){if(z[r][i]===y)return window.alert("There is a gap in your word"),!1;fe.squares[r][i]!==y&&(o=!0),s===n&&r>0&&z[r-1][i]!==y&&(l=!0),s===n&&r<O&&z[r+1][i]!==y&&(l=!0),c===a&&i>0&&z[r][i-1]!==y&&(l=!0),c===a&&i<O&&z[r][i+1]!==y&&(l=!0)}return s===n&&c>0&&fe.squares[s][c-1]!==y&&(o=!0),s===n&&a<O&&fe.squares[s][a+1]!==y&&(o=!0),c===a&&s>0&&fe.squares[s-1][c]!==y&&(o=!0),c===a&&n<O&&fe.squares[n+1][c]!==y&&(o=!0),!(!o&&!l&&fe.squares[b][b]!==y)||(window.alert("Words must be connected"),!1)}function Fe(){for(var e="",t=[],s="",n=O+1,a=-1,r=O+1,i=-1,o=se.length,l=0;l<o;++l){var u=parseInt(se[l].split("-")[0]),d=parseInt(se[l].split("-")[1]);u<n&&(n=u),u>a&&(a=u),d<r&&(r=d),d>i&&(i=d)}if(n<a||1===o){for(var b=r,j=n;j>0&&z[j-1][b]!==y;)j-=1;for(var f=a;f<O&&z[f+1][b]!==y;)f+=1;s=p[b]+h[j];for(var m=j;m<=f;++m){e+=z[m][b];var v=m+"-"+b;if(se.indexOf(v)>-1){for(var g=b;g>0&&z[m][g-1]!==y;)g-=1;for(var x=b;x<O&&z[m][x+1]!==y;)x+=1;if(g<x){for(var k="",w=g;w<=x;++w)k+=z[m][w];t=[].concat(Object(c.a)(t),[k])}}}}if(e.length<2){for(var N=n,S=r;S>0&&z[N][S-1]!==y;)S-=1;for(var C=i;C<O&&z[N][C+1]!==y;)C+=1;s=h[N]+p[S],e="",t=[];for(var T=S;T<=C;++T){e+=z[N][T];var A=N+"-"+T;if(se.indexOf(A)>-1){for(var q=N;q>0&&z[q-1][T]!==y;)q-=1;for(var I=N;I<O&&z[I+1][T]!==y;)I+=1;if(q<I){for(var E="",P=q;P<=I;++P)E+=z[P][T];t=[].concat(Object(c.a)(t),[E])}}}}return{mainword:e,extrawords:t,pos:s}}function Le(){return{squares:Object(c.a)(fe.squares),usedby:Object(c.a)(fe.usedby),rack:"G"===$?Object(c.a)(fe.gtiles):Object(c.a)(fe.ptiles),tiles:Object(c.a)(R),rescues:ae,passed:de}}function De(){ke||(we(!0),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"allowundo",racksize:d,sender:s})))}function Ue(){var e=Oe.length,t=Oe[Oe.length-1],n=Object(c.a)(t.rewindInfo.squares),a=Object(c.a)(t.rewindInfo.usedby),i=Object(c.a)(t.rewindInfo.tiles),l="P"===t.by?Object(c.a)(t.rewindInfo.rack):Object(c.a)(H),b="G"===t.by?Object(c.a)(t.rewindInfo.rack):Object(c.a)(D),j=t.rewindInfo.rescues,O=t.by,p=Object(c.a)(Oe);p.splice(e-1,1);var h={squares:Object(c.a)(n),usedby:Object(c.a)(a),gtiles:Object(c.a)(b),ptiles:Object(c.a)(l)},f=t.passed;Pe(),M(i),F(l),U(b),_(n),K(a),ee(O),re(j),be(f),pe(p),me(h),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"undoturn",racksize:d,sender:s,tiles:i,ptiles:l,gtiles:b,squares:n,usedby:a,whoseturn:O,rescues:j,passed:f,moves:p,snapshot:h}))}var Je=function(){_(Object(c.a)(fe.squares)),K(Object(c.a)(fe.usedby)),F(Object(c.a)(fe.ptiles)),U(Object(c.a)(fe.gtiles)),V(-1),ne([]),le([-1,-1,w])},ze=function(){u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",sender:s,whoseturn:$,racksize:d,func:"requestgamedata"}))};return Object(n.jsxs)("div",{className:"prisonbreak",children:[Object(n.jsxs)("div",{className:"w3-display-container w3-teal topBarHeight",children:[Object(n.jsx)("div",{className:"w3-display-middle",children:Object(n.jsx)("h1",{className:"myHeadingFont",children:"Prison Break"})}),Object(n.jsxs)("div",{className:"w3-display-topleft w3-black topBarCorner commonFontFamily",children:["Game id: ",r]}),Object(n.jsxs)("div",{className:"w3-display-bottomleft w3-orange topBarCorner commonFontFamily",children:["Prisoners: ","P"===s?o:Se]}),Object(n.jsx)("div",{className:"w3-display-topright w3-black topBarCorner commonFontFamily",children:Object(n.jsx)(i.a,{href:"../../",children:Object(n.jsx)("a",{children:Object(n.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})})}),Object(n.jsxs)("div",{className:"w3-display-bottomright w3-orange topBarCorner commonFontFamily",children:["Guards: ","P"===s?Se:o]})]}),Object(n.jsxs)("div",{className:"row",children:[Object(n.jsxs)("div",{className:"col pbTileAndMovesOuter",children:[Object(n.jsx)(A,{tiles:R,othertiles:"P"===s?D:H}),Object(n.jsx)(q,{moves:Oe})]}),Object(n.jsx)("div",{className:"col pbPlayerOuterSection",children:"P"===s?Object(n.jsx)(j.default,{racktiles:H,whoseturn:$,selection:Y,onClick:function(e){return Re(e)},onClickFinishTurn:function(){return Me()},onClickTileRecall:function(){return Je()},onClickTileExchange:function(){return function(){if(R.length<d)window.alert("Need "+d+" tiles in the bag to exchange");else{for(var e=Le(),t=[],n=Object(c.a)(R);t.length<d&&n.length>0;){var a=Math.floor(Math.random()*n.length);t.push(n[a]),n.splice(a,1)}t.sort(),(n=[].concat(Object(c.a)(n),Object(c.a)(fe.ptiles))).sort();var i={by:"P",type:"SWAP",rewindInfo:e},l=[].concat(Object(c.a)(Oe),[i]);Pe(),_(Object(c.a)(fe.squares)),K(Object(c.a)(fe.usedby)),ee("G"),F(t),M(n),be(!1),pe(l),me({squares:Object(c.a)(fe.squares),usedby:Object(c.a)(fe.usedby),ptiles:[].concat(t),gtiles:Object(c.a)(D)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:s,whoseturn:"G",racksize:d,squares:fe.squares,usedby:fe.usedby,ptiles:t,tiles:n,passed:!1,moves:l,rescues:ae}))}}()},onClickPassPlay:function(){return function(){var e=Le(),t=de?"X":"G",n={by:"P",type:"PASS",rewindInfo:e},a=[].concat(Object(c.a)(Oe),[n]);Je(),Pe(),ee(t),be(!0),pe(a),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"ept",sender:s,squares:fe.squares,usedby:fe.usedby,ptiles:fe.ptiles,tiles:R,whoseturn:t,racksize:d,passed:!0,moves:a,rescues:ae}))}()},onClickUndoLastPlay:function(){return Ue()},onClickAllowUndo:function(){return De()},prisonersOrGuards:s,moves:Oe,allowRewind:ke}):Object(n.jsx)(j.default,{racktiles:D,whoseturn:$,selection:Y,onClick:function(e){return Re(e)},onClickFinishTurn:function(){return Ge()},onClickTileRecall:function(){return Je()},onClickTileExchange:function(){return function(){if(R.length<d)window.alert("Need "+d+" tiles in the bag to exchange");else{for(var e=Le(),t=[],n=Object(c.a)(R);t.length<d&&n.length>0;){var a=Math.floor(Math.random()*n.length);t.push(n[a]),n.splice(a,1)}t.sort(),(n=[].concat(Object(c.a)(n),Object(c.a)(fe.gtiles))).sort();var i={by:"G",type:"SWAP",rewindInfo:e},l=[].concat(Object(c.a)(Oe),[i]);Pe(),_(Object(c.a)(fe.squares)),K(Object(c.a)(fe.usedby)),ee("P"),U(t),M(n),be(!1),pe(l),me({squares:Object(c.a)(fe.squares),usedby:Object(c.a)(fe.usedby),ptiles:Object(c.a)(H),gtiles:[].concat(t)}),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:s,whoseturn:"P",racksize:d,squares:fe.squares,usedby:fe.usedby,gtiles:t,tiles:n,passed:!1,moves:l}))}}()},onClickPassPlay:function(){return function(){var e=Le(),t=de?"X":"P",n={by:"G",type:"PASS",rewindInfo:e},a=[].concat(Object(c.a)(Oe),[n]);Je(),Pe(),ee(t),be(!0),pe(a),u.send(JSON.stringify({gameid:r,nickname:o,type:"pb",func:"egt",sender:s,squares:fe.squares,usedby:fe.usedby,gtiles:fe.gtiles,tiles:R,whoseturn:t,racksize:d,passed:!0,moves:a}))}()},onClickUndoLastPlay:function(){return Ue()},onClickAllowUndo:function(){return De()},prisonersOrGuards:s,moves:Oe,allowRewind:ke})}),Object(n.jsx)("div",{className:"col",children:s===$?Object(n.jsx)("div",{className:"row",onKeyDownCapture:function(e){if(e.preventDefault(),s===$)if("Enter"!==e.key)if("Escape"!==e.key){if(e.key.match(/^[A-Za-z\?]$/)){var t=e.key.toUpperCase(),n="P"===$?H:D,a=n.indexOf(t);if(-1===a&&(a=n.indexOf("?")),a>-1){var r=oe[0],i=oe[1],o=oe[2];if(r>-1&&i>-1&&o!==w){if("r"===o){for(var l=-1,u=i+1;u<O+1&&-1===l;u++)z[r][u]===y&&(l=u);return Be(r,i,a,-1===l?[-1,-1,w]:[r,l,"r"]),void V(-1)}if("d"===o){for(var b=-1,j=2*d+1,p=r+1;p<j&&-1===b;p++)z[p][i]===y&&(b=p);return Be(r,i,a,-1===b?[-1,-1,w]:[b,i,"d"]),void V(-1)}}}}else if("Backspace"===e.key&&se.length>0){var h=se[se.length-1],f=Object(c.a)(se),m=Object(c.a)(H),v=Object(c.a)(D),g=Object(c.a)(Q),x=Object(c.a)(z),N=[-1,-1,w],S=Y;f.splice(se.length-1,1);var C=parseInt(h.split("-")[0]),T=parseInt(h.split("-")[1]),A=z[C][T];"P"===$?(m.push(A),S=m.length-1):(v.push(A),S=v.length-1),g[C][T]=k,x[C][T]=y;var q=oe[2];q!==w&&(N=[C,T,q],1===se.length&&(S=-1)),ne(f),U(v),F(m),_(x),K(g),le(N),V(S)}}else Je();else"P"===$?Me():Ge()},children:Object(n.jsx)(C,{squares:z,usedby:Q,rcd:oe,onClick:function(e,t){return Be(e,t,-1,null)},racksize:d})}):Object(n.jsx)("div",{className:"row",children:Object(n.jsx)(C,{squares:z,usedby:Q,rcd:oe,onClick:function(){},racksize:d})})}),Object(n.jsxs)("div",{className:"col",children:[Object(n.jsx)(I,{rescues:ae}),Object(n.jsx)(E,{gameid:r,client:u,nickname:o,msgs:Ae,setMsgs:qe,prisonersOrGuards:s})]})]}),Object(n.jsx)("div",{className:"w3-display-container w3-teal topBarHeight",children:Object(n.jsx)("div",{className:"w3-display-middle commonFontFamily",children:"X"===$?Object(n.jsx)("h1",{children:"Game Over!"}):Object(n.jsx)("p",{children:f[ge]})})})]})},A=function(e){var t=[].concat(Object(c.a)(e.tiles),Object(c.a)(e.othertiles));return t.sort(),"?"===t[0]&&(t.splice(0,1),t.push("?")),"?"===t[0]&&(t.splice(0,1),t.push("?")),Object(n.jsxs)("div",{className:"pbTilepool",children:[Object(n.jsx)("div",{className:"pbTilepoolTitle",children:"TILES"}),t.map((function(e,s){return Object(n.jsxs)("span",{children:[s>0&&e!==t[s-1]?Object(n.jsx)("span",{className:"pbTilepoolDivider"}):Object(n.jsx)(n.Fragment,{}),Object(n.jsx)("span",{className:"Q"===e?"pbTilepoolTile u":"pbTilepoolTile",children:e})]},"tile".concat(s))}))]})},q=function(e){return Object(n.jsxs)("div",{className:"pbMoves",children:[Object(n.jsx)("div",{className:"pbMovesTitle",children:"MOVES"}),Object(n.jsx)("div",{className:"pbMovesScrollable",id:"ScrollableMoves",children:e.moves.map((function(e,t){var s;return Object(n.jsxs)("div",{className:"pbMove",children:[Object(n.jsx)("span",{className:"pbMove by",children:e.by}),":",Object(n.jsx)("span",{className:"pbMove ".concat(e.type),children:"PLAY"===e.type?Object(n.jsxs)(n.Fragment,{children:[e.pos," ",e.mainword.replace("Q","Qu"),null===(s=e.extrawords)||void 0===s?void 0:s.map((function(e){return Object(n.jsxs)(n.Fragment,{children:[",\xa0",e.replace("Q","Qu")]})}))]}):Object(n.jsx)(n.Fragment,{})})]},"move".concat(t))}))})]})},I=function(e){return Object(n.jsxs)("div",{className:"pbRescuesMade",children:["Rescues made: ",e.rescues]})},E=function(e){var t=e.gameid,s=e.client,r=e.nickname,i=e.msgs,o=e.setMsgs,l=e.prisonersOrGuards,u=Object(a.useState)(""),d=u[0],b=u[1];return Object(n.jsx)("div",{id:"ScrollableChat",className:"pbChat",children:Object(n.jsx)("table",{className:"pbChatTable",children:Object(n.jsxs)("tbody",{children:[i.map((function(e,t){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{className:"pbChatFrom",children:e.from}),Object(n.jsx)("td",{className:"pbChatMsg",children:e.msg})]},"ChatMessage".concat(t))})),Object(n.jsx)("tr",{children:Object(n.jsx)("td",{colSpan:"2",children:Object(n.jsx)("textarea",{className:""===d?"pbChatInputEmpty":"pbChatInput",name:"nextmsgInputArea",value:d,onChange:function(e){b(e.target.value)},onKeyDownCapture:function(e){if("Enter"===e.key&&d.length>0){e.preventDefault();var n=[].concat(Object(c.a)(i),[{from:r,msg:d}]),a=d;return o(n),b(""),void s.send(JSON.stringify({gameid:t,nickname:r,type:"pb",func:"chat",sender:l,sendmsg:a}))}if("Backspace"===e.key&&d.length>0){e.preventDefault();var u=d.slice(0,d.length-1);b(u)}},placeholder:"chat..."})})})]})})})},P=function(e){var t=document.getElementById(e);t.scrollTop=t.scrollHeight}}},[["dsDM",0,1,2,3,4]]]);