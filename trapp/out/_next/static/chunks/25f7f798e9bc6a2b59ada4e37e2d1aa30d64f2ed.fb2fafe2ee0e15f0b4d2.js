(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[4],{"8E7g":function(e,t){e.exports={InitialSquareArray:function(e){for(var t=2*e+1,n=Array(t),r=0;r<t;++r){for(var a=Array(t),c=0;c<t;++c){var s={row:r,col:c,type:"style2",usedby:"",letter:""};r===e&&c===e?s.type="CenterSquare":r%e===0&&c%e===0?s.type="EscapeHatch":r%2===c%2&&(s.type="style1"),a[c]=s}n[r]=[].concat(a)}return n}}},A1c0:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("EzCb");t.default=function(e){var t=e.usedby,n=e.type,c=e.letter,s=e.ri,i=e.ci,o=e.rcd,l=e.onClick,u=t!==a.x?"pbSquareInner PlayerTile":o[0]===s&&o[1]===i&&o[2]===a.f?"pbSquareInner RightArrow":o[0]===s&&o[1]===i&&o[2]===a.d?"pbSquareInner DownArrow":"pbSquareInner "+n,d=t!==a.x?c:u.indexOf("RightArrow")>-1?"\u27a1":u.indexOf("DownArrow")>-1?"\u2b07":u.indexOf("CenterSquare")>-1?Object(r.jsx)("i",{className:"material-icons",children:"stars"}):u.indexOf("EscapeHatch")>-1?Object(r.jsx)("i",{className:"material-icons",children:a.m}):".";return t===a.x?Object(r.jsx)("button",{className:u,onClick:l,children:d}):Object(r.jsx)("button",{className:u,onClick:l,children:Object(r.jsx)("div",{className:"pbSquareTileText ".concat(t+("Q"===c?" u":"")),children:d})})}},EzCb:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"r",(function(){return c})),n.d(t,"q",(function(){return s})),n.d(t,"p",(function(){return i})),n.d(t,"A",(function(){return o})),n.d(t,"z",(function(){return l})),n.d(t,"y",(function(){return u})),n.d(t,"m",(function(){return d})),n.d(t,"l",(function(){return b})),n.d(t,"o",(function(){return f})),n.d(t,"n",(function(){return p})),n.d(t,"j",(function(){return j})),n.d(t,"k",(function(){return h})),n.d(t,"i",(function(){return m})),n.d(t,"f",(function(){return O})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return y})),n.d(t,"x",(function(){return x})),n.d(t,"g",(function(){return g})),n.d(t,"s",(function(){return N})),n.d(t,"t",(function(){return w})),n.d(t,"u",(function(){return A})),n.d(t,"v",(function(){return k})),n.d(t,"w",(function(){return C})),n.d(t,"h",(function(){return S})),n.d(t,"a",(function(){return E}));var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],a=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],c="U",s="P",i="G",o=s,l=i,u="X",d="run_circle",b="security",f="PRISONERS",p="GUARDS",j="PLAY",h="SWAP",m="PASS",O="r",v="d",y="",x="",g=["Escapee: \"I'm free! I'm free!\". Little kid: \"I'm four! I'm four!\"","Two peanuts were walking down a back alley. One was a salted.","The psychic dwarf escaped! There's a small medium at large!","What do you call a vegetable who has escaped prison? An escapea!","The prisoners fave punctuation is a period. It marks the end of a sentence!","Prison is only one word, but to robbers it's a whole sentence."],N=2e4,w=["A","A","A","B","C","D","E","E","E","E","F","G","H","I","I","I","J","K","L","M","N","N","O","O","O","P","Q","R","R","S","T","T","U","V","W","X","Y","Z","?","?"],A=["A","A","A","A","A","B","C","D","D","E","E","E","E","E","E","F","G","H","I","I","I","I","I","J","K","L","L","M","N","N","N","O","O","O","O","P","Q","R","R","R","S","S","T","T","T","U","V","W","X","Y","Z","?","?"],k=["A","A","A","A","A","A","A","B","B","C","C","D","D","D","E","E","E","E","E","E","E","E","E","F","G","G","H","H","I","I","I","I","I","I","I","J","K","L","L","L","M","M","N","N","N","N","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","S","S","S","T","T","T","T","U","U","U","V","W","X","Y","Z","?","?"],C=["A","A","A","A","A","A","A","A","A","B","B","C","C","D","D","D","D","E","E","E","E","E","E","E","E","E","E","E","E","F","F","G","G","G","H","H","I","I","I","I","I","I","I","I","I","J","K","L","L","L","L","M","M","N","N","N","N","N","N","O","O","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","R","S","S","S","S","T","T","T","T","T","T","U","U","U","U","V","V","W","W","X","Y","Y","Z","?","?"],S="";function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=(e.length-1)/2,n=2*t,r=t,a=!0;return e[0][0].usedby!==x&&e[0][r].usedby!==x&&e[0][n].usedby!==x&&e[r][0].usedby!==x&&e[r][n].usedby!==x&&e[n][0].usedby!==x&&e[n][r].usedby!==x&&e[n][n].usedby!==x&&(a=!1),a}},KQm4:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,"a",(function(){return a}))},KiN8:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("EzCb");t.default=function(e){var t=e.moves;return Object(r.jsxs)("div",{className:"pbMoves",children:[Object(r.jsx)("div",{className:"pbMovesTitle",children:"MOVES"}),Object(r.jsx)("div",{className:"pbMovesScrollable",id:"ScrollableMoves",children:t&&t.map((function(e,t){var n;return Object(r.jsxs)("div",{className:"pbMove",children:[Object(r.jsx)("span",{className:"pbMove by",children:e.by}),":",Object(r.jsx)("span",{className:"pbMove ".concat(e.type),children:e.type===a.j?Object(r.jsxs)(r.Fragment,{children:[e.pos," ",e.mainword.replace("Q","Qu"),null===(n=e.extrawords)||void 0===n?void 0:n.map((function(e,t){return Object(r.jsxs)("span",{children:[",\xa0",e.replace("Q","Qu")]},"extraword".concat(t))}))]}):Object(r.jsx)(r.Fragment,{})})]},"move".concat(t))}))})]})}},NOQH:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("EzCb"),c=function(e){var t="pbTileOnRack "+(e.selection===e.tileindex?"Selected ":"Unselected ")+("Q"===e.tilevalue?"u ":"")+e.participant,n=e.tileindex;return Object(r.jsx)("div",{className:t,onClick:function(t){return e.onClick(t)},children:Object(r.jsx)("div",{className:"pbTileOnRackText",children:e.tilevalue})},n)},s=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"check"}),"\xa0Finish Turn"]})})},i=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"undo"}),"\xa0Recall Tiles"]})})},o=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"cached"}),"\xa0Swap Tiles"]})})},l=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"not_interested"}),"\xa0Pass Turn"]})})},u=function(e){return e.alreadyAllowed?Object(r.jsx)("div",{className:"pbActionButtonSevere",children:Object(r.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(r.jsx)("i",{className:"material-icons",children:"report"}),"\xa0ENABLED",Object(r.jsx)("span",{className:"pbActionButtonSevereText2",children:"\xa0Allow undo is now enabled"})]})}):Object(r.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(r.jsx)("i",{className:"material-icons",children:"report_problem"}),"\xa0Allow Undo Turn",Object(r.jsx)("span",{className:"pbActionButtonSevereText2",children:"Click to let opponent undo"})]})})},d=function(e){return Object(r.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(r.jsx)("i",{className:"material-icons",children:"delete_forever"}),"\xa0Undo My Turn",Object(r.jsx)("span",{className:"pbActionButtonSevereText2",children:"Opponent has allowed undo"})]})})};function b(e){return Object(r.jsxs)("div",{className:"pbActionButtonDiv",children:[Object(r.jsx)("p",{children:Object(r.jsx)(s,{onClick:function(){return e.onClickFinishTurn()}})}),Object(r.jsx)("p",{children:Object(r.jsx)(i,{onClick:function(){return e.onClickTileRecall()}})}),Object(r.jsx)("p",{children:Object(r.jsx)(o,{onClick:function(){return e.onClickTileExchange()}})}),Object(r.jsx)("p",{children:Object(r.jsx)(l,{onClick:function(){return e.onClickPassPlay()}})})]})}function f(e){return Object(r.jsx)("div",{className:"pbActionButtonDiv",children:Object(r.jsx)("div",{children:Object(r.jsx)(u,{onClick:function(){return e.onClickAllowUndo()},alreadyAllowed:e.allowRewind})})})}function p(e){return Object(r.jsx)("div",{className:"pbActionButtonDiv",children:Object(r.jsx)("p",{children:Object(r.jsx)(d,{onClick:function(){return e.onClickUndoLastPlay()}})})})}t.default=function(e){var t=e.participant===a.q?a.m:a.l,n=e.participant===a.q?a.o:a.n;return Object(r.jsxs)("div",{className:"pbPlayerInnerSection",children:[Object(r.jsxs)("div",{className:"pbPlayerTitle",children:[Object(r.jsx)("i",{className:"material-icons",children:t}),"\xa0",n,"\xa0",Object(r.jsx)("i",{className:"material-icons",children:t})]}),Object(r.jsx)("div",{className:"pbTilerack",children:e.racktiles&&e.racktiles.map((function(t,n){return Object(r.jsx)(c,{whoseturn:e.whoseturn,participant:e.participant,selection:e.selection,tileindex:n,tilevalue:t,onClick:function(){return e.onClick(n)}},"RackTile".concat(n))}))}),e.whoseturn===e.participant?b(e):e.allowRewind&&e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by===e.participant&&p(e),e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by!==e.participant&&f(e)]})}},XxGB:function(e,t,n){"use strict";n.r(t);var r=n("nKUr");t.default=function(e){var t=e.rescues;return Object(r.jsxs)("div",{className:"pbRescuesMade",children:["Rescues made: ",t]})}},YFqc:function(e,t,n){e.exports=n("cTJO")},cTJO:function(e,t,n){"use strict";var r=n("J4zp"),a=n("284h");t.__esModule=!0,t.default=void 0;var c=a(n("q1tI")),s=n("elyg"),i=n("nOHt"),o=n("vNVm"),l={};function u(e,t,n,r){if(e&&(0,s.isLocalURL)(t)){e.prefetch(t,n,r).catch((function(e){0}));var a=r&&"undefined"!==typeof r.locale?r.locale:e&&e.locale;l[t+"%"+n+(a?"%"+a:"")]=!0}}var d=function(e){var t=!1!==e.prefetch,n=(0,i.useRouter)(),a=n&&n.pathname||"/",d=c.default.useMemo((function(){var t=(0,s.resolveHref)(a,e.href,!0),n=r(t,2),c=n[0],i=n[1];return{href:c,as:e.as?(0,s.resolveHref)(a,e.as):i||c}}),[a,e.href,e.as]),b=d.href,f=d.as,p=e.children,j=e.replace,h=e.shallow,m=e.scroll,O=e.locale;"string"===typeof p&&(p=c.default.createElement("a",null,p));var v=c.Children.only(p),y=v&&"object"===typeof v&&v.ref,x=(0,o.useIntersection)({rootMargin:"200px"}),g=r(x,2),N=g[0],w=g[1],A=c.default.useCallback((function(e){N(e),y&&("function"===typeof y?y(e):"object"===typeof y&&(y.current=e))}),[y,N]);(0,c.useEffect)((function(){var e=w&&t&&(0,s.isLocalURL)(b),r="undefined"!==typeof O?O:n&&n.locale,a=l[b+"%"+f+(r?"%"+r:"")];e&&!a&&u(n,b,f,{locale:r})}),[f,b,w,O,t,n]);var k={ref:A,onClick:function(e){v.props&&"function"===typeof v.props.onClick&&v.props.onClick(e),e.defaultPrevented||function(e,t,n,r,a,c,i,o){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&(0,s.isLocalURL)(n))&&(e.preventDefault(),null==i&&(i=r.indexOf("#")<0),t[a?"replace":"push"](n,r,{shallow:c,locale:o,scroll:i}).then((function(e){e&&i&&document.body.focus()})))}(e,n,b,f,j,h,m,O)},onMouseEnter:function(e){(0,s.isLocalURL)(b)&&(v.props&&"function"===typeof v.props.onMouseEnter&&v.props.onMouseEnter(e),u(n,b,f,{priority:!0}))}};if(e.passHref||"a"===v.type&&!("href"in v.props)){var C="undefined"!==typeof O?O:n&&n.locale,S=(0,s.getDomainLocale)(f,C,n&&n.locales,n&&n.domainLocales);k.href=S||(0,s.addBasePath)((0,s.addLocale)(f,C,n&&n.defaultLocale))}return c.default.cloneElement(v,k)};t.default=d},gx3M:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("KQm4"),c=n("q1tI");t.default=function(e){var t=e.gameid,n=void 0===t?"":t,s=e.client,i=e.nickname,o=e.msgs,l=void 0===o?[]:o,u=e.setMsgs,d=e.participant,b=void 0===d?"":d,f=Object(c.useState)(""),p=f[0],j=f[1];return Object(r.jsx)("div",{id:"ScrollableChat",className:"pbChat",children:Object(r.jsx)("table",{className:"pbChatTable",children:Object(r.jsxs)("tbody",{children:[l.map((function(e,t){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"pbChatFrom",children:e.from}),Object(r.jsx)("td",{className:"pbChatMsg",children:e.msg})]},"ChatMessage".concat(t))})),Object(r.jsx)("tr",{children:Object(r.jsx)("td",{colSpan:"2",children:""===i?Object(r.jsx)("span",{children:"Please enter nickname to use chat"}):Object(r.jsx)("textarea",{className:""===p?"pbChatInputEmpty":"pbChatInput",name:"nextmsgInputArea",value:p,onChange:function(e){j(e.target.value)},onKeyDownCapture:function(e){if("Enter"===e.key&&p.length>0){e.preventDefault();var t=[].concat(Object(a.a)(l),[{from:i,msg:p}]),r=p;return u(t),j(""),void s.send({gameid:n,nickname:i,type:"pb",func:"chat",sender:b,sendmsg:r})}if("Backspace"===e.key&&p.length>0){e.preventDefault();var c=p.slice(0,p.length-1);j(c)}},placeholder:"chat..."})})})]})})})}},qa2E:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("KQm4");t.default=function(e){var t=e.tiles,n=e.othertiles,c=[].concat(Object(a.a)(t||[]),Object(a.a)(n||[]));return c.sort(),"?"===c[0]&&(c.splice(0,1),c.push("?")),"?"===c[0]&&(c.splice(0,1),c.push("?")),Object(r.jsxs)("div",{className:"pbTilepool",children:[Object(r.jsx)("div",{className:"pbTilepoolTitle",children:"TILES"}),c.map((function(e,t){return Object(r.jsxs)("span",{children:[t>0&&e!==c[t-1]?Object(r.jsx)("span",{className:"pbTilepoolDivider"}):Object(r.jsx)(r.Fragment,{}),Object(r.jsx)("span",{className:"Q"===e?"pbTilepoolTile u":"pbTilepoolTile",children:e})]},"tile".concat(t))}))]})}},rZeA:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("A1c0"),c=n("EzCb");t.default=function(e){var t=e.onClick,n=e.squareArray,s=void 0===n?[]:n,i=e.rcd,o=function(e){return Object(r.jsxs)("tr",{className:"pbRow",children:[Object(r.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderLeft",children:c.c[e]}),s[e].map((function(e){return function(e){return Object(r.jsx)("td",{className:"pbSquareOuter",children:Object(r.jsx)(a.default,{usedby:e.usedby,type:e.type,letter:e.letter,ri:e.row,ci:e.col,rcd:i,onClick:function(){return t(e.row,e.col)}})},"Square".concat(e.row,"-").concat(e.col))}(e)})),Object(r.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderRight",children:c.c[e]})]},"BoardRow".concat(e))};return Object(r.jsx)("table",{className:"pbBoard",children:Object(r.jsxs)("tbody",{children:[Object(r.jsxs)("tr",{className:"pbBoardColumnHeaderRow",children:[Object(r.jsx)("td",{className:"pbBoardHeaderTopLeft",children:"\xa0"}),s.map((function(e,t){return Object(r.jsx)("td",{className:"pbBoardColumnHeader",children:c.b[t]},"TopColumnHeader".concat(t))})),Object(r.jsx)("td",{className:"pbBoardHeaderTopRight",children:"\xa0"})]}),s.map((function(e,t){return o(t)})),Object(r.jsxs)("tr",{className:"pbBoardColumnHeaderRow",id:"BoardHeaderBottom",children:[Object(r.jsx)("td",{className:"pbBoardHeaderBottomLeft",children:"\xa0"}),s.map((function(e,t){return Object(r.jsx)("td",{className:"pbBoardColumnHeader",children:c.b[t]},"BottomColumnHeader".concat(t))})),Object(r.jsx)("td",{className:"pbBoardHeaderBottomRight",children:"\xa0"})]})]})})}},vNVm:function(e,t,n){"use strict";var r=n("J4zp"),a=n("TqRt");t.__esModule=!0,t.useIntersection=function(e){var t=e.rootMargin,n=e.disabled||!i,a=(0,c.useRef)(),l=(0,c.useState)(!1),u=r(l,2),d=u[0],b=u[1],f=(0,c.useCallback)((function(e){a.current&&(a.current(),a.current=void 0),n||d||e&&e.tagName&&(a.current=function(e,t,n){var r=function(e){var t=e.rootMargin||"",n=o.get(t);if(n)return n;var r=new Map,a=new IntersectionObserver((function(e){e.forEach((function(e){var t=r.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)}))}),e);return o.set(t,n={id:t,observer:a,elements:r}),n}(n),a=r.id,c=r.observer,s=r.elements;return s.set(e,t),c.observe(e),function(){s.delete(e),c.unobserve(e),0===s.size&&(c.disconnect(),o.delete(a))}}(e,(function(e){return e&&b(e)}),{rootMargin:t}))}),[n,t,d]);return(0,c.useEffect)((function(){i||d||(0,s.default)((function(){return b(!0)}))}),[d]),[f,d]};var c=n("q1tI"),s=a(n("0G5g")),i="undefined"!==typeof IntersectionObserver;var o=new Map},yhjZ:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),a=n("KQm4"),c=n("q1tI"),s=n("YFqc"),i=n.n(s),o=n("NOQH"),l=n("rZeA"),u=n("qa2E"),d=n("KiN8"),b=n("XxGB"),f=n("gx3M"),p=n("EzCb"),j=n("8E7g"),h=function(e){var t=document.getElementById(e);t.scrollTop=t.scrollHeight};t.default=function(e){var t=e.isrejoin,n=e.participant,s=e.gameid,m=e.nickname,O=e.wsmessage,v=e.client,y=e.racksize,x=void 0===y?4:y,g=x,N=2*x,w=6===x?p.v:7===x?p.w:5===x?p.u:p.t,A=Object(c.useState)(Object(a.a)(w)),k=A[0],C=A[1],S=Object(c.useState)([]),E=S[0],T=S[1],I=Object(c.useState)([]),B=I[0],q=I[1],R=Object(c.useState)([]),M=R[0],H=R[1],U=Object(c.useState)(-1),L=U[0],J=U[1],P=Object(c.useState)(p.A),F=P[0],D=P[1],K=Object(c.useState)([]),z=K[0],G=K[1],Q=Object(c.useState)(0),_=Q[0],Y=Q[1],V=Object(c.useState)([-1,-1,p.e]),Z=V[0],W=V[1],X=Object(c.useState)([]),$=X[0],ee=X[1],te=Object(c.useState)({squareArray:[],ptiles:[],gtiles:[]}),ne=te[0],re=te[1],ae=Object(c.useState)(0),ce=ae[0],se=ae[1],ie=Object(c.useState)(!1),oe=ie[0],le=ie[1],ue=Object(c.useState)(""),de=ue[0],be=ue[1],fe=Object(c.useState)([]),pe=fe[0],je=fe[1],he=function(e){var t=Object(c.useRef)();return Object(c.useEffect)((function(){t.current=e})),t.current}(_);Object(c.useEffect)((function(){if(_>he){var e=document.createElement("audio");e.src=n===p.p?"https://tilerunner.github.io/OneGotAway.m4a":"https://tilerunner.github.io/yippee.m4a",e.play()}}),[_]),Object(c.useEffect)((function(){var e=ce+1;e>=p.g.length&&(e=0),se(e);var t=setInterval((function(){n!==F&&F!==p.y&&Ie()}),p.s);return function(){return clearInterval(t)}}),[F]);var me=function(e){for(var t=[],r=[],c=Object(a.a)(w);t.length<x;){var i=Math.floor(Math.random()*c.length);t.push(c[i]),c.splice(i,1),i=Math.floor(Math.random()*c.length),r.push(c[i]),c.splice(i,1)}t.sort(),r.sort(),q(r),T(t),C(c),re({squareArray:e,ptiles:[].concat(t),gtiles:[].concat(r)}),v.send({type:"pb",func:"startgame",gameid:s,racksize:x,sender:n,pname:m,tiles:c,ptiles:t,gtiles:r})},Oe=function(){v.send({gameid:s,gname:m,type:"pb",func:"joingame",sender:n})},ve=function(){v.send({gameid:s,type:"pb",func:"rejoingame",sender:n})};function ye(){J(-1),le(!1),W(-1,-1,p.e),G([])}Object(c.useEffect)((function(){!function(){var e=Object(j.InitialSquareArray)(x);H(e),t?ve():n===p.q?me(e):Oe()}()}),[]),Object(c.useEffect)((function(){""!==O&&function(e){var t=JSON.parse(e);if(t.gameid===s&&"pb"===t.type){if("providegamedata"===t.func){n===p.q?be(t.gname):be(t.pname),C(t.tiles),H(t.squareArray),T(t.ptiles),q(t.gtiles),D(t.whoseturn);var r={squareArray:JSON.parse(JSON.stringify(t.squareArray)),ptiles:Object(a.a)(t.ptiles),gtiles:Object(a.a)(t.gtiles)};re(r),ee(t.moves),Y(t.rescues),le(t.allowRewind),ye()}if("providegname"===t.func&&n===p.o&&be(t.gname),"allowundo"===t.func&&le(!0),"chat"===t.func&&t.sender!=n){var c=[].concat(Object(a.a)(pe),[{from:t.nickname,msg:t.sendmsg}]);je(c)}}}(O)}),[O]),Object(c.useEffect)((function(){h("ScrollableMoves")}),[$]),Object(c.useEffect)((function(){h("ScrollableChat")}),[pe]);var xe=function(e,t,n,r){var c=JSON.parse(JSON.stringify(M)),s=Object(a.a)(c[e]),i=s[t],o=Object(a.a)(E),l=Object(a.a)(B),u=Object(a.a)(z),d=String(e)+"-"+String(t),b=z.indexOf(d);if(-1===n&&(n=L,r=Z),n>-1&&i.usedby===p.x){var f=F===p.A?o[n]:l[n];return i.letter=f,i.usedby=F,s[t]=i,c[e]=Object(a.a)(s),F===p.A?o.splice(n,1):l.splice(n,1),F===p.A&&n===o.length&&(n-=1),F===p.z&&n===l.length&&(n-=1),J(n),H(c),T(o),q(l),G([].concat(Object(a.a)(z),[d])),void W(r)}if(b>-1)return F===p.A?o.push(i.letter):l.push(i.letter),i.usedby=p.x,i.letter=p.h,s[t]=i,c[e]=Object(a.a)(s),J(F===p.A?o.length-1:l.length-1),u.splice(b,1),H(c),T(o),q(l),G(u),void W(-1,-1,p.e);if(i.usedby!==p.x);else{var j=Z[0]!==e||Z[1]!==t?p.f:Z[2]===p.f?p.d:Z[2]===p.d?p.e:p.f;W(r=[e,t,j])}},ge=function(e){if(-1!==L)if(L!==e){var t=n===p.q?Object(a.a)(E):Object(a.a)(B),r=L,c=t[r],s=e;t.splice(r,1),t.splice(s,0,c),n===p.q?T(t):q(t),J(-1)}else J(-1);else J(e)},Ne=function(){if(Ae()){for(var e=_,t=["0-0","0-"+g,"0-"+N,g+"-0",g+"-"+N,N+"-0",N+"-"+g,N+"-"+N],r=0;r<z.length;r++)t.indexOf(z[r])>-1&&(e+=1);for(var c=Object(a.a)(E),i=Object(a.a)(k);c.length<x&&i.length>0;){var o=Math.floor(Math.random()*i.length);c.push(i[o]),i.splice(o,1)}c.sort();var l=c.length>0?p.z:p.y;p.a(M)||(l=p.y);var u=ke(),d={by:p.q,type:p.j,mainword:u.mainword,extrawords:u.extrawords,pos:u.pos},b=[].concat(Object(a.a)($),[d]);ye(),D(l),T(c),C(i),ee(b),Y(e),re({squareArray:JSON.parse(JSON.stringify(M)),ptiles:Object(a.a)(c),gtiles:Object(a.a)(B)}),v.send({gameid:s,type:"pb",func:"ept",sender:n,ptiles:c,tiles:i,whoseturn:l,move:d,rescues:e})}},we=function(){if(Ae()){for(var e=Object(a.a)(B),t=Object(a.a)(k);e.length<x&&t.length>0;){var r=Math.floor(Math.random()*t.length);e.push(t[r]),t.splice(r,1)}e.sort();var c=JSON.parse(JSON.stringify(M)),i=Object(a.a)(E),o=Object(a.a)(B),l=e.length>0?p.A:p.y;p.a(M)||(l=p.y);var u=ke(),d={by:p.p,type:p.j,mainword:u.mainword,extrawords:u.extrawords,pos:u.pos},b=[].concat(Object(a.a)($),[d]);ye(),D(l),q(e),C(t),ee(b),re({squareArray:c,ptiles:i,gtiles:o}),v.send({gameid:s,type:"pb",func:"egt",sender:n,gtiles:e,tiles:t,move:d,whoseturn:l,racksize:x})}};function Ae(){for(var e=!0,t=$.length,n=0;e&&n<t;++n)$[n].type===p.j&&(e=!1);if(e&&M[g][g].usedby===p.x)return window.alert("First play must hit center square"),!1;if(0===z.length)return window.alert("You didn't play any tiles"),!1;for(var r=z.length,a=N+1,c=-1,s=N+1,i=-1,o=0;o<r;++o){var l=parseInt(z[o].split("-")[0]),u=parseInt(z[o].split("-")[1]);if(l<a&&(a=l),l>c&&(c=l),u<s&&(s=u),u>i&&(i=u),!(l>0&&M[l-1][u].usedby!==p.x)&&!(u>0&&M[l][u-1].usedby!==p.x)&&!(l<N&&M[l+1][u].usedby!==p.x)&&!(u<N&&M[l][u+1].usedby!==p.x))return window.alert("Each played tile must be part of a word"),!1}if(a!==c&&s!==i)return window.alert("Tiles played must be in a straight line"),!1;for(var d=!1,b=!1,f=a;f<=c;++f)for(var j=s;j<=i;++j){if(M[f][j].usedby===p.x)return window.alert("There is a gap in your word"),!1;if(!e){var h=f+"-"+j;z.indexOf(h)<0&&(d=!0),a===c&&f>0&&M[f-1][j].usedby!==p.x&&(b=!0),a===c&&f<N&&M[f+1][j].usedby!==p.x&&(b=!0),s===i&&j>0&&M[f][j-1].usedby!==p.x&&(b=!0),s===i&&j<N&&M[f][j+1].usedby!==p.x&&(b=!0)}}return!!(e||(a===c&&s>0&&M[a][s-1].usedby!==p.x&&(d=!0),a===c&&i<N&&M[a][i+1].usedby!==p.x&&(d=!0),s===i&&a>0&&M[a-1][s]!==p.x&&(d=!0),s===i&&c<N&&M[c+1][s].usedby!==p.x&&(d=!0),d||b))||(window.alert("New words must extend an existing word and/or hook existing words or tiles"),!1)}function ke(){for(var e="",t=[],n="",r=N+1,c=-1,s=N+1,i=-1,o=z.length,l=0;l<o;++l){var u=parseInt(z[l].split("-")[0]),d=parseInt(z[l].split("-")[1]);u<r&&(r=u),u>c&&(c=u),d<s&&(s=d),d>i&&(i=d)}if(r<c||1===o){for(var b=s,f=r;f>0&&M[f-1][b].usedby!==p.x;)f-=1;for(var j=c;j<N&&M[j+1][b].usedby!==p.x;)j+=1;n=p.b[b]+p.c[f];for(var h=f;h<=j;++h){e+=M[h][b].letter;var m=h+"-"+b;if(z.indexOf(m)>-1){for(var O=b;O>0&&M[h][O-1].usedby!==p.x;)O-=1;for(var v=b;v<N&&M[h][v+1].usedby!==p.x;)v+=1;if(O<v){for(var y="",x=O;x<=v;++x)y+=M[h][x].letter;t=[].concat(Object(a.a)(t),[y])}}}}if(e.length<2){for(var g=r,w=s;w>0&&M[g][w-1].usedby!==p.x;)w-=1;for(var A=i;A<N&&M[g][A+1].usedby!==p.x;)A+=1;n=p.c[g]+p.b[w],e="",t=[];for(var k=w;k<=A;++k){e+=M[g][k].letter;var C=g+"-"+k;if(z.indexOf(C)>-1){for(var S=g;S>0&&M[S-1][k].usedby!==p.x;)S-=1;for(var E=g;E<N&&M[E+1][k].usedby!==p.x;)E+=1;if(S<E){for(var T="",I=S;I<=E;++I)T+=M[I][k].letter;t=[].concat(Object(a.a)(t),[T])}}}}return{mainword:e,extrawords:t,pos:n}}function Ce(){oe||(le(!0),v.send({gameid:s,type:"pb",func:"allowundo",sender:n}))}function Se(){v.send({gameid:s,type:"pb",func:"undoturn"})}var Ee=function(){H(JSON.parse(JSON.stringify(ne.squareArray))),T(Object(a.a)(ne.ptiles)),q(Object(a.a)(ne.gtiles)),J(-1),G([]),W([-1,-1,p.e])};function Te(e){var t=e.length-1,n=t-1;return n>-1&&e[n].type===p.i&&e[t].type===p.i}var Ie=function(){v.send({gameid:s,type:"pb",sender:n,func:"requestgamedata"})};return Object(r.jsxs)("div",{className:"prisonbreak",children:[Object(r.jsxs)("div",{className:"w3-display-container w3-teal topBarHeight",children:[Object(r.jsx)("div",{className:"w3-display-middle",children:Object(r.jsx)("h1",{className:"myHeadingFont",children:"Prison Break"})}),Object(r.jsxs)("div",{className:"w3-display-topleft w3-black topBarCorner commonFontFamily",children:["Game id: ",s]}),Object(r.jsxs)("div",{className:"w3-display-bottomleft w3-orange topBarCorner commonFontFamily",children:["Prisoners: ",n===p.q?m:de]}),Object(r.jsx)("div",{className:"w3-display-topright w3-black topBarCorner commonFontFamily",children:Object(r.jsx)(i.a,{href:"../../",children:Object(r.jsx)("a",{children:Object(r.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})})}),Object(r.jsxs)("div",{className:"w3-display-bottomright w3-orange topBarCorner commonFontFamily",children:["Guards: ",n===p.q?de:m]})]}),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsxs)("div",{className:"col pbTileAndMovesOuter",children:[Object(r.jsx)(u.default,{tiles:k,othertiles:n===p.q?B:E}),Object(r.jsx)(d.default,{moves:$})]}),Object(r.jsx)("div",{className:"col pbPlayerOuterSection",children:n===p.q?Object(r.jsx)(o.default,{racktiles:E,whoseturn:F,selection:L,onClick:function(e){return ge(e)},onClickFinishTurn:function(){return Ne()},onClickTileRecall:function(){return Ee()},onClickTileExchange:function(){return function(){if(k.length<x)window.alert("Need "+x+" tiles in the bag to exchange");else{for(var e=[],t=Object(a.a)(k);e.length<x&&t.length>0;){var r=Math.floor(Math.random()*t.length);e.push(t[r]),t.splice(r,1)}e.sort(),(t=[].concat(Object(a.a)(t),Object(a.a)(ne.ptiles))).sort();var c={by:p.q,type:p.k},i=[].concat(Object(a.a)($),[c]);ye(),H(JSON.parse(JSON.stringify(ne.squareArray))),D(p.z),T(e),C(t),ee(i),re({squareArray:JSON.parse(JSON.stringify(ne.squareArray)),ptiles:[].concat(e),gtiles:Object(a.a)(B)}),v.send({gameid:s,type:"pb",func:"ept",sender:n,whoseturn:p.z,ptiles:e,tiles:t,move:c})}}()},onClickPassPlay:function(){return function(){var e={by:p.q,type:p.i},t=[].concat(Object(a.a)($),[e]),r=Te(t)?p.y:p.z;Ee(),ye(),D(r),ee(t),v.send({gameid:s,type:"pb",func:"ept",sender:n,whoseturn:r,move:e})}()},onClickUndoLastPlay:function(){return Se()},onClickAllowUndo:function(){return Ce()},participant:n,moves:$,allowRewind:oe}):Object(r.jsx)(o.default,{racktiles:B,whoseturn:F,selection:L,onClick:function(e){return ge(e)},onClickFinishTurn:function(){return we()},onClickTileRecall:function(){return Ee()},onClickTileExchange:function(){return function(){if(k.length<x)window.alert("Need "+x+" tiles in the bag to exchange");else{for(var e=[],t=Object(a.a)(k);e.length<x&&t.length>0;){var r=Math.floor(Math.random()*t.length);e.push(t[r]),t.splice(r,1)}e.sort(),(t=[].concat(Object(a.a)(t),Object(a.a)(ne.gtiles))).sort();var c={by:p.p,type:p.k},i=[].concat(Object(a.a)($),[c]);ye(),H(JSON.parse(JSON.stringify(ne.squareArray))),D(p.A),q(e),C(t),ee(i),re({squareArray:JSON.parse(JSON.stringify(ne.squareArray)),ptiles:Object(a.a)(E),gtiles:[].concat(e)}),v.send({gameid:s,type:"pb",func:"egt",sender:n,whoseturn:p.A,gtiles:e,tiles:t,move:c})}}()},onClickPassPlay:function(){return function(){var e={by:p.p,type:p.i},t=[].concat(Object(a.a)($),[e]),r=Te(t)?p.y:p.A;Ee(),ye(),D(r),ee(t),v.send({gameid:s,type:"pb",func:"egt",sender:n,whoseturn:r,move:e})}()},onClickUndoLastPlay:function(){return Se()},onClickAllowUndo:function(){return Ce()},participant:n,moves:$,allowRewind:oe})}),Object(r.jsx)("div",{className:"col",children:n===F?Object(r.jsx)("div",{className:"row",onKeyDownCapture:function(e){if(e.preventDefault(),n===F)if("Enter"!==e.key)if("Escape"!==e.key){if(e.key.match(/^[A-Za-z\?]$/)){var t=e.key.toUpperCase(),r=F===p.A?E:B,c=r.indexOf(t);if(-1===c&&(c=r.indexOf("?")),c>-1){var s=Z[0],i=Z[1],o=Z[2];if(s>-1&&i>-1&&o!==p.e){var l=Z;if(o===p.f){for(var u=-1,d=i+1;d<N+1&&-1===u;d++)M[s][d].usedby===p.x&&(u=d);return l=-1===u?[-1,-1,p.e]:[s,u,p.f],xe(s,i,c,l),void J(-1)}if(o===p.d){for(var b=-1,f=2*x+1,j=s+1;j<f&&-1===b;j++)M[j][i].usedby===p.x&&(b=j);return l=-1===b?[-1,-1,p.e]:[b,i,p.d],xe(s,i,c,l),void J(-1)}}}}else if("Backspace"===e.key&&z.length>0){var h=z[z.length-1],m=parseInt(h.split("-")[0]),O=parseInt(h.split("-")[1]),v=Object(a.a)(z),y=Object(a.a)(E),g=Object(a.a)(B),w=JSON.parse(JSON.stringify(M)),A=w[m],k=A[O],C=[-1,-1,p.e],S=L;v.splice(z.length-1,1);var I=M[m][O].letter;F===p.A?(y.push(I),S=y.length-1):(g.push(I),S=g.length-1),k.usedby=p.x,k.letter=p.h,A[O]=k,w[m]=Object(a.a)(A);var R=Z[2];R!==p.e&&(C=[m,O,R],1===z.length&&(S=-1)),G(v),q(g),T(y),H(w),W(C),J(S)}}else Ee();else F===p.A?Ne():we()},children:Object(r.jsx)(l.default,{squareArray:M,rcd:Z,onClick:function(e,t){return xe(e,t,-1,null)}})}):Object(r.jsx)("div",{className:"row",children:Object(r.jsx)(l.default,{squareArray:M,rcd:Z,onClick:function(){}})})}),Object(r.jsxs)("div",{className:"col",children:[Object(r.jsx)(b.default,{rescues:_}),Object(r.jsx)(f.default,{gameid:s,client:v,nickname:m,msgs:pe,setMsgs:je,participant:n})]})]}),Object(r.jsx)("div",{className:"w3-display-container w3-teal topBarHeight",children:Object(r.jsx)("div",{className:"w3-display-middle commonFontFamily",children:F===p.y?Object(r.jsx)("h1",{children:"Game Over!"}):Object(r.jsx)("p",{children:p.g[ce]})})})]})}}}]);