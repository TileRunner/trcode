(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[4],{A1c0:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),c=n("gBDq");t.default=function(e){var t=e.letter,n=e.ci,a=e.ri,s=e.squareusedby,i=e.rcd,o=e.onClick,l=e.racksize,u=2*l,d=l,O=t!==c.SQUARE_UNUSED?"pbSquareInner PlayerTile":i[0]===a&&i[1]===n&&i[2]===c.DIR_RIGHT?"pbSquareInner RightArrow":i[0]===a&&i[1]===n&&i[2]===c.DIR_DOWN?"pbSquareInner DownArrow":a===d&&n===d?"pbSquareInner CenterSquare":0!==a&&a!==d&&a!==u||0!==n&&n!==d&&n!==u?a%2===n%2?"pbSquareInner style1":"pbSquareInner style2":"pbSquareInner EscapeHatch",b=t!==c.SQUARE_UNUSED?t:O.indexOf("RightArrow")>-1?"\u27a1":O.indexOf("DownArrow")>-1?"\u2b07":O.indexOf("CenterSquare")>-1?Object(r.jsx)("i",{className:"material-icons",children:"stars"}):".";return O.indexOf("EscapeHatch")>-1?Object(r.jsx)("button",{className:O,onClick:o,children:Object(r.jsx)("span",{className:"material-icons",children:c.PARTY_ICON_PRISONERS})}):t===c.SQUARE_UNUSED?Object(r.jsx)("button",{className:O,onClick:o,children:b}):Object(r.jsx)("button",{className:O,onClick:o,children:Object(r.jsx)("div",{className:"pbSquareTileText ".concat(s+("Q"===c?" u":"")),children:b})})}},KQm4:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(t,"a",(function(){return c}))},KiN8:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),c=n("gBDq");t.default=function(e){var t=e.moves;return Object(r.jsxs)("div",{className:"pbMoves",children:[Object(r.jsx)("div",{className:"pbMovesTitle",children:"MOVES"}),Object(r.jsx)("div",{className:"pbMovesScrollable",id:"ScrollableMoves",children:t&&t.map((function(e,t){var n;return Object(r.jsxs)("div",{className:"pbMove",children:[Object(r.jsx)("span",{className:"pbMove by",children:e.by}),":",Object(r.jsx)("span",{className:"pbMove ".concat(e.type),children:e.type===c.MOVE_TYPE_PLAY?Object(r.jsxs)(r.Fragment,{children:[e.pos," ",e.mainword.replace("Q","Qu"),null===(n=e.extrawords)||void 0===n?void 0:n.map((function(e){return Object(r.jsxs)(r.Fragment,{children:[",\xa0",e.replace("Q","Qu")]})}))]}):Object(r.jsx)(r.Fragment,{})})]},"move".concat(t))}))})]})}},NOQH:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),c=n("gBDq"),a=function(e){var t="pbTileOnRack "+(e.selection===e.tileindex?"Selected ":"Unselected ")+("Q"===e.tilevalue?"u ":"")+e.participant,n=e.tileindex;return Object(r.jsx)("div",{className:t,onClick:function(t){return e.onClick(t)},children:Object(r.jsx)("div",{className:"pbTileOnRackText",children:e.tilevalue})},n)},s=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"check"}),"\xa0Finish Turn"]})})},i=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"undo"}),"\xa0Recall Tiles"]})})},o=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"cached"}),"\xa0Swap Tiles"]})})},l=function(e){return Object(r.jsx)("button",{className:"pbActionButton",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonText",children:[Object(r.jsx)("i",{className:"material-icons",children:"not_interested"}),"\xa0Pass Turn"]})})},u=function(e){return e.alreadyAllowed?Object(r.jsx)("div",{className:"pbActionButtonSevere",children:Object(r.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(r.jsx)("i",{className:"material-icons",children:"report"}),"\xa0ENABLED",Object(r.jsx)("span",{className:"pbActionButtonSevereText2",children:"\xa0Allow undo is now enabled"})]})}):Object(r.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(r.jsx)("i",{className:"material-icons",children:"report_problem"}),"\xa0Allow Undo Turn",Object(r.jsx)("span",{className:"pbActionButtonSevereText2",children:"Click to let opponent undo"})]})})},d=function(e){return Object(r.jsx)("button",{className:"pbActionButtonSevere",onClick:e.onClick,children:Object(r.jsxs)("span",{className:"pbActionButtonSevereText",children:[Object(r.jsx)("i",{className:"material-icons",children:"delete_forever"}),"\xa0Undo My Turn",Object(r.jsx)("span",{className:"pbActionButtonSevereText2",children:"Opponent has allowed undo"})]})})};function O(e){return Object(r.jsxs)("div",{className:"pbActionButtonDiv",children:[Object(r.jsx)("p",{children:Object(r.jsx)(s,{onClick:function(){return e.onClickFinishTurn()}})}),Object(r.jsx)("p",{children:Object(r.jsx)(i,{onClick:function(){return e.onClickTileRecall()}})}),Object(r.jsx)("p",{children:Object(r.jsx)(o,{onClick:function(){return e.onClickTileExchange()}})}),Object(r.jsx)("p",{children:Object(r.jsx)(l,{onClick:function(){return e.onClickPassPlay()}})})]})}function b(e){return Object(r.jsx)("div",{className:"pbActionButtonDiv",children:Object(r.jsx)("p",{children:Object(r.jsx)(u,{onClick:function(){return e.onClickAllowUndo()},alreadyAllowed:e.allowRewind})})})}function f(e){return Object(r.jsx)("div",{className:"pbActionButtonDiv",children:Object(r.jsx)("p",{children:Object(r.jsx)(d,{onClick:function(){return e.onClickUndoLastPlay()}})})})}t.default=function(e){var t=e.participant===c.PARTY_TYPE_PRISONERS?c.PARTY_ICON_PRISONERS:c.PARTY_ICON_GUARDS,n=e.participant===c.PARTY_TYPE_PRISONERS?c.PARTY_TITLE_PRISONERS:c.PARTY_TITLE_GUARDS;return Object(r.jsxs)("div",{className:"pbPlayerInnerSection",children:[Object(r.jsxs)("div",{className:"pbPlayerTitle",children:[Object(r.jsx)("i",{className:"material-icons",children:t}),"\xa0",n,"\xa0",Object(r.jsx)("i",{className:"material-icons",children:t})]}),Object(r.jsx)("div",{className:"pbTilerack",children:e.racktiles&&e.racktiles.map((function(t,n){return Object(r.jsx)(a,{whoseturn:e.whoseturn,participant:e.participant,selection:e.selection,tileindex:n,tilevalue:t,onClick:function(){return e.onClick(n)}},"RackTile".concat(n))}))}),e.whoseturn===e.participant?O(e):e.allowRewind&&e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by===e.participant&&f(e),e.moves&&e.moves.length>0&&e.moves[e.moves.length-1].by!==e.participant&&b(e)]})}},YFqc:function(e,t,n){e.exports=n("cTJO")},cTJO:function(e,t,n){"use strict";var r=n("J4zp"),c=n("284h");t.__esModule=!0,t.default=void 0;var a=c(n("q1tI")),s=n("elyg"),i=n("nOHt"),o=n("vNVm"),l={};function u(e,t,n,r){if(e&&(0,s.isLocalURL)(t)){e.prefetch(t,n,r).catch((function(e){0}));var c=r&&"undefined"!==typeof r.locale?r.locale:e&&e.locale;l[t+"%"+n+(c?"%"+c:"")]=!0}}var d=function(e){var t=!1!==e.prefetch,n=(0,i.useRouter)(),c=n&&n.pathname||"/",d=a.default.useMemo((function(){var t=(0,s.resolveHref)(c,e.href,!0),n=r(t,2),a=n[0],i=n[1];return{href:a,as:e.as?(0,s.resolveHref)(c,e.as):i||a}}),[c,e.href,e.as]),O=d.href,b=d.as,f=e.children,j=e.replace,p=e.shallow,E=e.scroll,S=e.locale;"string"===typeof f&&(f=a.default.createElement("a",null,f));var R=a.Children.only(f),N=R&&"object"===typeof R&&R.ref,h=(0,o.useIntersection)({rootMargin:"200px"}),m=r(h,2),_=m[0],v=m[1],U=a.default.useCallback((function(e){_(e),N&&("function"===typeof N?N(e):"object"===typeof N&&(N.current=e))}),[N,_]);(0,a.useEffect)((function(){var e=v&&t&&(0,s.isLocalURL)(O),r="undefined"!==typeof S?S:n&&n.locale,c=l[O+"%"+b+(r?"%"+r:"")];e&&!c&&u(n,O,b,{locale:r})}),[b,O,v,S,t,n]);var A={ref:U,onClick:function(e){R.props&&"function"===typeof R.props.onClick&&R.props.onClick(e),e.defaultPrevented||function(e,t,n,r,c,a,i,o){("A"!==e.currentTarget.nodeName||!function(e){var t=e.currentTarget.target;return t&&"_self"!==t||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&(0,s.isLocalURL)(n))&&(e.preventDefault(),null==i&&(i=r.indexOf("#")<0),t[c?"replace":"push"](n,r,{shallow:a,locale:o,scroll:i}).then((function(e){e&&i&&document.body.focus()})))}(e,n,O,b,j,p,E,S)},onMouseEnter:function(e){(0,s.isLocalURL)(O)&&(R.props&&"function"===typeof R.props.onMouseEnter&&R.props.onMouseEnter(e),u(n,O,b,{priority:!0}))}};if(e.passHref||"a"===R.type&&!("href"in R.props)){var T="undefined"!==typeof S?S:n&&n.locale,g=(0,s.getDomainLocale)(b,T,n&&n.locales,n&&n.domainLocales);A.href=g||(0,s.addBasePath)((0,s.addLocale)(b,T,n&&n.defaultLocale))}return a.default.cloneElement(R,A)};t.default=d},gBDq:function(e,t,n){"use strict";n.r(t),n.d(t,"BOARD_COL_HEADERS",(function(){return r})),n.d(t,"BOARD_ROW_HEADERS",(function(){return c})),n.d(t,"SQUARE_UNUSED",(function(){return a})),n.d(t,"PARTY_TYPE_UNDETERMINED",(function(){return s})),n.d(t,"PARTY_TYPE_PRISONERS",(function(){return i})),n.d(t,"PARTY_TYPE_GUARDS",(function(){return o})),n.d(t,"PARTY_TYPE_OBSERVER",(function(){return l})),n.d(t,"WHOSE_TURN_PRISONERS",(function(){return u})),n.d(t,"WHOSE_TURN_GUARDS",(function(){return d})),n.d(t,"WHOSE_TURN_GAMEOVER",(function(){return O})),n.d(t,"PARTY_ICON_PRISONERS",(function(){return b})),n.d(t,"PARTY_ICON_GUARDS",(function(){return f})),n.d(t,"PARTY_TITLE_PRISONERS",(function(){return j})),n.d(t,"PARTY_TITLE_GUARDS",(function(){return p})),n.d(t,"MOVE_TYPE_PLAY",(function(){return E})),n.d(t,"MOVE_TYPE_SWAP",(function(){return S})),n.d(t,"MOVE_TYPE_PASS",(function(){return R})),n.d(t,"DIR_RIGHT",(function(){return N})),n.d(t,"DIR_DOWN",(function(){return h})),n.d(t,"DIR_NONE",(function(){return m})),n.d(t,"USED_BY_PRISONERS",(function(){return _})),n.d(t,"USED_BY_GUARDS",(function(){return v})),n.d(t,"USED_BY_NONE",(function(){return U}));var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],c=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],a=".",s="U",i="P",o="G",l="O",u=i,d=o,O="X",b="run_circle",f="security",j="PRISONERS",p="GUARDS",E="PLAY",S="SWAP",R="PASS",N="r",h="d",m="",_=i,v=o,U=""},qa2E:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),c=n("KQm4");t.default=function(e){var t=e.tiles,n=e.othertiles,a=[].concat(Object(c.a)(t||[]),Object(c.a)(n||[]));return a.sort(),"?"===a[0]&&(a.splice(0,1),a.push("?")),"?"===a[0]&&(a.splice(0,1),a.push("?")),Object(r.jsxs)("div",{className:"pbTilepool",children:[Object(r.jsx)("div",{className:"pbTilepoolTitle",children:"TILES"}),a.map((function(e,t){return Object(r.jsxs)("span",{children:[t>0&&e!==a[t-1]?Object(r.jsx)("span",{className:"pbTilepoolDivider"}):Object(r.jsx)(r.Fragment,{}),Object(r.jsx)("span",{className:"Q"===e?"pbTilepoolTile u":"pbTilepoolTile",children:e})]},"tile".concat(t))}))]})}},rZeA:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),c=n("A1c0"),a=n("gBDq");t.default=function(e){var t=e.onClick,n=e.squares,s=void 0===n?[]:n,i=e.usedby,o=e.rcd,l=e.racksize,u=function(e){return Object(r.jsxs)("tr",{className:"pbRow",children:[Object(r.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderLeft",children:a.BOARD_ROW_HEADERS[e]}),s[e].map((function(n,a){return function(e,n,a,s){return Object(r.jsx)("td",{className:"pbSquareOuter",children:Object(r.jsx)(c.default,{letter:a,ci:n,ri:e,squareusedby:s,rcd:o,onClick:function(){return t(e,n)},racksize:l})},"Square".concat(e,"-").concat(n))}(e,a,n,i[e][a])})),Object(r.jsx)("td",{className:"pbBoardRowHeader",id:"BoardHeaderRight",children:a.BOARD_ROW_HEADERS[e]})]},"BoardRow".concat(e))};return Object(r.jsx)("table",{className:"pbBoard",children:Object(r.jsxs)("tbody",{children:[Object(r.jsxs)("tr",{className:"pbBoardColumnHeaderRow",children:[Object(r.jsx)("td",{className:"pbBoardHeaderTopLeft",children:"\xa0"}),s&&s.map((function(e,t){return Object(r.jsx)("td",{className:"pbBoardColumnHeader",children:a.BOARD_COL_HEADERS[t]},"TopColumnHeader".concat(t))})),Object(r.jsx)("td",{className:"pbBoardHeaderTopRight",children:"\xa0"})]}),s.map((function(e,t){return u(t)})),Object(r.jsxs)("tr",{className:"pbBoardColumnHeaderRow",id:"BoardHeaderBottom",children:[Object(r.jsx)("td",{className:"pbBoardHeaderBottomLeft",children:"\xa0"}),s.map((function(e,t){return Object(r.jsx)("td",{className:"pbBoardColumnHeader",children:a.BOARD_COL_HEADERS[t]},"BottomColumnHeader".concat(t))})),Object(r.jsx)("td",{className:"pbBoardHeaderBottomRight",children:"\xa0"})]})]})})}},vNVm:function(e,t,n){"use strict";var r=n("J4zp"),c=n("TqRt");t.__esModule=!0,t.useIntersection=function(e){var t=e.rootMargin,n=e.disabled||!i,c=(0,a.useRef)(),l=(0,a.useState)(!1),u=r(l,2),d=u[0],O=u[1],b=(0,a.useCallback)((function(e){c.current&&(c.current(),c.current=void 0),n||d||e&&e.tagName&&(c.current=function(e,t,n){var r=function(e){var t=e.rootMargin||"",n=o.get(t);if(n)return n;var r=new Map,c=new IntersectionObserver((function(e){e.forEach((function(e){var t=r.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)}))}),e);return o.set(t,n={id:t,observer:c,elements:r}),n}(n),c=r.id,a=r.observer,s=r.elements;return s.set(e,t),a.observe(e),function(){s.delete(e),a.unobserve(e),0===s.size&&(a.disconnect(),o.delete(c))}}(e,(function(e){return e&&O(e)}),{rootMargin:t}))}),[n,t,d]);return(0,a.useEffect)((function(){i||d||(0,s.default)((function(){return O(!0)}))}),[d]),[b,d]};var a=n("q1tI"),s=c(n("0G5g")),i="undefined"!==typeof IntersectionObserver;var o=new Map},yhjZ:function(e,t,n){"use strict";n.r(t);var r=n("nKUr"),c=n("KQm4"),a=n("q1tI"),s=n("YFqc"),i=n.n(s),o=n("NOQH"),l=n("rZeA"),u=n("qa2E"),d=n("KiN8"),O=n("gBDq"),b=["Escapee: \"I'm free! I'm free!\". Little kid: \"I'm four! I'm four!\"","Two peanuts were walking down a back alley. One was a salted.","The psychic dwarf escaped! There's a small medium at large!","What do you call a vegetable who has escaped prison? An escapea!","The prisoners fave punctuation is a period. It marks the end of a sentence!","Prison is only one word, but to robbers it's a whole sentence."],f=["A","A","A","B","C","D","E","E","E","E","F","G","H","I","I","I","J","K","L","M","N","N","O","O","O","P","Q","R","R","S","T","T","U","V","W","X","Y","Z","?","?"],j=["A","A","A","A","A","B","C","D","D","E","E","E","E","E","E","F","G","H","I","I","I","I","I","J","K","L","L","M","N","N","N","O","O","O","O","P","Q","R","R","R","S","S","T","T","T","U","V","W","X","Y","Z","?","?"],p=["A","A","A","A","A","A","A","B","B","C","C","D","D","D","E","E","E","E","E","E","E","E","E","F","G","G","H","H","I","I","I","I","I","I","I","J","K","L","L","L","M","M","N","N","N","N","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","S","S","S","T","T","T","T","U","U","U","V","W","X","Y","Z","?","?"],E=["A","A","A","A","A","A","A","A","A","B","B","C","C","D","D","D","D","E","E","E","E","E","E","E","E","E","E","E","E","F","F","G","G","G","H","H","I","I","I","I","I","I","I","I","I","J","K","L","L","L","L","M","M","N","N","N","N","N","N","O","O","O","O","O","O","O","O","P","P","Q","R","R","R","R","R","R","S","S","S","S","T","T","T","T","T","T","U","U","U","U","V","V","W","W","X","Y","Y","Z","?","?"],S=function(e){return Object(r.jsxs)("div",{className:"pbRescuesMade",children:["Rescues made: ",e.rescues]})},R=function(e){var t=e.gameid,n=e.client,s=e.nickname,i=e.msgs,o=e.setMsgs,l=e.participant,u=Object(a.useState)(""),d=u[0],O=u[1];return Object(r.jsx)("div",{id:"ScrollableChat",className:"pbChat",children:Object(r.jsx)("table",{className:"pbChatTable",children:Object(r.jsxs)("tbody",{children:[i.map((function(e,t){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"pbChatFrom",children:e.from}),Object(r.jsx)("td",{className:"pbChatMsg",children:e.msg})]},"ChatMessage".concat(t))})),Object(r.jsx)("tr",{children:Object(r.jsx)("td",{colSpan:"2",children:Object(r.jsx)("textarea",{className:""===d?"pbChatInputEmpty":"pbChatInput",name:"nextmsgInputArea",value:d,onChange:function(e){O(e.target.value)},onKeyDownCapture:function(e){if("Enter"===e.key&&d.length>0){e.preventDefault();var r=[].concat(Object(c.a)(i),[{from:s,msg:d}]),a=d;return o(r),O(""),void n.send(JSON.stringify({gameid:t,nickname:s,type:"pb",func:"chat",sender:l,sendmsg:a}))}if("Backspace"===e.key&&d.length>0){e.preventDefault();var u=d.slice(0,d.length-1);O(u)}},placeholder:"chat..."})})})]})})})},N=function(e){var t=document.getElementById(e);t.scrollTop=t.scrollHeight};t.default=function(e){var t=e.isrejoin,n=e.participant,s=e.gameid,h=e.nickname,m=e.wsmessage,_=e.client,v=e.racksize,U=void 0===v?4:v,A=U,T=2*U,g=6===U?p:7===U?E:5===U?j:f,y=Array(T+1).fill(Array(T+1).fill(O.SQUARE_UNUSED)),x=Array(T+1).fill(Array(T+1).fill(O.USED_BY_NONE)),D=Object(a.useState)(Object(c.a)(g)),I=D[0],P=D[1],w=Object(a.useState)([]),k=w[0],Y=w[1],C=Object(a.useState)([]),B=C[0],H=C[1],q=Object(a.useState)(Object(c.a)(y)),M=q[0],Q=q[1],W=Object(a.useState)(Object(c.a)(x)),G=W[0],L=W[1],V=Object(a.useState)(-1),F=V[0],J=V[1],z=Object(a.useState)(O.WHOSE_TURN_PRISONERS),K=z[0],Z=z[1],X=Object(a.useState)([]),$=X[0],ee=X[1],te=Object(a.useState)(0),ne=te[0],re=te[1],ce=Object(a.useState)([-1,-1,O.DIR_NONE]),ae=ce[0],se=ce[1],ie=Object(a.useState)([]),oe=ie[0],le=ie[1],ue=Object(a.useState)({squares:Object(c.a)(y),usedby:Object(c.a)(x),ptiles:[],gtiles:[]}),de=ue[0],Oe=ue[1],be=Object(a.useState)(0),fe=be[0],je=be[1],pe=Object(a.useState)(!1),Ee=pe[0],Se=pe[1],Re=Object(a.useState)(""),Ne=Re[0],he=Re[1],me=Object(a.useState)([]),_e=me[0],ve=me[1],Ue=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current=e})),t.current}(ne);function Ae(){J(-1),Se(!1),se(-1,-1,O.DIR_NONE),ee([])}Object(a.useEffect)((function(){if(ne>Ue){var e=document.createElement("audio");e.src="https://tilerunner.github.io/yippee.m4a",e.play()}}),[ne]),Object(a.useEffect)((function(){var e=fe+1;e>=b.length&&(e=0),je(e);var t=setInterval((function(){n!==K&&K!==O.WHOSE_TURN_GAMEOVER&&Be()}),2e4);return function(){return clearInterval(t)}}),[K]),Object(a.useEffect)((function(){if(t||n!==O.PARTY_TYPE_PRISONERS)try{_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"requestgamedata",sender:n}))}catch(o){}else{for(var e=[],r=[],a=Object(c.a)(g);e.length<U;){var i=Math.floor(Math.random()*a.length);e.push(a[i]),a.splice(i,1),i=Math.floor(Math.random()*a.length),r.push(a[i]),a.splice(i,1)}e.sort(),r.sort(),H(r),Y(e),P(a),Oe({squares:Object(c.a)(y),usedby:Object(c.a)(x),ptiles:[].concat(e),gtiles:[].concat(r)}),_.send(JSON.stringify({type:"pb",func:"hello",sender:n,gameid:s,nickname:h,whoseturn:K,racksize:U}))}}),[]),Object(a.useEffect)((function(){""!==m&&function(e){var t=JSON.parse(e);if("announce"===t.type)_.send(JSON.stringify({type:"pb",func:"hello",sender:n,gameid:s,nickname:h,whoseturn:K,racksize:U}));else if(t.gameid===s&&"pb"===t.type&&(t.sender!=n&&""===Ne&&t.nickname&&t.nickname.length>0&&he(t.nickname),"requestgamedata"===t.func&&t.sender!==n&&_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"providegamedata",sender:n,tiles:I,squares:M,ptiles:k,gtiles:B,usedby:G,whoseturn:K,snapshot:de,moves:oe,rescues:ne,racksize:U,allowRewind:Ee})),"providegamedata"===t.func&&t.sender!==n&&(t.moves.length!==oe.length||t.tiles.length!==I.length||n===O.PARTY_TYPE_GUARDS&&0===B.length&&0===$.length||n===O.PARTY_TYPE_PRISONERS&&0===k.length&&0===$.length)&&(P(t.tiles),Q(t.squares),Y(t.ptiles),H(t.gtiles),L(t.usedby),Z(t.whoseturn),Oe(t.snapshot),le(t.moves),re(t.rescues),Se(t.allowRewind)),"ept"===t.func&&n===O.PARTY_TYPE_GUARDS&&(Ae(),Z(t.whoseturn),Q(t.squares),L(t.usedby),Y(t.ptiles),P(t.tiles),le(t.moves),re(t.rescues),Oe({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(t.ptiles),gtiles:Object(c.a)(B)})),"egt"===t.func&&n===O.PARTY_TYPE_PRISONERS&&(Ae(),Z(t.whoseturn),Q(t.squares),L(t.usedby),H(t.gtiles),P(t.tiles),le(t.moves),Oe({squares:Object(c.a)(t.squares),usedby:Object(c.a)(t.usedby),ptiles:Object(c.a)(k),gtiles:Object(c.a)(t.gtiles)})),"undoturn"===t.func&&t.sender!==n&&(Ae(),P(t.tiles),Y(t.ptiles),H(t.gtiles),Q(t.squares),L(t.usedby),Z(t.whoseturn),re(t.rescues),le(t.moves),Oe(t.snapshot)),"allowundo"===t.func&&t.sender!==n&&Se(!0),"chat"===t.func&&t.sender!=n)){var r=[].concat(Object(c.a)(_e),[{from:t.nickname,msg:t.sendmsg}]);ve(r)}}(m)}),[m]),Object(a.useEffect)((function(){N("ScrollableMoves")}),[oe]),Object(a.useEffect)((function(){N("ScrollableChat")}),[_e]);var Te=function(e,t,n,r){var a=Object(c.a)(M),s=Object(c.a)(G),i=Object(c.a)(k),o=Object(c.a)(B),l=Object(c.a)(M[e]),u=M[e][t],d=Object(c.a)($),b=String(e)+"-"+String(t),f=$.indexOf(b);if(-1===n&&(n=F,r=ae),n>-1&&u===O.SQUARE_UNUSED){l[t]=K===O.WHOSE_TURN_PRISONERS?i[n]:o[n],a[e]=Object(c.a)(l),K===O.WHOSE_TURN_PRISONERS?i.splice(n,1):o.splice(n,1);var j=Object(c.a)(s[e]);return j[t]=K,s[e]=Object(c.a)(j),K===O.WHOSE_TURN_PRISONERS&&n===i.length&&(n-=1),K===O.WHOSE_TURN_GUARDS&&n===o.length&&(n-=1),J(n),Q(a),L(s),Y(i),H(o),ee([].concat(Object(c.a)($),[b])),void se(r)}if(f>-1){K===O.WHOSE_TURN_PRISONERS?i.push(u):o.push(u);var p=Object(c.a)(a[e]);p[t]=O.SQUARE_UNUSED,a[e]=Object(c.a)(p);var E=Object(c.a)(s[e]);return E[t]=O.USED_BY_NONE,s[e]=Object(c.a)(E),J(K===O.WHOSE_TURN_PRISONERS?i.length-1:o.length-1),d.splice(f,1),Q(a),L(s),Y(i),H(o),ee(d),void se(-1,-1,O.DIR_NONE)}if(M[e][t]!==O.SQUARE_UNUSED);else{var S=ae[0]!==e||ae[1]!==t?O.DIR_RIGHT:ae[2]===O.DIR_RIGHT?O.DIR_DOWN:ae[2]===O.DIR_DOWN?O.DIR_NONE:O.DIR_RIGHT;se(r=[e,t,S])}},ge=function(e){if(-1!==F)if(F!==e){var t=n===O.PARTY_TYPE_PRISONERS?Object(c.a)(k):Object(c.a)(B),r=F,a=t[r],s=e;t.splice(r,1),t.splice(s,0,a),n===O.PARTY_TYPE_PRISONERS?Y(t):H(t),J(-1)}else J(-1);else J(e)},ye=function(){if(De()){for(var e=Pe(),t=ne,r=["0-0","0-"+A,"0-"+T,A+"-0",A+"-"+T,T+"-0",T+"-"+A,T+"-"+T],a=0;a<$.length;a++)r.indexOf($[a])>-1&&(t+=1);for(var i=Object(c.a)(k),o=Object(c.a)(I);i.length<U&&o.length>0;){var l=Math.floor(Math.random()*o.length);i.push(o[l]),o.splice(l,1)}i.sort();var u=i.length>0?O.WHOSE_TURN_GUARDS:O.WHOSE_TURN_GAMEOVER;G[0][0]!==O.USED_BY_NONE&&G[0][A]!==O.USED_BY_NONE&&G[0][T]!==O.USED_BY_NONE&&G[A][0]!==O.USED_BY_NONE&&G[A][T]!==O.USED_BY_NONE&&G[T][0]!==O.USED_BY_NONE&&G[T][A]!==O.USED_BY_NONE&&G[T][T]!==O.USED_BY_NONE&&(u=O.WHOSE_TURN_GAMEOVER);var d=Ie(),b={by:O.PARTY_TYPE_PRISONERS,type:O.MOVE_TYPE_PLAY,rewindInfo:e,mainword:d.mainword,extrawords:d.extrawords,pos:d.pos},f=[].concat(Object(c.a)(oe),[b]);Ae(),Z(u),Y(i),P(o),le(f),re(t),Oe({squares:Object(c.a)(M),usedby:Object(c.a)(G),ptiles:Object(c.a)(i),gtiles:Object(c.a)(B)}),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"ept",sender:n,squares:M,usedby:G,ptiles:i,tiles:o,whoseturn:u,racksize:U,moves:f,rescues:t}))}},xe=function(){if(De()){for(var e=Pe(),t=Object(c.a)(B),r=Object(c.a)(I);t.length<U&&r.length>0;){var a=Math.floor(Math.random()*r.length);t.push(r[a]),r.splice(a,1)}t.sort();var i=Object(c.a)(M),o=Object(c.a)(G),l=Object(c.a)(k),u=Object(c.a)(B),d=t.length>0?O.WHOSE_TURN_PRISONERS:O.WHOSE_TURN_GAMEOVER;G[0][0]!==O.USED_BY_NONE&&G[0][A]!==O.USED_BY_NONE&&G[0][T]!==O.USED_BY_NONE&&G[A][0]!==O.USED_BY_NONE&&G[A][T]!==O.USED_BY_NONE&&G[T][0]!==O.USED_BY_NONE&&G[T][A]!==O.USED_BY_NONE&&G[T][T]!==O.USED_BY_NONE&&(d=O.WHOSE_TURN_GAMEOVER);var b=Ie(),f={by:O.PARTY_TYPE_GUARDS,type:O.MOVE_TYPE_PLAY,rewindInfo:e,mainword:b.mainword,extrawords:b.extrawords,pos:b.pos},j=[].concat(Object(c.a)(oe),[f]);Ae(),Z(d),H(t),P(r),le(j),Oe({squares:i,usedby:o,ptiles:l,gtiles:u}),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"egt",sender:n,squares:M,usedby:G,gtiles:t,tiles:r,moves:j,whoseturn:d,racksize:U}))}};function De(){if(M[A][A]===O.SQUARE_UNUSED)return window.alert("First play must hit center square"),!1;for(var e=T+1,t=T+1,n=e,r=-1,c=t,a=-1,s=0;s<e;++s)for(var i=0;i<t;++i)if(M[s][i]!==O.SQUARE_UNUSED){if(!(s>0&&M[s-1][i]!==O.SQUARE_UNUSED)&&!(i>0&&M[s][i-1]!==O.SQUARE_UNUSED)&&!(s<T&&M[s+1][i]!==O.SQUARE_UNUSED)&&!(i<T&&M[s][i+1]!==O.SQUARE_UNUSED))return window.alert("Each played tile must be part of a word"),!1;de.squares[s][i]===O.SQUARE_UNUSED&&(s<n&&(n=s),s>r&&(r=s),i<c&&(c=i),i>a&&(a=i))}if(n===e)return window.alert("You didn't play any tiles"),!1;if(n!==r&&c!==a)return window.alert("Tiles played must be in a straight line"),!1;var o=!1,l=!1;for(s=n;s<=r;++s)for(i=c;i<=a;++i){if(M[s][i]===O.SQUARE_UNUSED)return window.alert("There is a gap in your word"),!1;de.squares[s][i]!==O.SQUARE_UNUSED&&(o=!0),n===r&&s>0&&M[s-1][i]!==O.SQUARE_UNUSED&&(l=!0),n===r&&s<T&&M[s+1][i]!==O.SQUARE_UNUSED&&(l=!0),c===a&&i>0&&M[s][i-1]!==O.SQUARE_UNUSED&&(l=!0),c===a&&i<T&&M[s][i+1]!==O.SQUARE_UNUSED&&(l=!0)}return n===r&&c>0&&de.squares[n][c-1]!==O.SQUARE_UNUSED&&(o=!0),n===r&&a<T&&de.squares[n][a+1]!==O.SQUARE_UNUSED&&(o=!0),c===a&&n>0&&de.squares[n-1][c]!==O.SQUARE_UNUSED&&(o=!0),c===a&&r<T&&de.squares[r+1][c]!==O.SQUARE_UNUSED&&(o=!0),!(!o&&!l&&de.squares[A][A]!==O.SQUARE_UNUSED)||(window.alert("Words must be connected"),!1)}function Ie(){for(var e="",t=[],n="",r=T+1,a=-1,s=T+1,i=-1,o=$.length,l=0;l<o;++l){var u=parseInt($[l].split("-")[0]),d=parseInt($[l].split("-")[1]);u<r&&(r=u),u>a&&(a=u),d<s&&(s=d),d>i&&(i=d)}if(r<a||1===o){for(var b=s,f=r;f>0&&M[f-1][b]!==O.SQUARE_UNUSED;)f-=1;for(var j=a;j<T&&M[j+1][b]!==O.SQUARE_UNUSED;)j+=1;n=O.BOARD_COL_HEADERS[b]+O.BOARD_ROW_HEADERS[f];for(var p=f;p<=j;++p){e+=M[p][b];var E=p+"-"+b;if($.indexOf(E)>-1){for(var S=b;S>0&&M[p][S-1]!==O.SQUARE_UNUSED;)S-=1;for(var R=b;R<T&&M[p][R+1]!==O.SQUARE_UNUSED;)R+=1;if(S<R){for(var N="",h=S;h<=R;++h)N+=M[p][h];t=[].concat(Object(c.a)(t),[N])}}}}if(e.length<2){for(var m=r,_=s;_>0&&M[m][_-1]!==O.SQUARE_UNUSED;)_-=1;for(var v=i;v<T&&M[m][v+1]!==O.SQUARE_UNUSED;)v+=1;n=O.BOARD_ROW_HEADERS[m]+O.BOARD_COL_HEADERS[_],e="",t=[];for(var U=_;U<=v;++U){e+=M[m][U];var A=m+"-"+U;if($.indexOf(A)>-1){for(var g=m;g>0&&M[g-1][U]!==O.SQUARE_UNUSED;)g-=1;for(var y=m;y<T&&M[y+1][U]!==O.SQUARE_UNUSED;)y+=1;if(g<y){for(var x="",D=g;D<=y;++D)x+=M[D][U];t=[].concat(Object(c.a)(t),[x])}}}}return{mainword:e,extrawords:t,pos:n}}function Pe(){return{squares:Object(c.a)(de.squares),usedby:Object(c.a)(de.usedby),rack:K===O.WHOSE_TURN_GUARDS?Object(c.a)(de.gtiles):Object(c.a)(de.ptiles),tiles:Object(c.a)(I),rescues:ne}}function we(){Ee||(Se(!0),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"allowundo",racksize:U,sender:n})))}function ke(){var e=oe.length,t=oe[oe.length-1],r=Object(c.a)(t.rewindInfo.squares),a=Object(c.a)(t.rewindInfo.usedby),i=Object(c.a)(t.rewindInfo.tiles),o=t.by===O.PARTY_TYPE_PRISONERS?Object(c.a)(t.rewindInfo.rack):Object(c.a)(k),l=t.by===O.PARTY_TYPE_GUARDS?Object(c.a)(t.rewindInfo.rack):Object(c.a)(B),u=t.rewindInfo.rescues,d=t.by,b=Object(c.a)(oe);b.splice(e-1,1);var f={squares:Object(c.a)(r),usedby:Object(c.a)(a),gtiles:Object(c.a)(l),ptiles:Object(c.a)(o)};Ae(),P(i),Y(o),H(l),Q(r),L(a),Z(d),re(u),le(b),Oe(f),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"undoturn",racksize:U,sender:n,tiles:i,ptiles:o,gtiles:l,squares:r,usedby:a,whoseturn:d,rescues:u,moves:b,snapshot:f}))}var Ye=function(){Q(Object(c.a)(de.squares)),L(Object(c.a)(de.usedby)),Y(Object(c.a)(de.ptiles)),H(Object(c.a)(de.gtiles)),J(-1),ee([]),se([-1,-1,O.DIR_NONE])};function Ce(e){var t=e.length-1,n=t-1;return n>-1&&e[n].type===O.MOVE_TYPE_PASS&&e[t].type===O.MOVE_TYPE_PASS}var Be=function(){_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",sender:n,whoseturn:K,racksize:U,func:"requestgamedata"}))};return Object(r.jsxs)("div",{className:"prisonbreak",children:[Object(r.jsxs)("div",{className:"w3-display-container w3-teal topBarHeight",children:[Object(r.jsx)("div",{className:"w3-display-middle",children:Object(r.jsx)("h1",{className:"myHeadingFont",children:"Prison Break"})}),Object(r.jsxs)("div",{className:"w3-display-topleft w3-black topBarCorner commonFontFamily",children:["Game id: ",s]}),Object(r.jsxs)("div",{className:"w3-display-bottomleft w3-orange topBarCorner commonFontFamily",children:["Prisoners: ",n===O.PARTY_TYPE_PRISONERS?h:Ne]}),Object(r.jsx)("div",{className:"w3-display-topright w3-black topBarCorner commonFontFamily",children:Object(r.jsx)(i.a,{href:"../../",children:Object(r.jsx)("a",{children:Object(r.jsx)("i",{className:"material-icons","data-toggle":"tooltip",title:"Home",children:"home"})})})}),Object(r.jsxs)("div",{className:"w3-display-bottomright w3-orange topBarCorner commonFontFamily",children:["Guards: ",n===O.PARTY_TYPE_PRISONERS?Ne:h]})]}),Object(r.jsxs)("div",{className:"row",children:[Object(r.jsxs)("div",{className:"col pbTileAndMovesOuter",children:[Object(r.jsx)(u.default,{tiles:I,othertiles:n===O.PARTY_TYPE_PRISONERS?B:k}),Object(r.jsx)(d.default,{moves:oe})]}),Object(r.jsx)("div",{className:"col pbPlayerOuterSection",children:n===O.PARTY_TYPE_PRISONERS?Object(r.jsx)(o.default,{racktiles:k,whoseturn:K,selection:F,onClick:function(e){return ge(e)},onClickFinishTurn:function(){return ye()},onClickTileRecall:function(){return Ye()},onClickTileExchange:function(){return function(){if(I.length<U)window.alert("Need "+U+" tiles in the bag to exchange");else{for(var e=Pe(),t=[],r=Object(c.a)(I);t.length<U&&r.length>0;){var a=Math.floor(Math.random()*r.length);t.push(r[a]),r.splice(a,1)}t.sort(),(r=[].concat(Object(c.a)(r),Object(c.a)(de.ptiles))).sort();var i={by:O.PARTY_TYPE_PRISONERS,type:O.MOVE_TYPE_SWAP,rewindInfo:e},o=[].concat(Object(c.a)(oe),[i]);Ae(),Q(Object(c.a)(de.squares)),L(Object(c.a)(de.usedby)),Z(O.WHOSE_TURN_GUARDS),Y(t),P(r),le(o),Oe({squares:Object(c.a)(de.squares),usedby:Object(c.a)(de.usedby),ptiles:[].concat(t),gtiles:Object(c.a)(B)}),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"ept",sender:n,whoseturn:O.WHOSE_TURN_GUARDS,racksize:U,squares:de.squares,usedby:de.usedby,ptiles:t,tiles:r,moves:o,rescues:ne}))}}()},onClickPassPlay:function(){return function(){var e=Pe(),t={by:O.PARTY_TYPE_PRISONERS,type:O.MOVE_TYPE_PASS,rewindInfo:e},r=[].concat(Object(c.a)(oe),[t]),a=Ce(r)?O.WHOSE_TURN_GAMEOVER:O.WHOSE_TURN_GUARDS;Ye(),Ae(),Z(a),le(r),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"ept",sender:n,squares:de.squares,usedby:de.usedby,ptiles:de.ptiles,tiles:I,whoseturn:a,racksize:U,moves:r,rescues:ne}))}()},onClickUndoLastPlay:function(){return ke()},onClickAllowUndo:function(){return we()},participant:n,moves:oe,allowRewind:Ee}):Object(r.jsx)(o.default,{racktiles:B,whoseturn:K,selection:F,onClick:function(e){return ge(e)},onClickFinishTurn:function(){return xe()},onClickTileRecall:function(){return Ye()},onClickTileExchange:function(){return function(){if(I.length<U)window.alert("Need "+U+" tiles in the bag to exchange");else{for(var e=Pe(),t=[],r=Object(c.a)(I);t.length<U&&r.length>0;){var a=Math.floor(Math.random()*r.length);t.push(r[a]),r.splice(a,1)}t.sort(),(r=[].concat(Object(c.a)(r),Object(c.a)(de.gtiles))).sort();var i={by:O.PARTY_TYPE_GUARDS,type:O.MOVE_TYPE_SWAP,rewindInfo:e},o=[].concat(Object(c.a)(oe),[i]);Ae(),Q(Object(c.a)(de.squares)),L(Object(c.a)(de.usedby)),Z(O.WHOSE_TURN_PRISONERS),H(t),P(r),le(o),Oe({squares:Object(c.a)(de.squares),usedby:Object(c.a)(de.usedby),ptiles:Object(c.a)(k),gtiles:[].concat(t)}),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"egt",sender:n,whoseturn:O.WHOSE_TURN_PRISONERS,racksize:U,squares:de.squares,usedby:de.usedby,gtiles:t,tiles:r,moves:o}))}}()},onClickPassPlay:function(){return function(){var e=Pe(),t={by:O.PARTY_TYPE_GUARDS,type:O.MOVE_TYPE_PASS,rewindInfo:e},r=[].concat(Object(c.a)(oe),[t]),a=Ce(r)?O.WHOSE_TURN_GAMEOVER:O.WHOSE_TURN_PRISONERS;Ye(),Ae(),Z(a),le(r),_.send(JSON.stringify({gameid:s,nickname:h,type:"pb",func:"egt",sender:n,squares:de.squares,usedby:de.usedby,gtiles:de.gtiles,tiles:I,whoseturn:a,racksize:U,moves:r}))}()},onClickUndoLastPlay:function(){return ke()},onClickAllowUndo:function(){return we()},participant:n,moves:oe,allowRewind:Ee})}),Object(r.jsx)("div",{className:"col",children:n===K?Object(r.jsx)("div",{className:"row",onKeyDownCapture:function(e){if(e.preventDefault(),n===K)if("Enter"!==e.key)if("Escape"!==e.key){if(e.key.match(/^[A-Za-z\?]$/)){var t=e.key.toUpperCase(),r=K===O.WHOSE_TURN_PRISONERS?k:B,a=r.indexOf(t);if(-1===a&&(a=r.indexOf("?")),a>-1){var s=ae[0],i=ae[1],o=ae[2];if(s>-1&&i>-1&&o!==O.DIR_NONE){var l=ae;if(o===O.DIR_RIGHT){for(var u=-1,d=i+1;d<T+1&&-1===u;d++)M[s][d]===O.SQUARE_UNUSED&&(u=d);return l=-1===u?[-1,-1,O.DIR_NONE]:[s,u,O.DIR_RIGHT],Te(s,i,a,l),void J(-1)}if(o===O.DIR_DOWN){for(var b=-1,f=2*U+1,j=s+1;j<f&&-1===b;j++)M[j][i]===O.SQUARE_UNUSED&&(b=j);return l=-1===b?[-1,-1,O.DIR_NONE]:[b,i,O.DIR_DOWN],Te(s,i,a,l),void J(-1)}}}}else if("Backspace"===e.key&&$.length>0){var p=$[$.length-1],E=Object(c.a)($),S=Object(c.a)(k),R=Object(c.a)(B),N=Object(c.a)(G),h=Object(c.a)(M),m=[-1,-1,O.DIR_NONE],_=F;E.splice($.length-1,1);var v=parseInt(p.split("-")[0]),A=parseInt(p.split("-")[1]),g=M[v][A];K===O.WHOSE_TURN_PRISONERS?(S.push(g),_=S.length-1):(R.push(g),_=R.length-1),N[v][A]=O.USED_BY_NONE,h[v][A]=O.SQUARE_UNUSED;var y=ae[2];y!==O.DIR_NONE&&(m=[v,A,y],1===$.length&&(_=-1)),ee(E),H(R),Y(S),Q(h),L(N),se(m),J(_)}}else Ye();else K===O.WHOSE_TURN_PRISONERS?ye():xe()},children:Object(r.jsx)(l.default,{squares:M,usedby:G,rcd:ae,onClick:function(e,t){return Te(e,t,-1,null)},racksize:U})}):Object(r.jsx)("div",{className:"row",children:Object(r.jsx)(l.default,{squares:M,usedby:G,rcd:ae,onClick:function(){},racksize:U})})}),Object(r.jsxs)("div",{className:"col",children:[Object(r.jsx)(S,{rescues:ne}),Object(r.jsx)(R,{gameid:s,client:_,nickname:h,msgs:_e,setMsgs:ve,participant:n})]})]}),Object(r.jsx)("div",{className:"w3-display-container w3-teal topBarHeight",children:Object(r.jsx)("div",{className:"w3-display-middle commonFontFamily",children:K===O.WHOSE_TURN_GAMEOVER?Object(r.jsx)("h1",{children:"Game Over!"}):Object(r.jsx)("p",{children:b[fe]})})})]})}}}]);